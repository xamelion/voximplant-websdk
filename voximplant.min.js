var VoxImplant=function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/build",t(t.s=34)}([function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var a;!function(e){e[e.NONE=0]="NONE",e[e.ERROR=1]="ERROR",e[e.WARNING=2]="WARNING",e[e.INFO=3]="INFO",e[e.TRACE=4]="TRACE"}(a=t.LogLevel||(t.LogLevel={}));var s;!function(e){e[e.SIGNALING=0]="SIGNALING",e[e.RTC=1]="RTC",e[e.USERMEDIA=2]="USERMEDIA",e[e.CALL=3]="CALL",e[e.CALLEXP2P=4]="CALLEXP2P",e[e.CALLEXSERVER=5]="CALLEXSERVER",e[e.CALLMANAGER=6]="CALLMANAGER",e[e.CLIENT=7]="CLIENT",e[e.AUTHENTICATOR=8]="AUTHENTICATOR",e[e.PCFACTORY=9]="PCFACTORY",e[e.UTILS=10]="UTILS",e[e.ORTC=11]="ORTC",e[e.MESSAGING=12]="MESSAGING",e[e.REINVITEQ=13]="REINVITEQ",e[e.HARDWARE=14]="HARDWARE",e[e.ENDPOINT=15]="ENDPOINT",e[e.EVENTTARGET=16]="EVENTTARGET"}(s=t.LogCategory||(t.LogCategory={}));!function(e){e[e.DISCONNECTED="DISCONNECTED"]="DISCONNECTED",e[e.CONNECTING="CONNECTING"]="CONNECTING",e[e.CONNECTED="CONNECTED"]="CONNECTED",e[e.LOGGING_IN="LOGGING_IN"]="LOGGING_IN",e[e.LOGGED_IN="LOGGED_IN"]="LOGGED_IN"}(t.ClientState||(t.ClientState={}));var c=function(){function e(t,n,r){i(this,e),this.category=t,this.label=n,this.provider=r}return o(e,[{key:"log",value:function(e,t){this.provider.writeMessage(this.category,this.label,e,t)}},{key:"error",value:function(e){this.log(a.ERROR,e)}},{key:"warning",value:function(e){this.log(a.WARNING,e)}},{key:"info",value:function(e){this.log(a.INFO,e)}},{key:"trace",value:function(e){this.log(a.TRACE,e)}}]),e}();t.Logger=c;var l=function(){function e(){i(this,e),this.timeOriginGap=0,this.isFirstPrint=!0,this.levels={},this.showTrace=!1,this._shadowLogging=!1}return o(e,[{key:"getSLog",value:function(){return this._shadowLog}},{key:"clearSilentLog",value:function(){this._shadowLog=[]}},{key:"setLoggerCallback",value:function(e){this._outerCallback=e}},{key:"setPrettyPrint",value:function(e){this.prettyPrint=e}},{key:"setLogLevel",value:function(e,t){t===a.TRACE?this.showTrace=!0:this.levels[s[e]]=t}},{key:"writeMessage",value:function(t,n,i,o){i===a.TRACE?e.traceTick++:e.logTick++,this.timeOriginGap||(this.timeOriginGap=performance.now());var c="string"==typeof o?o:JSON.stringify(o),l=this.isFirstPrint?this.prettyPrint?(new Date).toUTCString():(new Date).toString():parseInt(""+(performance.now()-this.timeOriginGap)/1e3),u=i===a.TRACE?"VIWSTR "+e.traceTick:"VIWSLR "+e.logTick,d=u+" "+l+" "+a[i]+" "+n+": "+c;if(i<=(void 0!==this.levels[s[t]]?this.levels[s[t]]:a.NONE)||i===a.TRACE&&this.showTrace){if(void 0!==console.debug&&void 0!==console.info&&void 0!==console.error&&void 0!==console.warn)if(this.prettyPrint){var f,g="%c"+u+" "+l+" ["+a[i]+"] %c"+n+": %c"+c,p=(f={},r(f,a.ERROR,"color:#fab005"),r(f,a.WARNING,"color:#af2a2a"),r(f,a.INFO,"color:#0ca678"),r(f,a.TRACE,"color:#8f66ff"),f);i===a.ERROR?console.error(d):i===a.WARNING?console.warn(g,p[i],"color:#2375a2","color:#000"):i===a.INFO?console.info(g,p[i],"color:#2375a2","color:#000"):i===a.TRACE?console.debug(g,p[i],"color:#2375a2","color:#000"):console.log(g,p[i],"color:#2375a2","color:#000")}else i===a.ERROR?console.error(d):i===a.WARNING?console.warn(d):i===a.INFO?console.info(d):i===a.TRACE?console.debug(d):console.log(d);else console.log(d);this.isFirstPrint&&(this.isFirstPrint=!1)}this.shadowLogging&&(i!==a.TRACE||this.showTrace)&&this._shadowLog.push(d),"function"!=typeof this._outerCallback||i===a.TRACE&&!this.showTrace||this._outerCallback({formattedText:d,category:t,label:n,level:i,message:c})}},{key:"createLogger",value:function(e,t){return new c(e,t,this)}},{key:"_traceName",value:function(){return"Logger"}},{key:"shadowLogging",get:function(){return this._shadowLogging},set:function(e){this._shadowLogging||(this._shadowLog=[]),this._shadowLogging=e}}],[{key:"get",value:function(){return void 0===this.inst&&(this.inst=new e,this.inst.prettyPrint=!1),this.inst}},{key:"d_trace",value:function(t){return function(n,r,i){return{value:function(){for(var o=arguments.length,s=Array(o),c=0;c<o;c++)s[c]=arguments[c];var l="login"===r||"basicLogin"===r||"sendWSMessage"===r&&"login"===s[0],u="sendWSMessage"===r?2:1,d=n._traceName?n._traceName()+(this&&this.settings?" "+this.settings.id:this&&this.id&&"function"!=typeof this.id?" "+this.id:""):"",f="";try{f=s.map(function(e,t){return l&&t===u?'"********"':JSON.stringify(e)}).join()}catch(e){f="circular structure"}return e.get().writeMessage(t,d,a.TRACE,r+"("+f+")"),i.value.apply(this,s)}}}}}]),e}();l.logTick=0,l.traceTick=0,t.LogManager=l},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(r)},c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":c(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var u=n(15),d=n(8),f=n(16),g=n(2),p=n(11),v=n(9),h=n(0),m=n(10),y=n(6),C=n(18),_=n(3),S=n(14),E=n(25),L=n(67),b=n(68),M=n(20),R=n(4),T=n(44),k=n(45),I=n(40),P=function(e){function t(){r(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(e._connected=!1,e.progressToneScript={US:"440@-19,480@-19;*(2/4/1+2)",RU:"425@-19;*(1/3/1)"},e.playingNow=!1,e.serversList=[],e.level=100,e.micRequired=!1,e.videoConstraints=null,e.progressToneCountry="US",e.progressTone=!0,e.enableTrace=!1,e.showDebugInfo=!1,e.showWarnings=!1,e.RTCsupported=!1,e._deviceEnumAPI=!1,e._h264first=!1,e._VP8first=!1,e.depLastDevices={ai:[],ao:[],vi:[]},e._alreadyInitialized=!1,t.instance)throw new Error("Error - use VoxImplant.getInstance()");return t.instance=e,e._promises={},v.default.init(),m.PCFactory.get().requireMedia=!1,e.voxSignaling=g.VoxSignaling.get(),e.voxCallManager=y.CallManager.get(),e.setLogLevelAll(h.LogLevel.NONE),g.VoxSignaling.get().setRPCHandler(S.RemoteEvent.onPCStats,function(t,n){m.PCFactory.get().getPeerConnect(t)&&e.dispatchEvent({name:"NetStatsReceived",stats:n})}),e.logger=h.LogManager.get().createLogger(h.LogCategory.CLIENT,e._traceName()),e._defaultSinkId=null,e.loginState=0,e}return o(t,e),a(t,[{key:"playProgressTone",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(!e||e&&this.progressTone)&&null!==this.progressToneScript[this.progressToneCountry]&&(this.playingNow||this.playToneScript(this.progressToneScript[this.progressToneCountry]),this.playingNow=!0)}},{key:"stopProgressTone",value:function(){this.playingNow&&(this.stopPlayback(),this.playingNow=!1)}},{key:"onIncomingCall",value:function(e,t,n,r,i){this.dispatchEvent({name:d.Events.IncomingCall,call:y.CallManager.get().calls[e],headers:r,video:i})}},{key:"init",value:function(e){var n=this;return new Promise(function(r,i){if(n.alreadyInitialized&&i(new Error("WebSDK already initialized")),n._alreadyInitialized=!0,n._config=void 0!==e?e:{},void 0!==n._config.progressToneCountry&&(n.progressToneCountry=n._config.progressToneCountry),!0!==n._config.progressTone&&(n.progressTone=!1),void 0!==n._config.serverIp&&(n.serverIp=n._config.serverIp),void 0!==n._config.enableTrace&&(n.enableTrace=n._config.enableTrace),void 0!==n._config.showDebugInfo&&(n.showDebugInfo=n._config.showDebugInfo),!1!==n._config.showWarnings&&(n.showWarnings=!0),"string"==typeof n._config.videoContainerId&&(n.remoteVideoContainerId=n._config.videoContainerId),"string"==typeof n._config.remoteVideoContainerId&&(n.remoteVideoContainerId=n._config.remoteVideoContainerId),"string"==typeof n._config.localVideoContainerId&&(n.localVideoContainerId=n._config.localVideoContainerId),!1!==n._config.micRequired&&(n.micRequired=!0),void 0!==n._config.videoSupport?n.videoSupport=n._config.videoSupport:n.videoSupport=!1,void 0===n._config.queueType&&(n._config.queueType=u.QueueTypes.ACD),void 0!==n._config.H264first&&(n._h264first=n._config.H264first,y.CallManager.get()._h264first=n._h264first),void 0!==n._config.VP8first&&(n._VP8first=n._config.VP8first),void 0!==n._config.rtcStatsCollectionInterval?y.CallManager.get().rtcStatsCollectionInterval=n._config.rtcStatsCollectionInterval:y.CallManager.get().rtcStatsCollectionInterval=1e4,void 0!==t.getInstance().config().experiments&&void 0!==t.getInstance().config().experiments.rtcStatsInquiryInterval?y.CallManager.get().rtcStatsInquiryInterval=t.getInstance().config().experiments.rtcStatsInquiryInterval:y.CallManager.get().rtcStatsInquiryInterval=500,!n._config.protocolVersion||"2"!==n._config.protocolVersion&&"3"!==n._config.protocolVersion?n._callProtocolVersion="3":(n._callProtocolVersion=n._config.protocolVersion,y.CallManager.get().setProtocolVersion(n._callProtocolVersion)),n._config.callstatsIoParams&&E.CallstatsIo.get(n._config.callstatsIoParams),n._config.prettyPrint&&h.LogManager.get().setPrettyPrint(n._config.prettyPrint),n.showWarnings&&n.setLogLevelAll(h.LogLevel.WARNING),n.showDebugInfo&&n.setLogLevelAll(h.LogLevel.INFO),n.enableTrace&&n.setLogLevelAll(h.LogLevel.TRACE),n.logger.info("SDK version: "+n.version),n.logger.info("init("+JSON.stringify(n._config)+")"),"127.0.0.1"!=window.location.hostname&&"localhost"!=window.location.hostname&&"https:"!=window.location.protocol&&void 0!==console.error&&n.showWarnings&&n.logger.warning("WARNING: getUserMedia() is deprecated on insecure origins, and support will be removed in the future. You should consider switching your application to a secure origin, such as HTTPS. See https://goo.gl/rStTGz for more details."),n._config.experiments&&n._config.experiments.ignorewebrtc)n.RTCsupported=!0;else if("undefined"!=typeof webkitRTCPeerConnection||"undefined"!=typeof mozRTCPeerConnection||"undefined"!=typeof RTCPeerConnection||"undefined"!=typeof RTCIceGatherer)if("undefined"!=typeof mozRTCPeerConnection)try{new mozRTCPeerConnection({iceServers:[]}),n.RTCsupported=!0}catch(e){}else n.RTCsupported=!0;if(!n.RTCsupported)throw i(new Error("NO_WEBRTC_SUPPORT")),new Error("NO_WEBRTC_SUPPORT");var o;if(void 0!==n._config.videoConstraints){n.videoConstraints=n._config.videoConstraints;var a=R.default.CameraManager.legacyParamConverter(n._config.videoConstraints);R.default.CameraManager.get().setDefaultVideoSettings(a)}R.default.CameraManager.get().getInputDevices().then(function(e){return n.depLastDevices.vi=e}),R.default.AudioDeviceManager.get().getInputDevices().then(function(e){return n.depLastDevices.ai=e}),R.default.AudioDeviceManager.get().getOutputDevices().then(function(e){return n.depLastDevices.ao=e}),null!=window.location.href.match(/^file\:\/{3}.*$/g)&&void 0!==console.error&&n.showWarnings&&console.error("WebRTC requires application to be loaded from a web server"),n.voxAuth=p.Authenticator.get(),n.voxAuth.setHandler({onLoginSuccessful:function(e,t){n.loginState=2;var r={name:d.Events.AuthResult,displayName:e,result:!0,tokens:t};n._resolvePromise("login",r),n.dispatchEvent(r)},onLoginFailed:function(e){n.loginState=0;var t=5==(e/100|0)?5e3:0;setTimeout(function(){var t={name:d.Events.AuthResult,code:e,result:!1};n._rejectPromise("login",t),n.dispatchEvent(t)},t)},onSecondStageInitiated:function(){var e={name:d.Events.AuthResult,code:301,result:!1};n._rejectPromise("login",e),n.dispatchEvent(e)},onOneTimeKeyGenerated:function(e){var t={name:d.Events.AuthResult,key:e,code:302,result:!1};n._resolvePromise("loginkey",t),n.dispatchEvent(t)},onRefreshTokenFailed:function(e){var t={name:d.Events.RefreshTokenResult,code:e,result:!1};n.dispatchEvent(t)},onRefreshTokenSuccess:function(e){var t={name:d.Events.RefreshTokenResult,tokens:e,result:!0};n.dispatchEvent(t)}}),n.voxSignaling.addHandler(n),o=setInterval(function(){"undefined"!=typeof document&&(clearInterval(o),n.dispatchEvent({name:d.Events.SDKReady,version:n.version}),r({name:d.Events.SDKReady,version:n.version}))},100),g.VoxSignaling.get().setRPCHandler(S.RemoteEvent.sipRegisterSuccessful,function(e,t){n.dispatchEvent({name:"SIPRegistrationSuccessful",id:e,sipuri:t})}),g.VoxSignaling.get().setRPCHandler(S.RemoteEvent.onACDStatus,function(e,t,n){T.default.onStatusUpdated(t,n)}),g.VoxSignaling.get().setRPCHandler(S.RemoteEvent.onMessagingStatus,function(e,t,n){k.default.onStatusUpdated(t,n)}),g.VoxSignaling.get().setRPCHandler(S.RemoteEvent.onSQStatusError,function(e,t,n,r){k.default.onError(t,n,r),T.default.onError(t,n,r)}),g.VoxSignaling.get().setRPCHandler(S.RemoteEvent.sipRegisterFailed,function(e,t,r,i){n.dispatchEvent({name:"SIPRegistrationFailed",id:e,sipuri:t,status:r,reason:i})}),g.VoxSignaling.get().setRPCHandler(S.RemoteEvent.unregisterPushTokenResult,function(e){b.PushService.updatePromiseResult(e)}),g.VoxSignaling.get().setRPCHandler(S.RemoteEvent.registerPushTokenResult,function(e){b.PushService.updatePromiseResult(e)})})}},{key:"call",value:function(e,t,n,r){this.logger.info("call("+e+", "+JSON.stringify(t)+")");var i={H264first:this._h264first,VP8first:this._VP8first};switch(i="string"==typeof e||"number"==typeof e?{number:e,video:t,customData:n,extraHeaders:r}:e,c(i.video)){case"boolean":i.video={sendVideo:i.video,receiveVideo:i.video};break;case"undefined":i.video={sendVideo:!1,receiveVideo:!0}}try{f.Utils.checkCA();return this.voxCallManager.call(i)}catch(e){var o=new I.CallExMedia(f.Utils.generateUUID(),p.Authenticator.get().displayName,!1,i);return setTimeout(function(){o.onFailed(+e.message,"",{})},500),o}}},{key:"callConference",value:function(e,t,n,r){this.logger.info("callConference("+e+", "+JSON.stringify(t)+")");var i={H264first:this._h264first,VP8first:this._VP8first};switch(i="string"==typeof e||"number"==typeof e?{number:e,video:t,customData:n,extraHeaders:r}:e,c(i.video)){case"boolean":i.video={sendVideo:i.video,receiveVideo:i.video};break;case"undefined":i.video={sendVideo:!1,receiveVideo:!0}}i.isConference=!0;try{f.Utils.checkCA();var o=this.voxCallManager.callConference(i);return o.capMaxBitrate(2e3),o}catch(e){var a=new I.CallExMedia(f.Utils.generateUUID(),p.Authenticator.get().displayName,!1,i);return setTimeout(function(){a.onFailed(+e.message,"",{})},500),a}}},{key:"config",value:function(){return this._config}},{key:"connect",value:function(e){var t=this;this.logger.info("connect("+e+")"),void 0===this._config&&this.logger.warning("Please, run VoxImplant init before connect."),void 0===e&&!1===this._config.micRequired&&(e=!1);var n=null;return new Promise(function(r,i){var o=function o(a){if(n||(n=a),0===a.length)return t.logger.info("We can't connect to the Voximplant cloud. Please, check UDP connection to Voximplant servers: "+n.join(", ")),void i();var s=a.shift();t.logger.info("Trying "+s),t.connectTo(s,null,e).then(function(e){r(e)}).catch(function(){t.logger.info("Connection to the "+s+" falled"),setTimeout(function(){return o(a)},0)})};t._config.serverIp&&"object"===c(t._config.serverIp)?o(t.serverIp):t._config.serverIp?o(t.serverIp.split(";")):f.Utils.getServers().then(function(e){return setTimeout(function(){return o(e.split(";"))},0)}).catch(function(){setTimeout(function(){t.dispatchEvent({name:"ConnectionFailed",message:"VoxImplant Cloud is unavailable"})},5e3)})})}},{key:"connectTo",value:function(e,t,n){var r=this;return new Promise(function(t,i){r._connected&&i(new Error("ALREADY_CONNECTED_TO_VOXIMPLANT")),r._promises.connect={resolve:t,reject:i},r.host=e,r.voxSignaling.connectTo(e,!0,!0,n,r._callProtocolVersion,r._config.queueType)})}},{key:"disconnect",value:function(){this.logger.info("disconnect()"),this.checkConnection(),this.voxSignaling.disconnect(),R.default.StreamManager.get().clear(),this.voxSignaling.removeRPCHandler(S.RemoteEvent.onCallRemoteFunctionError),this.voxSignaling.removeRPCHandler(S.RemoteEvent.handleError)}},{key:"setOperatorACDStatus",value:function(e){return this.logger.info("setOperatorACDStatus("+e+")"),T.default.setStatus(e)}},{key:"setOperatorSQMessagingStatus",value:function(e){return this._config.queueType!=u.QueueTypes.SmartQueue?void Promise.reject("This function only enabled in SmartQueue. You must set QueueType to QueueTypes.SmartQueue in the ClientConfig"):(this.logger.info("setOperatorSQMessagingStatus ("+e+")"),k.default.setStatus(e))}},{key:"getOperatorACDStatus",value:function(){return T.default.getStatus()}},{key:"getOperatorSQMessagingStatus",value:function(){return k.default.getStatus()}},{key:"login",value:function(e,t,n){var r=this;return this.logger.info("login("+e+", "+(t?"***":void 0)+", {receiveCalls: "+(n&&n.receiveCalls)+"})"),this.loginState=1,new Promise(function(i,o){r._promises.login={resolve:i,reject:o},n=void 0!==n?n:{},r.checkConnection(),r._config.experiments&&r._config.experiments.mediaServer&&(n.mediaServer=r._config.experiments.mediaServer),r.voxAuth.basicLogin(e,t,n)})}},{key:"loginWithCode",value:function(e,t,n){var r=this;return this.loginState=1,new Promise(function(i,o){r._promises.login={resolve:i,reject:o},n=void 0!==n?n:{},n=Object.assign({},n,{serverPresenceControl:!1}),r.checkConnection(),r.voxAuth.loginStage2(e,t,n)})}},{key:"loginWithToken",value:function(e,t,n){var r=this;return this.logger.info("loginWithToken("+e+", '***', {receiveCalls: "+(n&&n.receiveCalls)+"})"),this.loginState=1,new Promise(function(i,o){r._promises.login={resolve:i,reject:o},n=void 0!==n?n:{},n=Object.assign({},n,{serverPresenceControl:!1}),n.accessToken=t,r.checkConnection(),r.voxAuth.tokenLogin(e,n)})}},{key:"tokenRefresh",value:function(e,t,n){var r=this;return this.logger.info("tokenRefresh("+e+")"),new Promise(function(i,o){var a=function e(t){t.result?i(t):o(t),r.off(d.Events.RefreshTokenResult,e)};r.on(d.Events.RefreshTokenResult,a),r.voxAuth.tokenRefresh(e,t,n)})}},{key:"requestOneTimeLoginKey",value:function(e){var t=this;return new Promise(function(n,r){t._promises.loginkey={resolve:n,reject:r},t.checkConnection(),t.voxAuth.generateOneTimeKey(e)})}},{key:"loginWithOneTimeKey",value:function(e,t,n){var r=this;return this.logger.info("loginWithOneTimeKey("+e+", '***' , {receiveCalls: "+(n&&n.receiveCalls)+"})"),this.loginState=1,new Promise(function(i,o){r._promises.login={resolve:i,reject:o},n=void 0!==n?n:{},n=Object.assign({},n,{serverPresenceControl:!1}),r.checkConnection(),r.voxAuth.loginUsingOneTimeKey(e,t,n)})}},{key:"connected",value:function(){return this._connected}},{key:"showLocalVideo",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.logger.info("showLocalVideo("+e+", "+t+", "+n+")"),e?R.default.StreamManager.get().showLocalVideo():R.default.StreamManager.get().hideLocalVideo()}},{key:"setLocalVideoPosition",value:function(e,t){throw new Error("Deprecated: please use CSS to position '#voximplantlocalvideo' element")}},{key:"setLocalVideoSize",value:function(e,t){throw new Error("Deprecated: please use CSS to set size of '#voximplantlocalvideo' element")}},{key:"setVideoSettings",value:function(e,t,n){R.default.CameraManager.get().setDefaultVideoSettings(R.default.CameraManager.legacyParamConverter(e)),y.CallManager.get().setVideoSettings(e).then(function(){t&&t(null)},function(e){n&&n(null)})}},{key:"setVideoBandwidth",value:function(e){this.logger.info("setVideoBandwidth("+e+")"),this.checkConnection(),m.PCFactory.get().setBandwidthParams(e),this.voxSignaling.callRemoteFunction(_.RemoteFunction.setDesiredVideoBandwidth,e)}},{key:"playToneScript",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.logger.info("playToneScript('***', "+t+")"),f.Utils.playToneScript(e,t)}},{key:"stopPlayback",value:function(){this.logger.info("stopPlayback()"),f.Utils.stopPlayback()&&this.dispatchEvent({name:d.Events.PlaybackFinished})}},{key:"volume",value:function(e){return void 0!==e&&(e>100&&(e=100),e<0&&(e=0),y.CallManager.get().setAllCallsVolume(e),this.level=e),this.level}},{key:"audioSources",value:function(){return this.depLastDevices.ai}},{key:"videoSources",value:function(){return this.depLastDevices.vi}},{key:"audioOutputs",value:function(){return this.depLastDevices.ao}},{key:"useAudioSource",value:function(e,t,n){var r=R.default.AudioDeviceManager.get().getDefaultAudioSettings();return R.default.AudioDeviceManager.get().setDefaultAudioSettings(Object.assign({},r,{inputId:e})),new Promise(function(r,i){return y.CallManager.get().useAudioSource(e).then(function(){t&&t(null),r(null)},function(e){n&&n(e),i(e)})})}},{key:"useVideoSource",value:function(e,t,n){var r=R.default.CameraManager.get().getDefaultVideoSettings();return R.default.CameraManager.get().setDefaultVideoSettings(Object.assign({},r,{cameraId:e})),new Promise(function(r,i){return y.CallManager.get().useVideoSource(e).then(function(){t&&t(null),r(null)},function(e){n&&n(e),i(e)})})}},{key:"useAudioOutput",value:function(e){var t=this;return new Promise(function(n,r){"chrome"!==v.default.getWSVendor(!0)&&r(new Error("Unsupported browser. Only Google Chrome 49 and above.")),t._defaultSinkId=e,n()})}},{key:"attachRecordingDevice",value:function(e,t){h.LogManager.get().writeMessage(h.LogCategory.CLIENT,"DEPRECATED",h.LogLevel.ERROR,"Now all media connection on demand. There is no reason do it by hand."),e&&e(null)}},{key:"detachRecordingDevice",value:function(){R.default.StreamManager.get().clear()}},{key:"setCallActive",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e.setActive(t)}},{key:"sendVideo",value:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0];h.LogManager.get().writeMessage(h.LogCategory.CLIENT,"DEPRECATED",h.LogLevel.ERROR,"This function deprecated. Use Call.sendVideo() instead.")}},{key:"isRTCsupported",value:function(){try{var e=new RTCPeerConnection;if(void 0===navigator.getUserMedia&&void 0===navigator.mediaDevices.getUserMedia)throw new Error("No getUserMedia");e.addTransceiver("audio");return e.getTransceivers().forEach(function(e){if(!e.stopped&&(e.sender.replaceTrack(null),e.direction="sendrecv",void 0===e.currentDirection))throw new Error("No currentDirection")}),e.close(),!0}catch(e){return!1}}},{key:"transferCall",value:function(e,t){this.logger.info("transferCall("+e+", "+e+")");try{f.Utils.checkCA(),this.voxCallManager.transferCall(e,t)}catch(n){this.voxCallManager.handleConnectionFailed(e.id(),+n.message,"",{}),this.voxCallManager.handleConnectionFailed(t.id(),+n.message,"",{})}}},{key:"setLogLevel",value:function(e,t){h.LogManager.get().setLogLevel(e,t)}},{key:"onSignalingConnected",value:function(){this._connected=!0;var e={name:d.Events.ConnectionEstablished};this._resolvePromise("connect",e),this.dispatchEvent(e)}},{key:"onSignalingClosed",value:function(){this._connected=!1,this.dispatchEvent({name:d.Events.ConnectionClosed}),this.progressTone&&this.stopProgressTone()}},{key:"onSignalingConnectionFailed",value:function(e){this._connected=!1,this._rejectPromise("connect",event)}},{key:"onMediaConnectionFailed",value:function(){}},{key:"getCall",value:function(e){return y.CallManager.get().calls[e]}},{key:"removeCall",value:function(e){y.CallManager.get().removeCall(e)}},{key:"screenSharingSupported",value:function(){return v.default.screenSharingSupported()}},{key:"addEventListener",value:function(e,n){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addEventListener",this).call(this,e,n)}},{key:"removeEventListener",value:function(e,n){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"removeEventListener",this).call(this,e,n)}},{key:"on",value:function(e,n,r){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"on",this).call(this,e,n)}},{key:"off",value:function(e,n){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"off",this).call(this,e,n)}},{key:"getZingayaAPI",value:function(){return new L.ZingayaAPI(this)}},{key:"registerForPushNotificatuons",value:function(e){return this.logger.info("Deprecated registerForPushNotificatuons()"),b.PushService.register(e)}},{key:"registerForPushNotifications",value:function(e){return this.logger.info("registerForPushNotifications()"),b.PushService.register(e)}},{key:"unregisterForPushNotificatuons",value:function(e){return this.logger.info("Deprecated unregisterForPushNotificatuons()"),b.PushService.unregister(e)}},{key:"unregisterForPushNotifications",value:function(e){return this.logger.info("unregisterForPushNotifications()"),b.PushService.unregister(e)}},{key:"handlePushNotification",value:function(e){return this.logger.info("handlePushNotification()"),b.PushService.incomingPush(e)}},{key:"getGUID",value:function(){return(new M.default).toString()}},{key:"enableSilentLogging",value:function(e){h.LogManager.get().shadowLogging=e}},{key:"clearSilentLog",value:function(){h.LogManager.get().clearSilentLog()}},{key:"getSilentLog",value:function(){return h.LogManager.get().getSLog()}},{key:"setLoggerCallback",value:function(e){h.LogManager.get().setLoggerCallback(e)}},{key:"getClientState",value:function(){var e=this.voxSignaling.currentState;return e==g.VoxSignalingState.CONNECTING||e==g.VoxSignalingState.WSCONNECTED?h.ClientState.CONNECTING:e==g.VoxSignalingState.CLOSING||e==g.VoxSignalingState.IDLE?h.ClientState.DISCONNECTED:e==g.VoxSignalingState.CONNECTED?1==this.loginState?h.ClientState.LOGGING_IN:2==this.loginState?h.ClientState.LOGGED_IN:h.ClientState.CONNECTED:void 0}},{key:"setSwfColor",value:function(){h.LogManager.get().writeMessage(h.LogCategory.CLIENT,"NOT SUPPORTED",h.LogLevel.ERROR,"setSwfColor deprecated, and not supported!")}},{key:"_traceName",value:function(){return"Client"}},{key:"checkConnection",value:function(){if(!this._connected)throw new Error("NOT_CONNECTED_TO_VOXIMPLANT")}},{key:"_resolvePromise",value:function(e,t){var n=this._promises[e];n&&(n.resolve(t),this._promises[e]=void 0)}},{key:"_rejectPromise",value:function(e,t){var n=this._promises[e];n&&(n.reject(t),this._promises[e]=void 0)}},{key:"setLogLevelAll",value:function(e){var t=h.LogManager.get();Object.keys(h.LogCategory).forEach(function(n){t.setLogLevel(h.LogCategory[n],e)})}},{key:"setConnectionData",value:function(e,t){e&&(this._config.gateway=e),t&&(this._config.connectionId=t)}},{key:"version",get:function(){return"4.4.2-2078"}},{key:"alreadyInitialized",get:function(){return this._alreadyInitialized}}],[{key:"getInstance",value:function(){return void 0===t.instance&&(t.instance=new t),t.instance}}]),t}(C.EventTarget);l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"playProgressTone",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"stopProgressTone",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"onIncomingCall",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"init",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"call",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"callConference",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"connect",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"connectTo",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"disconnect",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"setOperatorACDStatus",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"setOperatorSQMessagingStatus",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"getOperatorACDStatus",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"getOperatorSQMessagingStatus",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"login",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"loginWithCode",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"loginWithToken",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"tokenRefresh",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"requestOneTimeLoginKey",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"loginWithOneTimeKey",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"connected",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"showLocalVideo",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"setLocalVideoPosition",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"setLocalVideoSize",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"setVideoSettings",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"setVideoBandwidth",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"playToneScript",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"stopPlayback",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"volume",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"audioSources",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"videoSources",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"audioOutputs",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"useAudioSource",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"useVideoSource",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"useAudioOutput",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"attachRecordingDevice",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"detachRecordingDevice",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"setCallActive",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"sendVideo",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"isRTCsupported",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"transferCall",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"setLogLevel",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"onSignalingConnected",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"onSignalingClosed",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"onSignalingConnectionFailed",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"onMediaConnectionFailed",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"getCall",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"removeCall",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"addEventListener",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"removeEventListener",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"on",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"off",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"checkConnection",null),l([h.LogManager.d_trace(h.LogCategory.CLIENT)],P.prototype,"setLogLevelAll",null),t.Client=P},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,t,n,r){var i,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":o(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(a<3?i(s):a>3?i(t,n,s):i(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(t,"__esModule",{value:!0});var s,c=n(0),l=n(9),u=n(10),d=n(3),f=n(14),g=n(19),p=n(1),v=n(15),h=n(4),m=h.default.StreamManager;!function(e){e[e.IDLE=0]="IDLE",e[e.CONNECTING=1]="CONNECTING",e[e.WSCONNECTED=2]="WSCONNECTED",e[e.CONNECTED=3]="CONNECTED",e[e.CLOSING=4]="CLOSING"}(s=t.VoxSignalingState||(t.VoxSignalingState={}));var y=function(){function e(){var t=this;r(this,e),this.ver="3",this.ACDType=v.QueueTypes.ACD,this.handlers=[],this.rpcHandlers={},this.pingTimer=null,this.manualDisconnect=!1,this.platform="platform",this.referrer="platform",this.extra="",this.closing=!1,this.writeLog=!1,this._opLog=[],this.token="",this.logger=c.LogManager.get().createLogger(c.LogCategory.SIGNALING,this._traceName()),this.currentState=s.IDLE,this.setRPCHandler(f.RemoteEvent.connectionSuccessful,function(e){t.onConnectionSuccessfulRPC(e)}),this.setRPCHandler(f.RemoteEvent.connectionFailed,function(){t.onConnectionFailedRPC()}),this.setRPCHandler(f.RemoteEvent.createConnection,function(e){t.onConnectionSuccessfulRPC(e)})}return i(e,[{key:"addHandler",value:function(e){this.handlers.push(e)}},{key:"close",value:function(){this.closing=!0,this.ws?(this.ws.onclose=null,this.ws.close(),this.onWSClosed(null)):this.logger.warning("Try close unused WS in state "+s[this.currentState])}},{key:"cleanup",value:function(){u.PCFactory.get().closeAll(),this.pingTimer&&clearTimeout(this.pingTimer),m.clearUmCache()}},{key:"onConnectionSuccessfulRPC",value:function(e){if(this.currentState!=s.WSCONNECTED)return void this.logger.error("Can't handle __connectionSuccessful while in state "+s[this.currentState]);if(e&&(this.token=e),this.currentState=s.CONNECTED,this.handlers.length>0)for(var t=0;t<this.handlers.length;++t)try{this.handlers[t].onSignalingConnected()}catch(e){this.logger.warning("Error in onSignalingConnected callback: "+e)}else this.logger.warning("No VoxSignaling handler specified")}},{key:"onConnectionFailedRPC",value:function(){if(this.currentState!=s.WSCONNECTED)return void this.logger.error("Can't handle __connectionSuccessful while in state "+s[this.currentState]);if(this.ws.onerror=null,this.ws.close(),this.ws=null,this.currentState=s.IDLE,p.Client.getInstance().loginState=0,this.handlers.length>0)for(var e=0;e<this.handlers.length;++e)try{this.handlers[e].onMediaConnectionFailed()}catch(e){this.logger.warning("Error in onMediaConnectionFailed callback: "+e)}else this.logger.warning("No VoxSignaling handler specified")}},{key:"connectTo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments[3],i=this,o=arguments[4],a=arguments[5];if(this.manualDisconnect=!1,this.ver=o,this.ACDType=a,this.currentState!=s.IDLE)return void this.logger.error("Can't establish connection while in state "+s[this.currentState]);this.currentState=s.CONNECTING;var c=l.default.getWSVendor();this.ws=new WebSocket("ws"+(n?"s":"")+"://"+e+"/"+this.platform+"?version="+this.ver+"&client="+c+"&ccheck="+(void 0===r||r)+"&referrer=&extra="+this.extra+"&video="+(t?"true":"false")+"&client_version="+p.Client.getInstance().version+"&client_platform="+c+"&im_version=2&acd_version="+this.ACDType),p.Client.getInstance().setConnectionData(e,null),this.ws.onopen=function(e){return i.onWSConnected()},this.ws.onclose=function(e){return i.onWSClosed(e)},this.ws.onerror=function(e){return i.onWSError()},this.ws.onmessage=function(e){return i.onWSData(e.data)}}},{key:"setRPCHandler",value:function(e,t){void 0!==this.rpcHandlers[e]&&this.logger.warning("Overwriting RPC handler for function "+e),this.rpcHandlers[e]=t}},{key:"removeRPCHandler",value:function(e){void 0!==this.rpcHandlers[e]||this.closing||this.logger.warning("There is no RPC handler for function "+e),delete this.rpcHandlers[e]}},{key:"callRemoteFunction",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(e!==d.RemoteFunction.ping&&this.logger.trace("callRemoteFunction("+e+")"),this.currentState!=s.CONNECTED&&this.currentState!=s.WSCONNECTED)return this.closing||this.logger.error("Can't make a RPC call in state "+s[this.currentState]),!1;if(void 0!==this.ws){this.writeLog&&this._opLog.push("send:"+JSON.stringify({name:e,params:n}));var i=JSON.stringify({name:e,params:n});return this.ws.send(i),!0}}},{key:"onWSData",value:function(e){this.writeLog&&this._opLog.push("recv:"+e);var t=void 0;try{t=JSON.parse(e)}catch(t){return void this.logger.error("Can't parse JSON data: "+e)}void 0!==t.service?this.onWSMessData(t):this.onWSVoipData(t)}},{key:"onWSMessData",value:function(e){g.MsgSignaling.get().handleWsData(e)}},{key:"onWSVoipData",value:function(e){var t=e.name,n=e.params;if(void 0!==this.rpcHandlers[t])try{this.rpcHandlers[t].apply(null,n)}catch(e){this.logger.warning("Error in '"+t+"' handler : "+e)}else this.logger.warning("No handler for "+t)}},{key:"disconnect",value:function(){this.closing=!0,this.manualDisconnect=!0,this.onWSClosed(null),this.cleanup()}},{key:"onWSClosed",value:function(e){if(this.currentState!=s.CONNECTED&&this.currentState!=s.CONNECTING&&this.currentState!=s.CLOSING){if(this.closing)return;this.logger.warning("onWSClosed in state "+s[this.currentState])}this.ws&&(this.ws.close(),this.ws=void 0);var t=this.currentState;if(this.pingTimer&&clearTimeout(this.pingTimer),this.cleanup(),this.currentState=s.IDLE,p.Client.getInstance().loginState=0,this.handlers.length>0)for(var n=0;n<this.handlers.length;++n)if(t!=s.CONNECTING&&t!=s.WSCONNECTED&&t!=s.IDLE||this.manualDisconnect)try{this.handlers[n].onSignalingClosed()}catch(e){this.logger.warning("Error in onSignalingClosed callback: "+e)}else try{this.handlers[n].onSignalingConnectionFailed(e.reason)}catch(e){this.logger.warning("Error in onSignalingConnectionFailed callback: "+e)}else this.logger.warning("No VoxSignaling handler specified")}},{key:"onWSConnected",value:function(){var t=this;this.closing=!1,this.currentState!=s.CONNECTING&&this.logger.warning("onWSConnected in state "+s[this.currentState]),this.currentState=s.WSCONNECTED,this.pingTimer&&clearTimeout(this.pingTimer),this.pingTimer=window.setTimeout(function(){return t.doPing()},e.PING_DELAY),this.setRPCHandler(f.RemoteEvent.pong,function(){}),this.setRPCHandler(f.RemoteEvent.increaseGain,function(){t.logger.info("Deprecated increaseGain")})}},{key:"onWSError",value:function(){if(this.currentState!=s.CONNECTING&&this.logger.warning("onWSError in state "+this.currentState),this.ws.close(),this.ws=void 0,this.pingTimer&&clearTimeout(this.pingTimer),this.cleanup(),this.currentState=s.IDLE,p.Client.getInstance().loginState=0,void 0!==this.handlers)for(var e=0;e<this.handlers.length;++e)try{this.handlers[e].onSignalingConnectionFailed("Error connecting to VoxImplant server")}catch(e){this.logger.warning("Error in onSignalingConnectionFailed callback: "+e)}else this.logger.warning("No VoxSignaling handler specified")}},{key:"doPing",value:function(){var t=this;this.callRemoteFunction(d.RemoteFunction.ping,[]),this.pingTimer=window.setTimeout(function(){return t.doPing()},e.PING_DELAY)}},{key:"sendRaw",value:function(e){this.writeLog&&this._opLog.push("send:"+JSON.stringify(e));var t=JSON.stringify(e);return this.ws.send(t),c.LogManager.get().writeMessage(c.LogCategory.SIGNALING,"[wsdataout]",c.LogLevel.INFO,t),!0}},{key:"getLog",value:function(){return this._opLog}},{key:"lagacyConnectTo",value:function(e,t,n,r){this.ver="2",this.platform=r,this.referrer=t,this.connectTo(e,!1,!0,!0,"2",v.QueueTypes.ACD)}},{key:"_traceName",value:function(){return"VoxSignaling"}}],[{key:"get",value:function(){return void 0===this.inst&&(this.inst=new e),this.inst}}]),e}();y.PING_DELAY=1e3,y.PONG_DELAY=2e4,a([c.LogManager.d_trace(c.LogCategory.SIGNALING)],y.prototype,"addHandler",null),a([c.LogManager.d_trace(c.LogCategory.SIGNALING)],y.prototype,"close",null),a([c.LogManager.d_trace(c.LogCategory.SIGNALING)],y.prototype,"cleanup",null),a([c.LogManager.d_trace(c.LogCategory.SIGNALING)],y.prototype,"onConnectionSuccessfulRPC",null),a([c.LogManager.d_trace(c.LogCategory.SIGNALING)],y.prototype,"onConnectionFailedRPC",null),a([c.LogManager.d_trace(c.LogCategory.SIGNALING)],y.prototype,"connectTo",null),a([c.LogManager.d_trace(c.LogCategory.SIGNALING)],y.prototype,"setRPCHandler",null),a([c.LogManager.d_trace(c.LogCategory.SIGNALING)],y.prototype,"removeRPCHandler",null),a([c.LogManager.d_trace(c.LogCategory.SIGNALING)],y.prototype,"disconnect",null),a([c.LogManager.d_trace(c.LogCategory.SIGNALING)],y.prototype,"onWSClosed",null),a([c.LogManager.d_trace(c.LogCategory.SIGNALING)],y.prototype,"onWSConnected",null),a([c.LogManager.d_trace(c.LogCategory.SIGNALING)],y.prototype,"onWSError",null),a([c.LogManager.d_trace(c.LogCategory.SIGNALING)],y.prototype,"sendRaw",null),t.VoxSignaling=y},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});!function(e){e[e.ping="__ping"]="ping",e[e.login="login"]="login",e[e.loginGenerateOneTimeKey="loginGenerateOneTimeKey"]="loginGenerateOneTimeKey",e[e.loginStage2="loginStage2"]="loginStage2",e[e.setOperatorACDStatus="setOperatorACDStatus"]="setOperatorACDStatus",e[e.getOperatorACDStatus="getOperatorACDStatus"]="getOperatorACDStatus",e[e.setOperatorMessagingStatus="setOperatorMessagingStatus"]="setOperatorMessagingStatus",e[e.getOperatorMessagingStatus="getOperatorMessagingStatus"]="getOperatorMessagingStatus",e[e.setDesiredVideoBandwidth="setDesiredVideoBandwidth"]="setDesiredVideoBandwidth",e[e.rejectCall="rejectCall"]="rejectCall",e[e.disconnectCall="disconnectCall"]="disconnectCall",e[e.sendDTMF="sendDTMF"]="sendDTMF",e[e.sendSIPInfo="sendSIPInfo"]="sendSIPInfo",e[e.hold="hold"]="hold",e[e.unhold="unhold"]="unhold",e[e.acceptCall="acceptCall"]="acceptCall",e[e.createCall="createCall"]="createCall",e[e.callConference="callConference"]="callConference",e[e.transferCall="transferCall"]="transferCall",e[e.muteLocal="__muteLocal"]="muteLocal",e[e.reInvite="ReInvite"]="reInvite",e[e.acceptReInvite="AcceptReInvite"]="acceptReInvite",e[e.rejectReInvite="RejectReInvite"]="rejectReInvite",e[e.confirmPC="__confirmPC"]="confirmPC",e[e.addCandidate="__addCandidate"]="addCandidate",e[e.loginUsingOneTimeKey="loginUsingOneTimeKey"]="loginUsingOneTimeKey",e[e.refreshOauthToken="refreshOauthToken"]="refreshOauthToken",e[e.zPromptFinished="promptFinished"]="zPromptFinished",e[e.zStartPreFlightCheck="__startPreFlightCheck"]="zStartPreFlightCheck",e[e.registerPushToken="registerPushToken"]="registerPushToken",e[e.unregisterPushToken="unregisterPushToken"]="unregisterPushToken",e[e.pushFeedback="pushFeedback"]="pushFeedback",e[e.refreshIceConfig="refreshIceConfig"]="refreshIceConfig"}(t.RemoteFunction||(t.RemoteFunction={}))},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a,s=n(55);!function(e){!function(e){e[e.DevicesUpdated="DevicesUpdated"]="DevicesUpdated",e[e.MediaRendererAdded="MediaRendererAdded"]="MediaRendererAdded",e[e.MediaRendererUpdated="MediaRendererUpdated"]="MediaRendererUpdated",e[e.MediaRendererRemoved="MediaRendererRemoved"]="MediaRendererRemoved",e[e.BeforeMediaRendererRemoved="BeforeMediaRendererRemoved"]="BeforeMediaRendererRemoved"}(e.HardwareEvents||(e.HardwareEvents={}));!function(e){e[e.VIDEO_QUALITY_HIGH="video_quality_high"]="VIDEO_QUALITY_HIGH",e[e.VIDEO_QUALITY_LOW="video_quality_low"]="VIDEO_QUALITY_LOW",e[e.VIDEO_QUALITY_MEDIUM="video_quality_medium"]="VIDEO_QUALITY_MEDIUM",e[e.VIDEO_SIZE_QQVGA="video_size_qqvga"]="VIDEO_SIZE_QQVGA",e[e.VIDEO_SIZE_QCIF="video_size_qcif"]="VIDEO_SIZE_QCIF",e[e.VIDEO_SIZE_QVGA="video_size_qvga"]="VIDEO_SIZE_QVGA",e[e.VIDEO_SIZE_CIF="video_size_cif"]="VIDEO_SIZE_CIF",e[e.VIDEO_SIZE_nHD="video_size_nhd"]="VIDEO_SIZE_nHD",e[e.VIDEO_SIZE_VGA="video_size_vga"]="VIDEO_SIZE_VGA",e[e.VIDEO_SIZE_SVGA="video_size_svga"]="VIDEO_SIZE_SVGA",e[e.VIDEO_SIZE_HD="video_size_hd"]="VIDEO_SIZE_HD",e[e.VIDEO_SIZE_UXGA="video_size_uxga"]="VIDEO_SIZE_UXGA",e[e.VIDEO_SIZE_FHD="video_size_fhd"]="VIDEO_SIZE_FHD",e[e.VIDEO_SIZE_UHD="video_size_uhd"]="VIDEO_SIZE_UHD"}(e.VideoQuality||(e.VideoQuality={}));var t=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),t}(s.AudioDeviceManager);e.AudioDeviceManager=t;var n=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),t}(s.CameraManager);e.CameraManager=n;var a=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),t}(s.StreamManager);e.StreamManager=a;var c=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),t}(s.IOSCacheManager);e.IOSCacheManager=c}(a=t.Hardware||(t.Hardware={})),t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});!function(e){e[e.Connected="Connected"]="Connected",e[e.Disconnected="Disconnected"]="Disconnected",e[e.Failed="Failed"]="Failed",e[e.ProgressToneStart="ProgressToneStart"]="ProgressToneStart",e[e.ProgressToneStop="ProgressToneStop"]="ProgressToneStop",e[e.MessageReceived="onSendMessage"]="MessageReceived",e[e.InfoReceived="InfoReceived"]="InfoReceived",e[e.TransferComplete="TransferComplete"]="TransferComplete",e[e.TransferFailed="TransferFailed"]="TransferFailed",e[e.ICETimeout="ICETimeout"]="ICETimeout",e[e.RTCStatsReceived="RTCStatsReceived"]="RTCStatsReceived",e[e.CallStatsReceived="CallStatsReceived"]="CallStatsReceived",e[e.MediaElementCreated="MediaElementCreated"]="MediaElementCreated",e[e.MediaElementRemoved="MediaElementRemoved"]="MediaElementRemoved",e[e.ICECompleted="ICECompleted"]="ICECompleted",e[e.Updated="Updated"]="Updated",e[e.PendingUpdate="PendingUpdate"]="PendingUpdate",e[e.UpdateFailed="UpdateFailed"]="UpdateFailed",e[e.LocalVideoStreamAdded="LocalVideoStreamAdded"]="LocalVideoStreamAdded",e[e.EndpointAdded="EndpointAdded"]="EndpointAdded",e[e.StateUpdated="StateUpdated"]="StateUpdated",e[e.ActiveUpdated="ActiveUpdated"]="ActiveUpdated",e[e.QualityIssueCodecMismatch="QualityIssueCodecMismatch"]="QualityIssueCodecMismatch",e[e.QualityIssueHighMediaLatency="QualityIssueHighMediaLatency"]="QualityIssueHighMediaLatency",e[e.QualityIssueICEDisconnected="QualityIssueICEDisconnected"]="QualityIssueICEDisconnected",e[e.QualityIssueLocalVideoDegradation="QualityIssueLocalVideoDegradation"]="QualityIssueLocalVideoDegradation",e[e.QualityIssueLowBandwidth="QualityIssueLowBandwidth"]="QualityIssueLowBandwidth",e[e.QualityIssueNoAudioSignal="QualityIssueNoAudioSignal"]="QualityIssueNoAudioSignal",e[e.QualityIssuePacketLoss="QualityIssuePacketLoss"]="QualityIssuePacketLoss"}(t.CallEvents||(t.CallEvents={}))},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,t,n,r){var i,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":o(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(a<3?i(s):a>3?i(t,n,s):i(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(t,"__esModule",{value:!0});var s=n(12),c=n(5),l=n(2),u=n(16),d=n(11),f=n(13),g=n(0),p=n(10),v=n(1),h=n(30),m=n(59),y=n(3),C=n(14),_=n(40),S=n(25),E=n(60),L=n(24),b=n(31),M=n(4),R=n(61),T=M.default.StreamManager,k=function(){function e(){var t=this;r(this,e),this.protocolVersion="3",this._h264first=!1,this.iceServers={},this._calls={},this.callStats=R.CallStatsManager.get(),this.voxSignaling=l.VoxSignaling.get(),this.logger=g.LogManager.get().createLogger(g.LogCategory.SIGNALING,this._traceName()),this.voxSignaling.addHandler(this),this.voxSignaling.setRPCHandler(C.RemoteEvent.handleIncomingConnection,function(e,n,r,i,o){t.handleIncomingConnection(e,n,r,i,o)}),this.voxSignaling.setRPCHandler(C.RemoteEvent.onICEConfig,function(e,n){t.onICEResult(e,!0,n)}),this.voxSignaling.setRPCHandler(C.RemoteEvent.onICEConfigFailed,function(e){t.onICEResult(e,!1)}),this.voxSignaling.setRPCHandler(C.RemoteEvent.handleConnectionConnected,function(e,n,r,i){t.handleConnectionConnected(e,n,r)}),this.voxSignaling.setRPCHandler(C.RemoteEvent.handleConnectionDisconnected,function(e,n,r){t.handleConnectionDisconnected(e,n,r)}),this.voxSignaling.setRPCHandler(C.RemoteEvent.handleRingOut,function(e){t.handleRingOut(e)}),this.voxSignaling.setRPCHandler(C.RemoteEvent.stopRinging,function(e){t.stopRinging(e)}),this.voxSignaling.setRPCHandler(C.RemoteEvent.handleConnectionFailed,function(e,n,r,i){t.handleConnectionFailed(e,n,r,i)}),this.voxSignaling.setRPCHandler(C.RemoteEvent.handleSIPInfo,function(e,n,r,i,o){t.handleSIPInfo(e,n,r,i,o)}),this.voxSignaling.setRPCHandler(C.RemoteEvent.handleSipEvent,function(e){t.handleSipEvent(e)}),this.voxSignaling.setRPCHandler(C.RemoteEvent.handleTransferStarted,function(e){t.handleTransferStarted(e)}),this.voxSignaling.setRPCHandler(C.RemoteEvent.handleTransferComplete,function(e){t.handleTransferComplete(e)}),this.voxSignaling.setRPCHandler(C.RemoteEvent.handleTransferFailed,function(e){t.handleTransferFailed(e)}),this.voxSignaling.setRPCHandler(C.RemoteEvent.handleReInvite,function(e,n,r,i){var o=JSON.parse(i);t.handleInReinvite(e,n,r,o)}),this.voxSignaling.setRPCHandler(C.RemoteEvent.handleAcceptReinvite,function(e,n,r){t.handleReinvite(e,n,r)}),this.voxSignaling.setRPCHandler(C.RemoteEvent.handleRejectReinvite,function(e,n,r){t.handleRejectReinvite(e,n,r)}),this.voxSignaling.setRPCHandler(C.RemoteEvent.startEarlyMedia,function(e,n,r){t.startEarlyMedia(e,n,r)})}return i(e,[{key:"call",value:function(t){var n=this;this.checkMaximumCallCount();var r={number:null,video:{sendVideo:!1,receiveVideo:!1},customData:null,extraHeaders:{},wiredLocal:!0,wiredRemote:!0,H264first:this._h264first,VP8first:!1,forceActive:!1,extraParams:{}},i=u.Utils.mixObjectToLeft(r,t);i=e.addCustomDataToHeaders(i);var o=u.Utils.generateUUID();if(this._calls[o])throw this.logger.error("Call "+o+" already exists"),new Error("Internal error");var a=this.getCallInstance(o,d.Authenticator.get().displayName,!1,i);S.CallstatsIo.isModuleEnabled()&&(i.extraHeaders[f.Constants.CALLSTATSIOID_HEADER]=o),i.H264first&&(a.rearangeCodecs=E.CodecSorterHelpers.H264Sorter);var s=!1;return a.settings.active=!0,Object.keys(this._calls).length>1&&!i.forceActive&&(a.setActiveForce(!1),s=!0),void 0===i.extraHeaders[f.Constants.DIRECT_CALL_HEADER]&&"2"==this.protocolVersion?this.voxSignaling.callRemoteFunction(y.RemoteFunction.createCall,-1,i.number,i.video,o,null,null,i.extraHeaders,i.extraParams):p.PCFactory.get().setupDirectPC(o,h.PeerConnectionMode.P2P,t.video,s).then(function(e){a.peerConnection=p.PCFactory.get().peerConnections[o];var t={tracks:a.peerConnection.getTrackKind(e.sdp)};n.voxSignaling.callRemoteFunction(y.RemoteFunction.createCall,-1,i.number,!0,o,null,null,i.extraHeaders,"",e.sdp,t)}).catch(function(e){n.handleConnectionFailed(a.id(),403,"Media access denied",{})}),a.sendVideo(i.video.sendVideo),a}},{key:"callConference",value:function(t){var n=this;this.checkMaximumCallCount();var r={number:null,video:{sendVideo:!1,receiveVideo:!1},customData:null,extraHeaders:{},wiredLocal:!0,wiredRemote:!0,H264first:this._h264first,VP8first:!1,forceActive:!1,extraParams:{}},i=u.Utils.mixObjectToLeft(r,t);i=e.addCustomDataToHeaders(i);var o=u.Utils.generateUUID();if(this._calls[o])throw this.logger.error("Call "+o+" already exists"),new Error("Internal error");var a=this.getCallInstance(o,d.Authenticator.get().displayName,!1,i);S.CallstatsIo.isModuleEnabled()&&(i.extraHeaders[f.Constants.CALLSTATSIOID_HEADER]=o),i.H264first&&(a.rearangeCodecs=E.CodecSorterHelpers.H264ConfSorter);var s=!1;return a.settings.active=!0,a.settings.isConference=!0,Object.keys(this._calls).length>1&&!i.forceActive&&(a.setActiveForce(!1),s=!0),p.PCFactory.get().setupDirectPC(o,h.PeerConnectionMode.CONFERENCE,t.video,s).then(function(e){a.peerConnection=p.PCFactory.get().peerConnections[o];var t={tracks:a.peerConnection.getTrackKind(e.sdp)};n.voxSignaling.callRemoteFunction(y.RemoteFunction.callConference,-1,i.number,!0,o,null,null,i.extraHeaders,"",e.sdp,t)}).catch(function(e){n.handleConnectionFailed(a.id(),403,"Media access denied",{})}),a.sendVideo(i.video.sendVideo),a}},{key:"checkMaximumCallCount",value:function(){if(Object.keys(this.calls).length>199)throw new Error("The max calls number limit has been reached.")}},{key:"isSDPHasVideo",value:function(e){var t=e.indexOf("m=video");if(-1===t)return!1;var n=e.indexOf("a=sendrecv",t),r=e.indexOf("a=sendonly",t),i=e.indexOf("m=",t);return-1!==n&&(n<i||-1===i)||-1!==r&&(r<i||-1===i)}},{key:"handleConnectionFailed",value:function(e,t,n,r){var i=this.findCall(e,"handleConnectionFailed");i&&"object"===(void 0===i?"undefined":o(i))&&(this.removeCall(e),v.Client.getInstance().stopProgressTone(),i.onFailed(t,n,r))}},{key:"onSignalingConnected",value:function(){}},{key:"onSignalingClosed",value:function(){for(var e in this._calls)this._calls.hasOwnProperty(e)&&(this._calls[e].hangup(),this._calls[e].onFailed(409,"Connection Closed",{}));this._calls={}}},{key:"onSignalingConnectionFailed",value:function(e){}},{key:"onMediaConnectionFailed",value:function(){}},{key:"transferCall",value:function(e,t){for(var n=[e,t],r=0;r<n.length;r++){var i=this._calls[n[r].id()];if(!i)return void this.logger.error("trying to transfer unknown call "+i.id());if(i.stateValue!=s.CallState.CONNECTED)return void this.logger.error("trying to transfer call "+i.id()+" in state "+i.state())}this.voxSignaling.callRemoteFunction(y.RemoteFunction.transferCall,e.id(),t.id())}},{key:"removeCall",value:function(e){this.callStats.deleteCall(this._calls[e]),delete this._calls[e],M.default.StreamManager.get().updateLocalVideo(),0===Object.keys(this._calls).length&&T.clearUmCache()}},{key:"setProtocolVersion",value:function(e){this.protocolVersion=e}},{key:"setAllCallsVolume",value:function(e){for(var t in this._calls)this._calls.hasOwnProperty(t)&&b.EndpointManager.get().setCallVolume(this._calls[t],e)}},{key:"useVideoSource",value:function(e){var t=this,n=Object.keys(this._calls).length;return new Promise(function(r,i){for(var o in t._calls)if(t._calls.hasOwnProperty(o)){var a=t._calls[o];M.default.CameraManager.get().setCallVideoSettings(a,Object.assign({},M.default.CameraManager.get().getCallVideoSettings(a),{cameraId:e})),M.default.StreamManager.get().updateCallStream(a).then(function(e){--n<=0&&r()},function(e){i(e)})}})}},{key:"setVideoSettings",value:function(e){var t=this,n=Object.keys(this._calls).length;return new Promise(function(r,i){0===n&&r();for(var o in t._calls)if(t._calls.hasOwnProperty(o)){var a=t._calls[o];M.default.CameraManager.get().setCallVideoSettings(a,M.default.CameraManager.legacyParamConverter(e)).then(function(e){--n<=0&&r()},function(e){i(e)})}})}},{key:"useAudioSource",value:function(e){var t=this,n=Object.keys(this._calls).length;return new Promise(function(r,i){0===n&&r();for(var o in t._calls)if(t._calls.hasOwnProperty(o)){var a=t._calls[o];M.default.AudioDeviceManager.get().setCallAudioSettings(a,Object.assign({},M.default.AudioDeviceManager.get().getCallAudioSettings(a),{inputId:e})).then(function(e){--n<=0&&r()},function(e){i(e)})}})}},{key:"handleIncomingConnection",value:function(e,t,n,r,i){if(this._calls[e])throw this.logger.error("Call "+e+" already exists"),new Error("Internal error");var o=L.SDPMuggle.detectDirections(i),a=o.some(function(e){return"video"===e.type&&("sendonly"===e.direction||"sendrecv"===e.direction)}),s={number:t,extraHeaders:r,video:a,wiredLocal:!0,wiredRemote:!0,forceActive:!1},c=this.getCallInstance(e,n,!0,s);this._h264first&&(c.rearangeCodecs=E.CodecSorterHelpers.H264Sorter);var l=!1;if(c.settings.active=!0,Object.keys(this._calls).length>1&&(c.setActiveForce(!1),l=!0),v.Client.getInstance().onIncomingCall(e,t,n,r,this.isSDPHasVideo(i)),void 0===s.extraHeaders[f.Constants.DIRECT_CALL_HEADER]&&"2"==this.protocolVersion)c.peerConnection=p.PCFactory.get().getPeerConnect(e);else{var u=[];-1===i.indexOf("VIMS")&&(u=this.iceServers[e]),p.PCFactory.get().incomeDirectPC(e,{receiveVideo:!0,sendVideo:!0},i,l,u).then(function(e){c.peerConnection=e})}}},{key:"getCallInstance",value:function(e,t,n,r){var i=void 0;return i="3"==this.protocolVersion?new _.CallExMedia(e,t,n,r):void 0!==r.extraHeaders[f.Constants.DIRECT_CALL_HEADER]?new _.CallExMedia(e,t,n,r):new m.CallExServer(e,t,n,r),this._calls[e]=i,this.callStats.addCall(i),b.EndpointManager.get().registerCall(i),i}},{key:"findCall",value:function(e,t){var n=this._calls[e];return""===e&&(n=this._calls[Object.keys(this._calls)[0]]),void 0===n?("onICEResult"!==t&&this.logger.warning("Received "+t+" for unknown call "+e),null):n}},{key:"handleRingOut",value:function(e){var t=this.findCall(e,"handleRingOut");void 0!==t&&(v.Client.getInstance().playProgressTone(!0),t.onRingOut(),t.canStartSendingCandidates())}},{key:"handleConnectionConnected",value:function(e,t,n){this.logger.info("handleConnectionConnected(), received SDP: \n"+n);var r=this.findCall(e,"handleConnectionConnected");if(r.signalingConnected=!0,r.canStartSendingCandidates(),void 0!==r&&(r.onConnected(t,n),M.default.StreamManager.get().updateLocalVideo(),void 0!==n&&n.length>0)){var i=n.indexOf("m=video");if(-1!==i){var o=n.indexOf("a=sendrecv",i),a=n.indexOf("a=sendonly",i),s=n.indexOf("a=recvonly",i),c=n.indexOf("a=inactive",i);-1===o&&-1===a&&-1===s&&-1===c&&(n+="a=inactive\r\n")}r.peerConnection.processRemoteAnswer(t,n)}}},{key:"onICEResult",value:function(e,t,n){if(t){this.iceServers[e]=n;var r=this.findCall(e,"onICEResult");r&&r.peerConnection.setConfiguration(Object.assign({},r.peerConnection.getConfiguration(),{iceServers:n}))}}},{key:"startEarlyMedia",value:function(e,t,n){this.logger.info("startEarlyMedia(), received SDP: \n"+n);var r=this.findCall(e,"startEarlyMedia");r.settings.hasEarlyMedia=!0,void 0!==n&&r.peerConnection.processRemoteAnswer(t,n),v.Client.getInstance().stopProgressTone()}},{key:"handleConnectionDisconnected",value:function(e,t,n){var r=this,i=this.findCall(e,"handleConnectionDisconnected");i&&(v.Client.getInstance().stopProgressTone(),i.onDisconnected(t,n).then(function(){return r.removeCall(e)}).catch(function(t){r.logger.error("Can't remove the call "+e+": "+t.message)}))}},{key:"handleSIPInfo",value:function(e,t,n,r,i){var o=this.findCall(e,"handleSIPInfo");void 0!==o&&o.onInfo(o,t,n,r,i)}},{key:"stopRinging",value:function(e){var t=this.findCall(e,"stopRinging");t.canStartSendingCandidates(),void 0!==t&&(v.Client.getInstance().stopProgressTone(),t.onStopRinging())}},{key:"handleSipEvent",value:function(e){}},{key:"handleTransferStarted",value:function(e){}},{key:"handleTransferComplete",value:function(e){var t=this.findCall(e,"handleTransferComplete");void 0!==t&&t.onTransferComplete()}},{key:"handleTransferFailed",value:function(e){var t=this.findCall(e,"handleTransferFailed");void 0!==t&&t.onTransferFailed()}},{key:"handleReinvite",value:function(e,t,n){var r=this.findCall(e,"handleReinvite");if(void 0!==r){var i=this.isSDPHasVideo(n);r.peerConnection.handleReinvite(t,n,i)}}},{key:"handleRejectReinvite",value:function(e,t,n){var r=this.findCall(e,"handleReinvite");void 0!==r&&r.dispatchEvent({code:20,call:r})}},{key:"handleInReinvite",value:function(e,t,n,r){var i=this.findCall(e,"handleReinvite");void 0!==i&&(b.EndpointManager.get().setEndpointDescription(i,r),this.logger.info("handleInReinvite(), received SDP: \n"+n),i.runIncomingReInvite(t,n),i.dispatchEvent({name:c.CallEvents.PendingUpdate,result:!0,call:i}))}},{key:"recalculateNumCalls",value:function(){this._numCalls=0;for(var e in this._calls)this._calls.hasOwnProperty(e)&&this._numCalls++}},{key:"_traceName",value:function(){return"CallManager"}},{key:"calls",get:function(){return this._calls}},{key:"numCalls",get:function(){return this._numCalls}}],[{key:"get",value:function(){return void 0===this.inst&&(this.inst=new e),this.inst}},{key:"cleanHeaders",value:function(e){var t={};for(var n in e)"X-"!=n.substring(0,2)&&n!=f.Constants.CALL_DATA_HEADER||(t[n]=e[n]);return t}},{key:"addCustomDataToHeaders",value:function(e){return void 0!==e.customData&&(void 0===e.extraHeaders&&(e.extraHeaders={}),e.extraHeaders["VI-CallData"]=e.customData),e}}]),e}();a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],k.prototype,"call",null),a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],k.prototype,"handleConnectionFailed",null),a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],k.prototype,"onSignalingConnected",null),a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],k.prototype,"onSignalingClosed",null),a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],k.prototype,"onSignalingConnectionFailed",null),a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],k.prototype,"removeCall",null),a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],k.prototype,"setAllCallsVolume",null),a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],k.prototype,"useVideoSource",null),a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],k.prototype,"setVideoSettings",null),a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],k.prototype,"useAudioSource",null),a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],k.prototype,"handleIncomingConnection",null),a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],k.prototype,"findCall",null),a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],k.prototype,"handleRingOut",null),a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],k.prototype,"handleConnectionConnected",null),a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],k.prototype,"onICEResult",null),a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],k.prototype,"handleConnectionDisconnected",null),a([g.LogManager.d_trace(g.LogCategory.CALLEXSERVER)],k.prototype,"handleSIPInfo",null),a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],k.prototype,"stopRinging",null),a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],k.prototype,"handleSipEvent",null),a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],k.prototype,"handleTransferStarted",null),a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],k.prototype,"handleTransferComplete",null),a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],k.prototype,"handleTransferFailed",null),a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],k.prototype,"handleReinvite",null),a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],k.prototype,"handleRejectReinvite",null),a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],k.prototype,"handleInReinvite",null),a([g.LogManager.d_trace(g.LogCategory.CALLMANAGER)],k,"addCustomDataToHeaders",null),t.CallManager=k},function(e,t,n){"use strict";function r(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}var i=!0,o=!0;e.exports={extractVersion:r,disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(i=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(o=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){if("object"==typeof window){if(i)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(e,t){o&&console.warn(e+" is deprecated, please use "+t+" instead.")},detectBrowser:function(e){var t=e&&e.navigator,n={};if(n.browser=null,n.version=null,void 0===e||!e.navigator)return n.browser="Not a browser.",n;if(t.mozGetUserMedia)n.browser="firefox",n.version=r(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia)if(e.webkitRTCPeerConnection)n.browser="chrome",n.version=r(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!t.userAgent.match(/Version\/(\d+).(\d+)/))return n.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",n;n.browser="safari",n.version=r(t.userAgent,/AppleWebKit\/(\d+)\./,1)}else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))n.browser="edge",n.version=r(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!t.mediaDevices||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return n.browser="Not a supported browser.",n;n.browser="safari",n.version=r(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return n}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});!function(e){e[e.SDKReady="SDKReady"]="SDKReady",e[e.ConnectionEstablished="ConnectionEstablished"]="ConnectionEstablished",e[e.ConnectionFailed="ConnectionFailed"]="ConnectionFailed",e[e.ConnectionClosed="ConnectionClosed"]="ConnectionClosed",e[e.AuthResult="AuthResult"]="AuthResult",e[e.RefreshTokenResult="RefreshTokenResult"]="RefreshTokenResult",e[e.PlaybackFinished="PlaybackFinished"]="PlaybackFinished",e[e.MicAccessResult="MicAccessResult"]="MicAccessResult",e[e.IncomingCall="IncomingCall"]="IncomingCall",e[e.SourcesInfoUpdated="SourcesInfoUpdated"]="SourcesInfoUpdated",e[e.NetStatsReceived="NetStatsReceived"]="NetStatsReceived",e[e.SIPRegistrationSuccessful="SIPRegistrationSuccessful"]="SIPRegistrationSuccessful",e[e.SIPRegistrationFailed="SIPRegistrationFailed"]="SIPRegistrationFailed",e[e.ACDStatusUpdated="ACDStatusUpdated"]="ACDStatusUpdated",e[e.SQMessagingStatusUpdated="SQMessagingStatusUpdated"]="SQMessagingStatusUpdated",e[e.ACDError="ACDError"]="ACDError",e[e.SQError="SQError"]="SQError",e[e.PlaybackError="PlaybackError"]="PlaybackError"}(t.Events||(t.Events={}))},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Object.defineProperty(t,"__esModule",{value:!0});var i,o=n(0),a=n(49),s=n(50),c=n(51),l=n(17),u=n(52),d=n(1),f=n(53),g=n(54);!function(e){function t(e,t,n){var i=e;return"object"!=(void 0===i?"undefined":r(i))&&(i={}),i[t]={ideal:n},i}function n(e,t,n,r){switch(o.LogManager.get().writeMessage(o.LogCategory.RTC,"Core",o.LogLevel.INFO,"Create WebRTC on the "+JSON.stringify(L)),E){case S.Firefox:case S.Webkit:case S.Safari:case S.Edge:return new g.TransreceiverPC(e,t,n,r);default:return o.LogManager.get().writeMessage(o.LogCategory.RTC,"Core",o.LogLevel.INFO,"Unsupported browser "+navigator.userAgent),null}}function i(){return!(!d.Client.getInstance().config().experiments||!d.Client.getInstance().config().experiments.emulate_ios)||(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i))}function p(){return E===S.Firefox||E===S.Webkit||E===S.Safari}function v(e,t){return new l.SignalingDTMFSender(t)}function h(){return new Promise(function(e){e(!1)})}function m(e){var n=!1,r=!1;return e.audioEnabled&&(n=!0,e.audioInputId&&(n=t(n,"deviceId",e.audioInputId))),e.videoEnabled&&(r=!0,e.videoSettings&&(r=e.videoSettings),e.videoInputId&&(r=t(r,"deviceId",e.videoInputId))),{peerIdentity:null,audio:n,video:r}}function y(){if(!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0]))return"voxmobile";switch(E||C(),E){case S.Firefox:return"firefox";case S.Webkit:return"chrome";case S.Safari:return"safari";case S.Edge:return"edge";default:return""}}function C(){navigator.mozGetUserMedia?E=S.Firefox:navigator.webkitGetUserMedia?E=S.Webkit:navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)?E=S.Edge:navigator.getUserMedia&&(E=S.Safari)}function _(){switch(E||C(),E&&o.LogManager.get().writeMessage(o.LogCategory.RTC,"Core",o.LogLevel.INFO,"Detected browser "+S[E]),e.getDTMFSender=v,e.screenSharingSupported=h,E){case S.Firefox:e.attachMedia=a.FF.attachStream,e.detachMedia=a.FF.detachStream,e.getScreenMedia=a.FF.getScreenMedia,e.getRTCStats=a.FF.getRTCStats,e.screenSharingSupported=a.FF.screenSharingSupported,e.getDTMFSender=a.FF.getDTMFSender;break;case S.Webkit:e.attachMedia=s.Webkit.attachStream,e.detachMedia=s.Webkit.detachStream,e.getScreenMedia=s.Webkit.getScreenMedia,e.getRTCStats=s.Webkit.getRTCStats,e.screenSharingSupported=s.Webkit.screenSharingSupported,e.getDTMFSender=s.Webkit.getDTMFSender;break;case S.Safari:e.attachMedia=u.Safari.attachStream,e.detachMedia=u.Safari.detachStream,e.getScreenMedia=u.Safari.getScreenMedia,e.getRTCStats=u.Safari.getRTCStats,e.screenSharingSupported=u.Safari.screenSharingSupported,e.getDTMFSender=u.Safari.getDTMFSender;break;case S.Edge:e.attachMedia=c.Edge.attachStream,e.detachMedia=c.Edge.detachStream,e.getScreenMedia=c.Edge.getScreenMedia,e.screenSharingSupported=c.Edge.screenSharingSupported,e.getRTCStats=c.Edge.getRTCStats;break;default:o.LogManager.get().writeMessage(o.LogCategory.RTC,"Core",o.LogLevel.INFO,"Unsupported browser "+navigator.userAgent)}e.composeConstraints=m}var S=void 0;!function(e){e[e.Firefox=1]="Firefox",e[e.Webkit=2]="Webkit",e[e.Edge=3]="Edge",e[e.Safari=4]="Safari"}(S||(S={}));var E=void 0,L=f.getParser(window.navigator.userAgent);e.peerConnectionFactory=n,e.isIphone=i,e.isScreenSharingSupported=p,e.getWSVendor=y,e.init=_}(i||(i={})),t.default=i},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,t,n,r){var i,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":o(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(a<3?i(s):a>3?i(t,n,s):i(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(t,"__esModule",{value:!0});var s=n(30),c=n(2),l=n(0),u=n(6),d=n(12),f=n(9),g=n(3),p=n(14),v=n(1),h=n(4),m=n(24),y=function(){function e(){var t=this;r(this,e),this.iceConfig=null,this._peerConnections={},this.waitingPeerConnections={},this.logger=l.LogManager.get().createLogger(l.LogCategory.RTC,this._traceName()),this._requireMedia=!0,"firefox"===f.default.getWSVendor()&&(e.hasTransceivers=!0),c.VoxSignaling.get().setRPCHandler(p.RemoteEvent.createPC,function(e,n){t.rpcHandlerCreatePC(e,n)}),c.VoxSignaling.get().setRPCHandler(p.RemoteEvent.destroyPC,function(e){t.rpcHandlerDestroyPC(e)}),c.VoxSignaling.get().addHandler(this)}return i(e,[{key:"setupDirectPC",value:function(e,t,n,r){var i=this,o=f.default.peerConnectionFactory(e,t,n),a=u.CallManager.get().calls[e];if(o){o.setHoldKey(r);v.Client.getInstance().config();return h.default.StreamManager.get().getCallStream(a).then(function(t){return null!==t&&o.fastAddCustomMedia(t),i._peerConnections[e]=o,o.getLocalOffer()})}u.CallManager.get().handleConnectionFailed(a.id(),1001,"",{})}},{key:"incomeDirectPC",value:function(e,t,n,r,i){var o=this,a=f.default.peerConnectionFactory(e,s.PeerConnectionMode.P2P,t,i);return a.setHoldKey(r),a._setRemoteDescription(n).then(function(){if(u.CallManager.get().calls[e])return o._peerConnections[e]=a,a;a.close()})}},{key:"getPeerConnect",value:function(e){return this._peerConnections[e]}},{key:"onSignalingConnected",value:function(){}},{key:"onSignalingClosed",value:function(){this.logger.info("Closing all peer connections because signaling connection has closed"),this.waitingPeerConnections={};for(var e in this._peerConnections)this._peerConnections[e].close();this._peerConnections={}}},{key:"onSignalingConnectionFailed",value:function(e){}},{key:"onMediaConnectionFailed",value:function(){}},{key:"closeAll",value:function(){for(var e in this._peerConnections)this._peerConnections[e].close();this._peerConnections={}}},{key:"setBandwidthParams",value:function(e){this._bandwidthParams=e}},{key:"addBandwidthParams",value:function(e){return this._bandwidthParams&&(e.sdp=e.sdp.replace(/(a=mid:video.*\r\n)/g,"$1b=AS:"+this._bandwidthParams+"\r\n")),e}},{key:"rpcHandlerCreatePC",value:function(t,n){this.logger.info("rpcHandlerCreatePC(), received SDP: \n"+n.replace("<br>","\n\r")),n=m.SDPMuggle.addSetupAttribute(n);var r=e.sdpOffersVideo(n),i=s.PeerConnectionMode.CLIENT_SERVER_V1;c.VoxSignaling.get().callRemoteFunction(g.RemoteFunction.muteLocal,t,!1);var o=f.default.peerConnectionFactory(t,i,r);this._peerConnections[t]=o;var a=u.CallManager.get().calls[t];h.default.StreamManager.get().getCallStream(a).then(function(e){"__default"===t&&(n=n.replace("a=sendrecv","a=recvonly")),o.fastAddCustomMedia(e),o.processRemoteOffer(n).then(function(e){void 0===a||a.checkCallMode(d.CallMode.SERVER)?c.VoxSignaling.get().callRemoteFunction(g.RemoteFunction.confirmPC,t,e):c.VoxSignaling.get().callRemoteFunction(g.RemoteFunction.acceptCall,[t,u.CallManager.cleanHeaders(a.headers()),e]),"__default"!==t&&void 0!==u.CallManager.get().calls[t]&&(u.CallManager.get().calls[t].peerConnection=o)})}).catch(function(e){void 0!==a?u.CallManager.get().handleConnectionFailed(a.id(),403,"Media access denied",{}):c.VoxSignaling.get().onConnectionFailedRPC()})}},{key:"rpcHandlerDestroyPC",value:function(e){var t=this;this._peerConnections[e]&&("__default"===e?setTimeout(function(){t._peerConnections[e].close(),delete t._peerConnections[e]},200):(this._peerConnections[e].close(),delete this._peerConnections[e])),delete this.waitingPeerConnections[e]}},{key:"_traceName",value:function(){return"PCFactory"}},{key:"peerConnections",get:function(){return this._peerConnections}},{key:"requireMedia",get:function(){return this._requireMedia},set:function(e){this._requireMedia=e}}],[{key:"get",value:function(){return null===this.inst&&(this.inst=new e),this.inst}},{key:"sdpOffersVideo",value:function(e){return{receiveVideo:-1!==e.indexOf("m=video"),sendVideo:!0}}}]),e}();y.inst=null,y.hasTransceivers=!1,a([l.LogManager.d_trace(l.LogCategory.PCFACTORY)],y.prototype,"setupDirectPC",null),a([l.LogManager.d_trace(l.LogCategory.PCFACTORY)],y.prototype,"incomeDirectPC",null),a([l.LogManager.d_trace(l.LogCategory.PCFACTORY)],y.prototype,"getPeerConnect",null),a([l.LogManager.d_trace(l.LogCategory.PCFACTORY)],y.prototype,"onSignalingConnected",null),a([l.LogManager.d_trace(l.LogCategory.PCFACTORY)],y.prototype,"onSignalingClosed",null),a([l.LogManager.d_trace(l.LogCategory.PCFACTORY)],y.prototype,"onSignalingConnectionFailed",null),a([l.LogManager.d_trace(l.LogCategory.PCFACTORY)],y.prototype,"onMediaConnectionFailed",null),a([l.LogManager.d_trace(l.LogCategory.PCFACTORY)],y.prototype,"closeAll",null),a([l.LogManager.d_trace(l.LogCategory.PCFACTORY)],y.prototype,"setBandwidthParams",null),a([l.LogManager.d_trace(l.LogCategory.PCFACTORY)],y.prototype,"addBandwidthParams",null),a([l.LogManager.d_trace(l.LogCategory.PCFACTORY)],y.prototype,"rpcHandlerCreatePC",null),a([l.LogManager.d_trace(l.LogCategory.PCFACTORY)],y.prototype,"rpcHandlerDestroyPC",null),a([l.LogManager.d_trace(l.LogCategory.PCFACTORY)],y,"sdpOffersVideo",null),t.PCFactory=y},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,t,n,r){var i,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":o(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(a<3?i(s):a>3?i(t,n,s):i(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(t,"__esModule",{value:!0});var s,c=n(2),l=n(0),u=n(10),d=n(3),f=n(14),g=n(25),p=n(1),v=n(44),h=n(65),m=n(45);!function(e){e[e.IDLE=0]="IDLE",e[e.IN_PROGRESS=1]="IN_PROGRESS"}(s=t.AuthenticatorState||(t.AuthenticatorState={}));var y=function(){function e(){var t=this;r(this,e),this.FAIL_CODE_SECOND_STAGE=301,this.FAIL_CODE_ONE_TIME_KEY=302,this._displayName=null,this._username=null,this._authorized=!1,this.signaling=c.VoxSignaling.get(),this.currentState=s.IDLE,this.logger=l.LogManager.get().createLogger(l.LogCategory.SIGNALING,this._traceName()),this.signaling.setRPCHandler(f.RemoteEvent.loginFailed,function(e,n){t.onLoginFailed(e,n)}),this.signaling.setRPCHandler(f.RemoteEvent.loginSuccessful,function(e,n){t.onLoginSuccesful(e,n)}),this.signaling.setRPCHandler(f.RemoteEvent.refreshOauthTokenFailed,function(e){t.handler.onRefreshTokenFailed(e)}),this.signaling.setRPCHandler(f.RemoteEvent.refreshOauthTokenSuccessful,function(e){t.handler.onRefreshTokenSuccess(e.OAuth)}),this.signaling.addHandler(this)}return i(e,[{key:"setHandler",value:function(e){this.handler=e}},{key:"onLoginFailed",value:function(e,t){switch(this.currentState=s.IDLE,e){case this.FAIL_CODE_ONE_TIME_KEY:this.handler.onOneTimeKeyGenerated(t);break;case this.FAIL_CODE_SECOND_STAGE:this.handler.onSecondStageInitiated();break;default:this.handler.onLoginFailed(e)}}},{key:"onLoginSuccesful",value:function(e,t){this.currentState=s.IDLE,this._authorized=!0,u.PCFactory.get().iceConfig=t.iceConfig,v.default.setConnectionId(t.connectionId),m.default.setConnectionId(t.connectionId),p.Client.getInstance().setConnectionData(null,t.connectionId),this._displayName=e,g.CallstatsIo.get().init({userName:this._username,aliasName:this._displayName}),this.handler.onLoginSuccessful(e,t.OAuth)}},{key:"basicLogin",value:function(e,t,n){if(this.currentState!=s.IDLE)return void this.logger.error("Login operation already in progress");this._username=e,this.currentState=s.IN_PROGRESS;var r=t;if("md5"===n.credentialType){var i=e.split("@")[0];r=h.Md5.hashStr(i+":voximplant.com:"+t).toString()}this.signaling.callRemoteFunction(d.RemoteFunction.login,e,r,n)}},{key:"tokenLogin",value:function(e,t){if(this.currentState!=s.IDLE)return void this.logger.error("Login operation already in progress");this._username=e,this.currentState=s.IN_PROGRESS,this.signaling.callRemoteFunction(d.RemoteFunction.login,e,"",t)}},{key:"tokenRefresh",value:function(e,t,n){n?this.signaling.callRemoteFunction(d.RemoteFunction.refreshOauthToken,e,{refreshToken:t,deviceToken:n}):this.signaling.callRemoteFunction(d.RemoteFunction.refreshOauthToken,e,t)}},{key:"loginUsingOneTimeKey",value:function(e,t,n){if(this.currentState!=s.IDLE)return void this.logger.error("Login operation already in progress");this._username=e,this.currentState=s.IN_PROGRESS,this.signaling.callRemoteFunction(d.RemoteFunction.loginUsingOneTimeKey,e,t,n)}},{key:"loginStage2",value:function(e,t,n){if(this.currentState!=s.IDLE)return void this.logger.error("Login operation already in progress");this._username=e,this.currentState=s.IN_PROGRESS,this.signaling.callRemoteFunction(d.RemoteFunction.loginStage2,e,t,n)}},{key:"generateOneTimeKey",value:function(e){if(this.currentState!=s.IDLE)return void this.logger.error("Login operation already in progress");this.currentState=s.IN_PROGRESS,this.signaling.callRemoteFunction(d.RemoteFunction.loginGenerateOneTimeKey,e)}},{key:"username",value:function(){return this._username}},{key:"authorized",value:function(){return this._authorized}},{key:"onSignalingConnected",value:function(){}},{key:"onSignalingConnectionFailed",value:function(e){}},{key:"onSignalingClosed",value:function(){this._authorized=!1,this._displayName=null,this._username=null}},{key:"onMediaConnectionFailed",value:function(){}},{key:"ziAuthorized",value:function(e){this._authorized=e}},{key:"_traceName",value:function(){return"Authenticator"}},{key:"displayName",get:function(){return this._displayName}}],[{key:"get",value:function(){return void 0===this.inst&&(this.inst=new e),this.inst}}]),e}();a([l.LogManager.d_trace(l.LogCategory.AUTHENTICATOR)],y.prototype,"setHandler",null),a([l.LogManager.d_trace(l.LogCategory.AUTHENTICATOR)],y.prototype,"onLoginFailed",null),a([l.LogManager.d_trace(l.LogCategory.AUTHENTICATOR)],y.prototype,"onLoginSuccesful",null),a([l.LogManager.d_trace(l.LogCategory.AUTHENTICATOR)],y.prototype,"basicLogin",null),a([l.LogManager.d_trace(l.LogCategory.AUTHENTICATOR)],y.prototype,"tokenLogin",null),a([l.LogManager.d_trace(l.LogCategory.AUTHENTICATOR)],y.prototype,"tokenRefresh",null),a([l.LogManager.d_trace(l.LogCategory.AUTHENTICATOR)],y.prototype,"loginUsingOneTimeKey",null),a([l.LogManager.d_trace(l.LogCategory.AUTHENTICATOR)],y.prototype,"loginStage2",null),a([l.LogManager.d_trace(l.LogCategory.AUTHENTICATOR)],y.prototype,"generateOneTimeKey",null),a([l.LogManager.d_trace(l.LogCategory.AUTHENTICATOR)],y.prototype,"username",null),a([l.LogManager.d_trace(l.LogCategory.AUTHENTICATOR)],y.prototype,"authorized",null),a([l.LogManager.d_trace(l.LogCategory.AUTHENTICATOR)],y.prototype,"onSignalingConnected",null),a([l.LogManager.d_trace(l.LogCategory.AUTHENTICATOR)],y.prototype,"onSignalingConnectionFailed",null),a([l.LogManager.d_trace(l.LogCategory.AUTHENTICATOR)],y.prototype,"onSignalingClosed",null),a([l.LogManager.d_trace(l.LogCategory.AUTHENTICATOR)],y.prototype,"onMediaConnectionFailed",null),t.Authenticator=y},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(r)},c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":c(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var u,d=n(5),f=n(2),g=n(13),p=n(0),v=n(10),h=n(6),m=n(9),y=n(3),C=n(1),_=n(18),S=n(31),E=n(4),L=n(34);!function(e){e[e.ALERTING="ALERTING"]="ALERTING",e[e.PROGRESSING="PROGRESSING"]="PROGRESSING",e[e.CONNECTED="CONNECTED"]="CONNECTED",e[e.UPDATING="UPDATING"]="UPDATING",e[e.ENDED="ENDED"]="ENDED"}(u=t.CallState||(t.CallState={}));var b;!function(e){e[e.P2P=0]="P2P",e[e.SERVER=1]="SERVER"}(b=t.CallMode||(t.CallMode={}));var M=function(e){function t(e,n,o,a){r(this,t);var s=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));s.remoteMuteState=!0,s.signalingConnected=!1,s.settings=a,s.settings.id=e,s.settings.displayName=n,s.settings.mode=b.P2P,s.settings.active=!0,s.settings.usedSinkId=null,s.settings.incoming=o,s.settings.state=o?u.ALERTING:u.PROGRESSING;C.Client.getInstance().config();return s.settings.audioDirections={sendAudio:!0},s.settings.videoDirections="boolean"==typeof a.video?{sendVideo:a.video,receiveVideo:!0}:a.video,s.settings.hasEarlyMedia=!1,s.logger=p.LogManager.get().createLogger(p.LogCategory.CALL,"Call "+e),s._callManager=h.CallManager.get(),s}return o(t,e),a(t,[{key:"id",value:function(){return this.settings?this.settings.id:"new"}},{key:"number",value:function(){return this.settings.number}},{key:"displayName",value:function(){return this.settings.displayName}},{key:"headers",value:function(){return this.settings.extraHeaders}},{key:"active",value:function(){return this.settings.active}},{key:"_setActive",value:function(e){var t={call:this,old:this.settings.active,new:e,name:d.CallEvents.ActiveUpdated};return this.settings.active=e,this.dispatchEvent(t),this.muteIncomingStreams(e),e}},{key:"muteIncomingStreams",value:function(e){this.getEndpoints().forEach(function(t){t.mediaRenderers.forEach(function(t){t.stream.getTracks().forEach(function(t){t.enabled=e})})})}},{key:"state",value:function(){return u[this.settings.state]}},{key:"_setState",value:function(e){var t={call:this,old:this.settings.state,new:e,name:d.CallEvents.StateUpdated};return this.settings.state=e,this.dispatchEvent(t),e}},{key:"answer",value:function(e,t,n){if(this.logger.info("answer("+JSON.stringify(n)+")"),void 0!==e&&(void 0!==t&&"object"===(void 0===t?"undefined":c(t))||(t={}),t[g.Constants.CALL_DATA_HEADER]=e),void 0!==n&&(n={sendVideo:C.Client.getInstance().config().videoSupport,receiveVideo:C.Client.getInstance().config().videoSupport}),this.settings.state!=u.ALERTING)throw new Error("WRONG_CALL_STATE");void 0!==n&&this._peerConnection.setVideoFlags(n)}},{key:"decline",value:function(e){if(this.logger.info("decline()"),this.settings.state!=u.ALERTING)throw new Error("WRONG_CALL_STATE");f.VoxSignaling.get().callRemoteFunction(y.RemoteFunction.rejectCall,this.settings.id,!1,h.CallManager.cleanHeaders(e))}},{key:"reject",value:function(e){if(this.logger.info("reject()"),this.settings.state!=u.ALERTING)throw new Error("WRONG_CALL_STATE");f.VoxSignaling.get().callRemoteFunction(y.RemoteFunction.rejectCall,this.settings.id,!0,h.CallManager.cleanHeaders(e))}},{key:"hangup",value:function(e){if(this.logger.info("hangup()"),this.settings.state==u.CONNECTED||this.settings.state==u.UPDATING||this.settings.state==u.PROGRESSING)f.VoxSignaling.get().callRemoteFunction(y.RemoteFunction.disconnectCall,this.settings.id,h.CallManager.cleanHeaders(e));else{if(this.settings.state!=u.ALERTING)throw new Error("WRONG_CALL_STATE");f.VoxSignaling.get().callRemoteFunction(y.RemoteFunction.rejectCall,this.settings.id,!0,h.CallManager.cleanHeaders(e))}}},{key:"sendTone",value:function(e){this.logger.info("sendTone("+e+")"),this.settings.active&&this._peerConnection.sendDTMF(e)}},{key:"mutePlayback",value:function(){this.logger.info("mutePlayback()"),this.remoteMuteState=!1,S.EndpointManager.get().getEndpoints(this).forEach(function(e){e.mediaRenderers.forEach(function(e){e.setVolume(0)})})}},{key:"unmutePlayback",value:function(){this.logger.info("unmutePlayback()"),this.remoteMuteState=!0,S.EndpointManager.get().getEndpoints(this).forEach(function(e){e.mediaRenderers.forEach(function(e){e.setVolume(1)})})}},{key:"restoreRMute",value:function(){var e=this;this.settings.active&&S.EndpointManager.get().getEndpoints(this).forEach(function(t){t.mediaRenderers.forEach(function(t){t.setVolume(e.remoteMuteState?1:0)})})}},{key:"muteMicrophone",value:function(){this.logger.info("muteMicrophone()"),this.peerConnection.muteMicrophone(!0)}},{key:"unmuteMicrophone",value:function(){this.logger.info("unmuteMicrophone()"),this.peerConnection.muteMicrophone(!1)}},{key:"showRemoteVideo",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];void 0===e&&(e=!0);var t=S.EndpointManager.get().getEndpoints(this);t&&t.forEach(function(t){t.mediaRenderers&&t.mediaRenderers.forEach(function(t){t.element&&(t.element.style.display=e?"block":"none")})})}},{key:"setRemoteVideoPosition",value:function(e,t){throw new Error("Deprecated: please use CSS to position '#voximplantcontainer' element")}},{key:"setRemoteVideoSize",value:function(e,t){throw new Error("Deprecated: please use CSS to set size of '#voximplantcontainer' element")}},{key:"sendInfo",value:function(e,t,n){this.logger.info("sendInfo("+e+", "+JSON.stringify(t)+")");var r,i,o=e.indexOf("/");-1==o?(r="application",i=e):(r=e.substring(0,o),i=e.substring(o+1)),f.VoxSignaling.get().callRemoteFunction(y.RemoteFunction.sendSIPInfo,this.settings.id,r,i,t,h.CallManager.cleanHeaders(n))}},{key:"sendMessage",value:function(e){this.logger.info("sendMessage()"),this.sendInfo(g.Constants.ZINGAYA_IM_MIME_TYPE,e,{})}},{key:"setVideoSettings",value:function(e,t,n){this.logger.info("Setting call "+this.id()+" video settings: "+JSON.stringify(e)),E.default.CameraManager.get().setCallVideoSettings(this,E.default.CameraManager.legacyParamConverter(e)),E.default.StreamManager.get().updateCallStream(this).then(function(e){t&&t(e)},function(e){n&&n()})}},{key:"getVideoElementId",value:function(){var e=S.EndpointManager.get().getEndpoints(this);return void 0!==e&&e.forEach(function(e){e.mediaRenderers.forEach(function(e){if(e.stream){if(e.stream.getVideoTracks().length)return e.stream.getTracks()[0].id}})}),""}},{key:"addEventListener",value:function(e,n){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addEventListener",this).call(this,e,n)}},{key:"on",value:function(e,n,r){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"on",this).call(this,e,n)}},{key:"removeEventListener",value:function(e,n){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"removeEventListener",this).call(this,e,n)}},{key:"off",value:function(e,n){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"off",this).call(this,e,n)}},{key:"dispatchEvent",value:function(e){e.name!==d.CallEvents.Updated&&e.name!==d.CallEvents.UpdateFailed||this._setState(u.CONNECTED),s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"dispatchEvent",this).call(this,e)}},{key:"onConnected",value:function(e,t){if(this.signalingConnected)return!!this.checkState([u.PROGRESSING,u.ALERTING],"onConnected")&&(this._setState(u.CONNECTED),this.startTime=Date.now(),this.dispatchEvent({name:"Connected",call:this,headers:e}),!0)}},{key:"onDisconnected",value:function(e,t){var n=this;return new Promise(function(r,i){var o=E.default.StreamManager.get()._getScreenSharing(n);if(o&&o.forEach(function(e){E.default.StreamManager.get()._clearScreenSharing(n,e)}),!n.checkState([u.CONNECTED,u.ALERTING,u.PROGRESSING,u.UPDATING],"onDisconnected"))return i(new Error("Call in the wrong state "+n.state())),!1;n._setState(u.ENDED),S.EndpointManager.get().clear(n).then(function(){r(!0),n.dispatchEvent({name:"Disconnected",call:n,headers:e,params:t})}).catch(function(e){i(new Error("Endpoint manager got some error: "+e.message))})})}},{key:"onFailed",value:function(e,t,n){return this.dispatchEvent({name:"Failed",call:this,headers:n,code:e,reason:t}),this._setState(u.ENDED),S.EndpointManager.get().clear(this),!0}},{key:"onStopRinging",value:function(){return!!this.checkState([u.PROGRESSING,u.CONNECTED],"onStopRinging")&&(this.dispatchEvent({name:"ProgressToneStop",call:this}),!0)}},{key:"onRingOut",value:function(){return!!this.checkState(u.PROGRESSING,"onRingOut")&&(this.dispatchEvent({name:"ProgressToneStart",call:this}),!0)}},{key:"onTransferComplete",value:function(){return!!this.checkState(u.CONNECTED,"onTransferComplete")&&(this.dispatchEvent({name:"TransferComplete",call:this}),!0)}},{key:"onTransferFailed",value:function(){return!!this.checkState(u.CONNECTED,"onTransferFailed")&&(this.dispatchEvent({name:"TransferFailed",call:this}),!0)}},{key:"onInfo",value:function(e,t,n,r,i){var o=this;if(e.stateValue==u.CONNECTED||e.stateValue==u.PROGRESSING||e.stateValue==u.ALERTING||e.stateValue==u.UPDATING){var a=t+"/"+n,s=function(e,t){t?S.EndpointManager.get().endpointInfoUpdated(o,e,t):o.logger.warning("Wrong endpoint info")};if(a==g.Constants.ZINGAYA_IM_MIME_TYPE)this.dispatchEvent({name:"onSendMessage",call:this,text:r});else if(a==g.Constants.P2P_SPD_FRAG_MIME_TYPE){var c=JSON.parse(r);for(var l in c)void 0!==e&&void 0!==e.peerConnection?e.peerConnection.addRemoteCandidate(c[l][1],c[l][0]):this.logger.info("Candidate skipped. Connection not created yet.")}else if(a===g.Constants.VI_CONF_PARTICIPANT_INFO_ADDED||a===g.Constants.VI_CONF_PARTICIPANT_INFO_REMOVED||a===g.Constants.VI_CONF_PARTICIPANT_INFO_UPDATED){var d=JSON.parse(r);s(a,d)}else if(a===g.Constants.VI_CONF_PARTICIPANT_BATCH){var f=JSON.parse(r);f.forEach(function(e){return s(e.mimeType,e.data)})}else this.dispatchEvent({name:"InfoReceived",call:this,body:r,headers:i,mimeType:a});return!0}this.logger.warning("received handleSIPInfo for call: "+e.id()+" in invalid state: "+e.state())}},{key:"setActive",value:function(e){var t=this;return this.logger.info("setActive("+e+")"),new Promise(function(n,r){return e===t.settings.active?void n({name:d.CallEvents.Updated,result:!1,call:t}):"firefox"===m.default.getWSVendor()?(t.sendInfo(g.Constants.VI_HOLD_EMUL,JSON.stringify({hold:!e})),void n({name:d.CallEvents.Updated,call:t,result:!0})):void(t.settings.state==u.CONNECTED?(t._setState(u.UPDATING),t._setActive(e),e?f.VoxSignaling.get().callRemoteFunction(y.RemoteFunction.unhold,t.settings.id):f.VoxSignaling.get().callRemoteFunction(y.RemoteFunction.hold,t.settings.id),n({name:d.CallEvents.Updated,result:!0,call:t})):r({name:d.CallEvents.UpdateFailed,code:11,call:t}))})}},{key:"checkCallMode",value:function(e){return this.settings.mode==e}},{key:"canStartSendingCandidates",value:function(){void 0===this._peerConnection&&(this._peerConnection=v.PCFactory.get().peerConnections[this.settings.id]),this._peerConnection.canStartSendingCandidates()}},{key:"notifyICETimeout",value:function(){this.dispatchEvent({name:"ICETimeout",call:this})}},{key:"sendVideo",value:function(e){var t=this;this.logger.info("sendVideo("+e+")");var n=this.peerConnection?this.peerConnection.getTransceivers().filter(function(e){return e.sender.track&&"video"===e.sender.track.kind}):[],r=E.default.StreamManager.get()._getScreenSharing(this)||[];return this.peerConnection?e&&r.length&&this._replaceVideoSharing?(r.forEach(function(e){E.default.StreamManager.get()._clearScreenSharing(t,e).then(function(){E.default.StreamManager.get().getCallStream(t,!0).then(function(e){var n=e.getVideoTracks();t.peerConnection.replaceVideoTrack(n[0])})})}),this.settings.videoDirections.sendVideo=e,Promise.resolve({call:this,name:d.CallEvents[d.CallEvents.Updated],result:!0})):!0===this.settings.videoDirections.sendVideo&&e||!1===this.settings.videoDirections.sendVideo&&!e&&!n.length?new Promise(function(e,n){e({call:t,name:d.CallEvents[d.CallEvents.Updated],result:!0})}):(this.settings.videoDirections.sendVideo=e,this.peerConnection.enableVideo(e),Promise.resolve({call:this,name:d.CallEvents[d.CallEvents.Updated],result:!0})):new Promise(function(e,n){e({call:t,name:d.CallEvents[d.CallEvents.Updated],result:!0})})}},{key:"receiveVideo",value:function(){var e=this;return this._setState(u.UPDATING),new Promise(function(t,n){if(!0===e.settings.videoDirections.receiveVideo)return void n();e.settings.videoDirections.receiveVideo=!0,e._peerConnection.hdnFRS().then(t,n)})}},{key:"sendMedia",value:function(e,t){var n=this;return this._setState(u.UPDATING),void 0!==e&&null!==e||(e=this.settings.audioDirections.sendAudio),void 0!==t&&null!==t||(t=this.settings.videoDirections.sendVideo),this.peerConnection.sendMedia(e,t).then(function(r){return void 0!==t&&null!==t&&(n.settings.videoDirections.sendVideo=t),void 0!==e&&null!==e&&(n.settings.audioDirections.sendAudio=e),r})}},{key:"sendAudio",value:function(e){var t=this;C.Client.getInstance().config();return this.settings.audioDirections.sendAudio=e,this.peerConnection.hasLocalAudio()?(this.peerConnection.muteMicrophone(!e),new Promise(function(e,n){e({call:t,name:d.CallEvents[d.CallEvents.Updated],result:!0})})):e?this.sendMedia(null,e):void 0}},{key:"getLocalStream",value:function(){return E.default.StreamManager.get().getCallStream(this)}},{key:"setLocalStream",value:function(e){return new Promise(function(e,t){t(new Error("Not implemented"))})}},{key:"shareScreen",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.logger.info("shareScreen(showLocalView: "+t+", replaceVideo: "+n+")"),new Promise(function(r,i){E.default.StreamManager.get()._getScreenSharing(e).length&&(e.logger.warning("Screen sharing already active."),i(new Error("Screen sharing already active."))),e._replaceVideoSharing=n,m.default.isScreenSharingSupported?E.default.StreamManager.get()._newScreenSharing(e,t,n).then(function(t){e._replaceVideoSharing&&e.settings.videoDirections.sendVideo?(t.stream.getTracks().forEach(function(t){"video"===t.kind&&e.peerConnection.replaceVideoTrack(t)}),e.peerConnection.restoreMute(),r({name:d.CallEvents.Updated,result:!0,call:e})):(e.peerConnection.addCustomMedia(t.stream).then(function(t){r({name:d.CallEvents.Updated,result:!0,call:e})}),e.peerConnection.restoreMute(),E.default.StreamManager.get().isLocalVideoRequested&&e._replaceVideoSharing&&E.default.StreamManager.get().updateLocalVideo())}).catch(function(t){e.logger.warning(t.message),i(t)}):(e.logger.warning("Sorry, this browser does not support screen sharing."),i(new Error("Sorry, this browser does not support screen sharing.")))})}},{key:"stopSharingScreen",value:function(){var e=this;return this.logger.info("stopSharingScreen()"),new Promise(function(t,n){var r=E.default.StreamManager.get()._getScreenSharing(e);if(r){var i=r.length;r.forEach(function(r){E.default.StreamManager.get()._clearScreenSharing(e,r).then(function(){e._replaceVideoSharing&&e.settings.videoDirections.sendVideo?E.default.StreamManager.get().updateCallStream(e):e.peerConnection.removeCustomMedia(r.stream)}).then(function(){r.stream=void 0,--i<=0&&(E.default.StreamManager.get().updateLocalVideo(),e.peerConnection.restoreMute(),t({name:d.CallEvents.Updated,result:!0,call:e}))}).catch(function(t){e.logger.warning(t.message),n(t)})})}else e.logger.warning("Sorry, screen sharing not started yet."),n(new Error("Sorry, screen sharing not started yet."))})}},{key:"wireRemoteStream",value:function(){return new Promise(function(e,t){e()})}},{key:"getRemoteAudioStreams",value:function(){var e=this;return new Promise(function(t,n){e.peerConnection?(e.peerConnection.remoteStreams.forEach(function(e){if(e.getAudioTracks().length)return void t(new MediaStream(e.getAudioTracks()))}),n(new Error("We have no remote MediaStream for this call yet"))):n(new Error("We have no PC for this call yet"))})}},{key:"getRemoteVideoStreams",value:function(){var e=this;return new Promise(function(t,n){e.peerConnection?void 0!==e.peerConnection.remoteStreams[0]&&0!=e.peerConnection.remoteStreams[0].getVideoTracks().length?t(new MediaStream(e.peerConnection.remoteStreams[0].getVideoTracks())):n(new Error("We have no remote MediaStream for this call yet")):n(new Error("We have no PC for this call yet"))})}},{key:"getRemoteWiredState",value:function(){return this.settings.wiredRemote}},{key:"getLocalWiredState",value:function(){return this.settings.wiredLocal}},{key:"useAudioOutput",value:function(e){S.EndpointManager.get().useAudioOutput(this,e)}},{key:"getAudioElementId",value:function(){return(this._peerConnection.remoteStreams.length=0)?null:(this._peerConnection.remoteStreams[0].getAudioTracks().length=0)?null:this._peerConnection.remoteStreams[0].getAudioTracks()[0].id}},{key:"getDirections",value:function(){if(void 0!==this.peerConnection)return this.peerConnection.getDirections()}},{key:"getStreamActivity",value:function(){return{}}},{key:"hdnFRS",value:function(){this.peerConnection._hdnFRS()}},{key:"hdnFRSPrep",value:function(){var e=this;void 0!==this.peerConnection?this.peerConnection._hdnFRSPrep():setTimeout(function(){e.hdnFRSPrep()},1e3)}},{key:"runIncomingReInvite",value:function(e,t){var n=this;if(this.settings.state===u.UPDATING)f.VoxSignaling.get().callRemoteFunction(y.RemoteFunction.rejectReInvite,this.settings.id,{});else{this._setState(u.UPDATING);var r=h.CallManager.get().isSDPHasVideo(t);this.peerConnection.handleRemoteOffer(e,t,r).then(function(){n.peerConnection.restoreMute(),n.peerConnection.restoreVideoSending()})}}},{key:"setActiveForce",value:function(e){this._setActive(e)}},{key:"getCallDuration",value:function(){return Date.now()-this.startTime}},{key:"getEndpoints",value:function(){return S.EndpointManager.get().getEndpoints(this)}},{key:"checkState",value:function(e,t){if(e)if("string"!=typeof e){for(var n=!1,r=e,i=0;i<r.length;i++)r[i]==this.settings.state&&(n=!0);if(!n)return this.logger.warning("Received "+t+" in invalid state "+this.settings.state),!1}else if(this.settings.state!=e)return this.logger.warning("Received "+t+" in invalid state "+this.settings.state),!1;return!0}},{key:"capMaxBitrate",value:function(e){var t=this,n=function(e){r(),e.endpoint.sysOn(L.EndpointEvents.Removed,r)},r=function(){var n=t.getEndpoints(),r=Math.ceil(e/n.length);r<40||t.peerConnection.getTransceivers().filter(function(e){return e.sender&&e.sender.track&&"video"===e.sender.track.kind&&!e.stopped&&e.currentDirection&&-1!==e.currentDirection.indexOf("send")}).forEach(function(e){var t=e.sender,n=t.getParameters();n.encodings&&n.encodings[0]&&(n.encodings[0].maxBitrate=1e3*r,t.setParameters(n).then(function(){}).catch(function(){}))})};this.sysOn(d.CallEvents.EndpointAdded,n)}},{key:"scaleVideoResolutionDownBy",value:function(e){var t=[];return this.peerConnection.getTransceivers().forEach(function(n){if(n.currentDirection&&-1!==n.currentDirection.indexOf("send")||n.direction&&-1!==n.direction.indexOf("send")){var r=n.sender.getParameters();-1!=e?r.encodings[0].scaleResolutionDownBy=e:delete r.encodings[0].scaleResolutionDownBy,t.push(n.sender.setParameters(r))}}),Promise.all(t)}},{key:"_traceName",value:function(){return"Call"}},{key:"promise",get:function(){return this._promise}},{key:"peerConnection",get:function(){return this._peerConnection},set:function(e){this._peerConnection=e}},{key:"stateValue",get:function(){return this.settings.state}}]),t}(_.EventTarget);l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"number",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"displayName",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"headers",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"active",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"_setActive",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"_setState",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"answer",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"decline",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"reject",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"hangup",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"sendTone",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"mutePlayback",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"unmutePlayback",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"restoreRMute",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"muteMicrophone",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"unmuteMicrophone",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"showRemoteVideo",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"setRemoteVideoPosition",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"setRemoteVideoSize",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"sendInfo",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"sendMessage",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"setVideoSettings",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"getVideoElementId",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"addEventListener",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"on",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"removeEventListener",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"off",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"dispatchEvent",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"onConnected",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"onDisconnected",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"onFailed",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"onStopRinging",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"onRingOut",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"onTransferComplete",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"onTransferFailed",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"onInfo",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"setActive",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"checkCallMode",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"canStartSendingCandidates",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"notifyICETimeout",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"sendVideo",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"receiveVideo",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"sendAudio",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"getLocalStream",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"setLocalStream",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"shareScreen",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"stopSharingScreen",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"wireRemoteStream",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"getRemoteAudioStreams",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"getRemoteVideoStreams",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"getRemoteWiredState",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"getLocalWiredState",null),l([p.LogManager.d_trace(p.LogCategory.CLIENT)],M.prototype,"useAudioOutput",null),l([p.LogManager.d_trace(p.LogCategory.CLIENT)],M.prototype,"getAudioElementId",null),l([p.LogManager.d_trace(p.LogCategory.CLIENT)],M.prototype,"getStreamActivity",null),l([p.LogManager.d_trace(p.LogCategory.CLIENT)],M.prototype,"hdnFRS",null),l([p.LogManager.d_trace(p.LogCategory.CLIENT)],M.prototype,"hdnFRSPrep",null),l([p.LogManager.d_trace(p.LogCategory.CLIENT)],M.prototype,"runIncomingReInvite",null),l([p.LogManager.d_trace(p.LogCategory.CLIENT)],M.prototype,"setActiveForce",null),l([p.LogManager.d_trace(p.LogCategory.CALL)],M.prototype,"checkState",null),t.Call=M},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function e(){r(this,e)};i.DIRECT_CALL_HEADER="X-DirectCall",i.VIAMEDIA_CALL_HEADER="X-ViaMedia",i.CALLSTATSIOID_HEADER="X-CallstatsIOID",i.CALL_DATA_HEADER="VI-CallData",i.ZINGAYA_IM_MIME_TYPE="application/zingaya-im",i.P2P_SPD_FRAG_MIME_TYPE="voximplant/sdpfrag",i.VI_HOLD_EMUL="vi/holdemul",i.VI_SPD_OFFER_MIME_TYPE="vi/sdpoffer",i.VI_SPD_ANSWER_MIME_TYPE="vi/sdpanswer",i.VI_CONF_PARTICIPANT_INFO_ADDED="vi/conf-info-added",i.VI_CONF_PARTICIPANT_INFO_REMOVED="vi/conf-info-removed",i.VI_CONF_PARTICIPANT_INFO_UPDATED="vi/conf-info-updated",i.VI_CONF_PARTICIPANT_BATCH="vi/conf-batch",t.Constants=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});!function(e){e[e.loginFailed="loginFailed"]="loginFailed",e[e.loginSuccessful="loginSuccessful"]="loginSuccessful",e[e.handleError="handleError"]="handleError",e[e.onPCStats="__onPCStats"]="onPCStats",e[e.handleIncomingConnection="handleIncomingConnection"]="handleIncomingConnection",e[e.handleConnectionConnected="handleConnectionConnected"]="handleConnectionConnected",e[e.handleConnectionDisconnected="handleConnectionDisconnected"]="handleConnectionDisconnected",e[e.handleRingOut="handleRingOut"]="handleRingOut",e[e.startEarlyMedia="startEarlyMedia"]="startEarlyMedia",e[e.stopRinging="stopRinging"]="stopRinging",e[e.handleConnectionFailed="handleConnectionFailed"]="handleConnectionFailed",e[e.handleSIPInfo="handleSIPInfo"]="handleSIPInfo",e[e.handleSipEvent="handleSipEvent"]="handleSipEvent",e[e.handleTransferStarted="handleTransferStarted"]="handleTransferStarted",e[e.handleTransferComplete="handleTransferComplete"]="handleTransferComplete",e[e.handleTransferFailed="handleTransferFailed"]="handleTransferFailed",e[e.handleReInvite="handleReInvite"]="handleReInvite",e[e.handleAcceptReinvite="handleAcceptReinvite"]="handleAcceptReinvite",e[e.handleRejectReinvite="handleRejectReinvite"]="handleRejectReinvite",e[e.createPC="__createPC"]="createPC",e[e.destroyPC="__destroyPC"]="destroyPC",e[e.connectionSuccessful="__connectionSuccessful"]="connectionSuccessful",e[e.connectionFailed="__connectionFailed"]="connectionFailed",e[e.createConnection="__createConnection"]="createConnection",e[e.pong="__pong"]="pong",e[e.increaseGain="increaseGain"]="increaseGain",e[e.handlePreFlightCheckResult="handlePreFlightCheckResult"]="handlePreFlightCheckResult",e[e.handleVoicemail="handleVoicemail"]="handleVoicemail",e[e.onCallRemoteFunctionError="onCallRemoteFunctionError"]="onCallRemoteFunctionError",e[e.refreshOauthTokenFailed="refreshOauthTokenFailed"]="refreshOauthTokenFailed",e[e.refreshOauthTokenSuccessful="refreshOauthTokenSuccessful"]="refreshOauthTokenSuccessful",e[e.registerPushTokenResult="registerPushTokenResult"]="registerPushTokenResult",e[e.unregisterPushTokenResult="unregisterPushTokenResult"]="unregisterPushTokenResult",e[e.sipRegisterSuccessful="sipRegisterSuccessful"]="sipRegisterSuccessful",e[e.sipRegisterFailed="sipRegisterFailed"]="sipRegisterFailed",e[e.onACDStatus="onACDStatus"]="onACDStatus",e[e.onMessagingStatus="onMessagingStatus"]="onMessagingStatus",e[e.onSQStatusError="onSQStatusError"]="onSQStatusError",e[e.onICEConfig="onICEConfig"]="onICEConfig",e[e.onICEConfigFailed="onICEConfigFailed"]="onICEConfigFailed"}(t.RemoteEvent||(t.RemoteEvent={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});!function(e){e[e.ACD=1]="ACD",e[e.SmartQueue=2]="SmartQueue"}(t.QueueTypes||(t.QueueTypes={}));!function(e){e[e.Offline="OFFLINE"]="Offline",e[e.Online="ONLINE"]="Online",e[e.Ready="READY"]="Ready",e[e.InService="IN_SERVICE"]="InService",e[e.AfterService="AFTER_SERVICE"]="AfterService",e[e.Timeout="TIMEOUT"]="Timeout",e[e.DND="DND"]="DND"}(t.OperatorACDStatuses||(t.OperatorACDStatuses={}))},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,t,n,r){var i,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":o(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(a<3?i(s):a>3?i(t,n,s):i(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),c=n(1),l=n(11),u=n(4),d=n(66),f=function(){function e(){r(this,e)}return i(e,[{key:"_traceName",value:function(){return"Logger"}}],[{key:"cadScript",value:function(e){return e.split(";").map(function(e){if(0!==e.length){var t=e.match(/\([0-9\/\.,\*\+]*\)$/),n=e.substring(0,t.index),r=t.pop();if(t.length)throw new Error("cadence script should be of the form `%f(%f/%f[,%f/%f])`");if(n="*"===n?1/0:parseFloat(n),isNaN(n))throw new Error("cadence length should be of the form `%f`");return r=r.slice(1,r.length-1).split(",").map(function(e){try{var t=e.split("/");if(t.length>3)throw new Error;return t=t.map(function(e,t){if(2===t)return e.split("+").map(function(e){var t=parseInt(e,10);if(isNaN(t))throw new Error;return t-1});var n;if("*"==e&&(n=1/0),n=n||parseFloat(e),isNaN(n))throw new Error;return n}),{on:t[0],off:t[1],frequencies:t[2]}}catch(e){throw new Error("cadence segments should be of the form `%f/%f[%d[+%d]]`")}}),{duration:n,sections:r}}})}},{key:"freqScript",value:function(e){return e.split(",").map(function(e){try{var t=e.split("@"),n=parseInt(t.shift()),r=parseFloat(t.shift());if(t.length)throw Error();return{frequency:n,decibels:r}}catch(e){throw new Error("freqScript pairs are expected to be of the form `%d@%f[,%d@%f]`")}})}},{key:"toneScript",value:function(e){var t=e.split(";");return{frequencies:this.freqScript(t.shift()),cadences:this.cadScript(t.join(";"))}}},{key:"playToneScript",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0!==window.AudioContext||void 0!==window.webkitAudioContext){var n=u.default.AudioDeviceManager.get().getAudioContext();if(null===n)return;var r=this.toneScript(e),i=[],o=0,a=function(e){for(var t=0;t<n.sampleRate*e;t++)i.push(0)},s=function(e,t){for(var o=0;o<n.sampleRate*t;o++){for(var a=0,s=0;s<e.length;s++)a+=Math.pow(10,r.frequencies[e[s]].decibels/20)*Math.sin((i.length+o)*(3.14159265359/n.sampleRate)*r.frequencies[e[s]].frequency),o<10&&(a*=o/10),o>n.sampleRate*t-10&&(a*=(n.sampleRate*t-o)/10);i.push(a)}},c=function(e,t){if(t!=1/0)var n=t;else n=t=20;if(0!==e.off&&e.off!=1/0)for(;n>0;){s(e.frequencies,e.on),n-=e.on,a(e.off),n-=e.off;n=parseInt(String(10*n))/10}else s(e.frequencies,t)};this.source=n.createBufferSource();for(var l=0;l<r.cadences.length;l++)r.cadences[l].duration==1/0&&(this.source.loop=!0),function(e){e.duration!=1/0?o+=e.duration:o+=20;for(var t=0;t<e.sections.length;t++)c(e.sections[t],e.duration)}(r.cadences[l]);this.source.connect(n.destination);for(var d=n.createBuffer(1,o*n.sampleRate,n.sampleRate),f=d.getChannelData(0),g=0;g<o*n.sampleRate;g++)f[g]=i[g];i=null,this.source.buffer=d,!0===t&&(this.source.loop=!0),this.source.start(0)}}},{key:"stopPlayback",value:function(){return void 0!==this.source&&null!==this.source&&(this.source.stop(0),this.source=null,!0)}},{key:"getServers",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return fetch("https://balancer.voximplant.com/getNearestHost").then(function(e){return e.text()})}},{key:"generateUUID",value:function(){var e=this._gri,t=this._ha;return t(e(32),8)+"-"+t(e(16),4)+"-"+t(16384|e(12),4)+"-"+t(32768|e(14),4)+"-"+t(e(48),12)}},{key:"_gri",value:function(e){return e<0?NaN:e<=30?0|Math.random()*(1<<e):e<=53?(0|Math.random()*(1<<30))+(0|Math.random()*(1<<e-30))*(1<<30):NaN}},{key:"_ha",value:function(e,t){for(var n=e.toString(16),r=t-n.length,i="0";r>0;r>>>=1,i+=i)1&r&&(n=i+n);return n}},{key:"checkCA",value:function(){if(!c.Client.getInstance().connected())throw new Error(d.CallError.NOT_CONNECTED_TO_VOXIMPLANT.toString());if(!l.Authenticator.get().authorized())throw new Error(d.CallError.NOT_AUTHORIZED.toString())}},{key:"mixObjectToLeft",value:function(e,t){for(var n in e)void 0!==t[n]&&(e[n]=t[n]);return e}},{key:"strFormat",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.replace(/{(\d+)}/g,function(e,t){return void 0!==n[t]?n[t]:e})}}]),e}();f.source=null,a([s.LogManager.d_trace(s.LogCategory.UTILS)],f,"cadScript",null),a([s.LogManager.d_trace(s.LogCategory.UTILS)],f,"freqScript",null),a([s.LogManager.d_trace(s.LogCategory.UTILS)],f,"toneScript",null),a([s.LogManager.d_trace(s.LogCategory.UTILS)],f,"playToneScript",null),a([s.LogManager.d_trace(s.LogCategory.UTILS)],f,"stopPlayback",null),a([s.LogManager.d_trace(s.LogCategory.UTILS)],f,"getServers",null),t.Utils=f},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=n(3),s=function(){function e(t){r(this,e),this._id=t}return i(e,[{key:"insertDTMF",value:function(e,t,n){var r=this;(""+e).split("").forEach(function(e){return r.sendKey(e)})}},{key:"sendKey",value:function(e){var t=void 0;((t="*"==e?10:"#"==e?11:parseInt(e))>=0||t<=11)&&o.VoxSignaling.get().callRemoteFunction(a.RemoteFunction.sendDTMF,this._id,t)}},{key:"_traceName",value:function(){return"SignalingDTMFSender"}}]),e}();t.SignalingDTMFSender=s},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,t,n,r){var i,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":o(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(a<3?i(s):a>3?i(t,n,s):i(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),c=function(){function e(){r(this,e)}return i(e,[{key:"sysOn",value:function(e,t,n){this._ETonTo("system",e,t,n)}},{key:"sysOff",value:function(e,t){this._EToffTo("system",e,t)}},{key:"on",value:function(e,t,n){this._ETonTo("user",e,t,n)}},{key:"off",value:function(e,t){this._EToffTo("user",e,t)}},{key:"_ETonTo",value:function(e,t,n,r){void 0===this.eventListeners&&(this.eventListeners={});var i=this.eventListeners;void 0===i[t]&&(i[t]=[]);var o={listener:n,options:r,_triggered:!1,_namespace:e};r&&r.capture?i[t].unshift(o):i[t].push(o)}},{key:"_EToffTo",value:function(e,t,n){var r=this.eventListeners;if(void 0!==r&&void 0!==r[t])if("function"==typeof n){for(var i=0;i<r[t].length;i++)if(r[t][i].listener==n&&r[t][i]._namespace===e){r[t].splice(i,1);break}}else r[t]=r[t].filter(function(t){return t._namespace!==e})}},{key:"dispatchEvent",value:function(e){if(void 0!==this.eventListeners&&void 0!==this.eventListeners[e.name]){var t=this.eventListeners[e.name].filter(function(e){return"user"===e._namespace});s.LogManager.get().writeMessage(s.LogCategory.UTILS,"[event]",s.LogLevel.INFO,e.name+(e.name.includes("QualityIssue")?" "+e.level:"")+", listeners: "+t.length);for(var n=0;n<this.eventListeners[e.name].length;n++)try{if(!(this.eventListeners[e.name][n].options&&this.eventListeners[e.name][n].options.once&&this.eventListeners[e.name][n]._triggered||"system"!==this.eventListeners[e.name][n]._namespace&&"user"!==this.eventListeners[e.name][n]._namespace&&("default"!==this.eventListeners[e.name][n]._namespace||t.length))){this.eventListeners[e.name][n]._triggered=!0;if(!1===this.eventListeners[e.name][n].listener(e))return}}catch(e){console.error(e)}}else s.LogManager.get().writeMessage(s.LogCategory.UTILS,"[event]",s.LogLevel.INFO,e.name+(e.name.includes("QualityIssue")?" "+e.level:"")+", listeners: 0")}},{key:"removeEventListener",value:function(e,t){this.off(e,t)}},{key:"addEventListener",value:function(e,t,n){this.on(e,t,n)}},{key:"addDefaultEventListener",value:function(e,t){this._ETonTo("default",e,t,{})}},{key:"removeDefaultEventListener",value:function(e){this._EToffTo("default",e)}},{key:"_traceName",value:function(){return"EventTarget"}}]),e}();a([s.LogManager.d_trace(s.LogCategory.EVENTTARGET)],c.prototype,"sysOn",null),a([s.LogManager.d_trace(s.LogCategory.EVENTTARGET)],c.prototype,"sysOff",null),a([s.LogManager.d_trace(s.LogCategory.EVENTTARGET)],c.prototype,"on",null),a([s.LogManager.d_trace(s.LogCategory.EVENTTARGET)],c.prototype,"off",null),a([s.LogManager.d_trace(s.LogCategory.EVENTTARGET)],c.prototype,"removeEventListener",null),a([s.LogManager.d_trace(s.LogCategory.EVENTTARGET)],c.prototype,"addEventListener",null),a([s.LogManager.d_trace(s.LogCategory.EVENTTARGET)],c.prototype,"addDefaultEventListener",null),a([s.LogManager.d_trace(s.LogCategory.EVENTTARGET)],c.prototype,"removeDefaultEventListener",null),t.EventTarget=c},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(r)},c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":c(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var u=n(0),d=n(26),f=n(2),g=n(18),p=n(43),v=n(20),h=function(e){function t(){r(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(t.instance)throw new Error("Error - use Client.getMessagingInstance()");return e.query=[],setInterval(function(){e.updateQuery()},220),e}return o(t,e),a(t,[{key:"capitalize",value:function(e){return e.toString()[0].toUpperCase()+e.toString().slice(1)}},{key:"updateQuery",value:function(){if(this.query.length){var e=this.query.splice(0,1);f.VoxSignaling.get().sendRaw(e[0])}}},{key:"addEventListener",value:function(e,n,r){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addEventListener",this).call(this,e,n,r)}},{key:"dispatchMsgEvent",value:function(e,t){if(void 0!==this.eventListeners[e])for(var n=0;n<this.eventListeners[e].length;n++)this.eventListeners[e][n]&&"function"==typeof this.eventListeners[e][n].listener&&this.eventListeners[e][n].listener(t.payload,t.request_uuid)}},{key:"handleWsData",value:function(e){if(-1==Object.values(d.MsgEvent).indexOf(e.event))throw new Error("Unknown messaging event "+e.event+" with payload "+JSON.stringify(e.payload));this.dispatchMsgEvent(e.event,e)}},{key:"sendWsMessage",value:function(e,t){var n=["subscribe","unsubscribe","typingMessage","isRead","setStatus"].includes(e)?"CommonNamespace":"IncomingNamespace",r={setStatus:"PresenceMessage",isRead:"StatusMessage",typingMessage:"TypingMessage",subscribe:"ManageSubscribes",unsubscribe:"ManageSubscribes",addParticipants:"ManageParticipants",editParticipants:"ManageParticipants",manageNotification:"ManageNotifications",getPublicConversations:"GetConversations",retransmitEvents:"RetransmitRequest"},i=(new v.default).toString(),o={service:p.MsgService.Chat,event:e,payload:Object.assign(t,{"@type":"type/vox.store."+n+"."+(r[e]||this.capitalize(e))}),request_uuid:i};return this.query.push(o),i}},{key:"_traceName",value:function(){return"MsgSignaling"}}],[{key:"get",value:function(){return t.instance=t.instance||new t,t.instance}}]),t}(g.EventTarget);l([u.LogManager.d_trace(u.LogCategory.MESSAGING)],h.prototype,"handleWsData",null),l([u.LogManager.d_trace(u.LogCategory.MESSAGING)],h.prototype,"sendWsMessage",null),t.MsgSignaling=h},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(t){r(this,e),this.str=t||e.getNewGUIDString()}return i(e,[{key:"toString",value:function(){return this.str}},{key:"_traceName",value:function(){return"GUID"}}],[{key:"getNewGUIDString",value:function(){var e=(new Date).getTime();return window.performance&&"function"==typeof window.performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)})}}]),e}();t.default=o},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a,s=n(27),c=n(33),l=n(28);!function(e){function t(){return n.getInstance()}e.getInstance=t;var n=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),t}(s.Messenger);e.Messenger=n;var a=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),t}(c.Conversation);e.Conversation=a;var u=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),t}(l.Message);e.Message=u;!function(e){e.UNKNOWN="UNKNOWN",e.createConversation="createConversation",e.editConversation="editConversation",e.removeConversation="removeConversation",e.joinConversation="joinConversation",e.leaveConversation="leaveConversation",e.getConversation="getConversation",e.getConversations="getConversations",e.getPublicConversations="getPublicConversations",e.searchConversations="searchConversations",e.removeEmptyConversation="removeEmptyConversation",e.addParticipants="addParticipants",e.editParticipants="editParticipants",e.removeParticipants="removeParticipants",e.getUser="getUser",e.getUsers="getUsers",e.editUser="editUser",e.setStatus="setStatus",e.sendMessage="sendMessage",e.editMessage="editMessage",e.removeMessage="removeMessage",e.typingMessage="typingMessage",e.isRead="isRead",e.subscribe="subscribe",e.unsubscribe="unsubscribe",e.manageNotification="manageNotification",e.getSubscriptionList="getSubscriptionList",e.createBot="createBot",e.removeBot="removeBot",e.retransmitEvents="retransmitEvents"}(e.MessengerAction||(e.MessengerAction={}));!function(e){e.CreateConversation="CreateConversation",e.EditConversation="EditConversation",e.RemoveConversation="RemoveConversation",e.GetConversation="GetConversation",e.GetPublicConversations="GetPublicConversations",e.SendMessage="SendMessage",e.EditMessage="EditMessage",e.RemoveMessage="RemoveMessage",e.Typing="Typing",e.EditUser="EditUser",e.GetUser="GetUser",e.Error="Error",e.RetransmitEvents="RetransmitEvents",e.Read="Read",e.Subscribe="Subscribe",e.Unsubscribe="Unsubscribe",e.SetStatus="SetStatus",e.GetSubscriptionList="GetSubscriptionList",e.CreateBot="CreateBot",e.RemoveBot="RemoveBot"}(e.MessengerEvents||(e.MessengerEvents={}));!function(e){e[e.Error_0=0]="Error_0",e[e.Error_1=1]="Error_1",e[e.Error_2=2]="Error_2",e[e.Error_3=3]="Error_3",e[e.Error_8=8]="Error_8",e[e.Error_10=10]="Error_10",e[e.Error_11=11]="Error_11",e[e.Error_12=12]="Error_12",e[e.Error_13=13]="Error_13",e[e.Error_15=15]="Error_15",e[e.Error_16=16]="Error_16",e[e.Error_18=18]="Error_18",e[e.Error_19=19]="Error_19",e[e.Error_21=21]="Error_21",e[e.Error_22=22]="Error_22",e[e.Error_23=23]="Error_23",e[e.Error_24=24]="Error_24",e[e.Error_25=25]="Error_25",e[e.Error_26=26]="Error_26",e[e.Error_28=28]="Error_28",e[e.Error_30=30]="Error_30",e[e.Error_32=32]="Error_32",e[e.Error_33=33]="Error_33",e[e.Error_34=34]="Error_34",e[e.Error_35=35]="Error_35",e[e.Error_36=36]="Error_36",e[e.Error_37=37]="Error_37",e[e.Error_38=38]="Error_38",e[e.Error_39=39]="Error_39",e[e.Error_40=40]="Error_40",e[e.Error_41=41]="Error_41",e[e.Error_42=42]="Error_42",e[e.Error_43=43]="Error_43",e[e.Error_500=500]="Error_500"}(e.MessengerError||(e.MessengerError={}))}(a=t.Messaging||(t.Messaging={})),t.default=a},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(r)},c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":c(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var u=n(0),d=n(4),f=n(18),g=n(36),p=n(9),v=n(8),h=n(1),m=n(35),y=n(37),C=n(5),_=n(6),S=function(e){function t(){r(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(e.isLocalVideoRequested=!1,e._dedicatedMirrorStream=null,void 0!==t.instance)throw new Error("Error - use StreamManager.get()");return e._callStreams={},e._localMediaRenderers=[],e._sharingStreams={},e.logger=u.LogManager.get().createLogger(u.LogCategory.HARDWARE,e._traceName()),e}return o(t,e),a(t,[{key:"getCallStream",value:function(e){var n=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise(function(i,o){var a=void 0===e?"__default":e.id();if(n._callStreams[a]&&!r)i(n._callStreams[a]);else{var s=n._composeConstraints(e);if(n.logger.info("[constraints]: "+JSON.stringify(s)),!s.audio&&!s.video&&"__default"!==a)return void i(null);p.default.isIphone()?d.default.IOSCacheManager.get().getStream(s).then(function(e){n._callStreams[a]=e,e.getTracks().forEach(function(e){e.onended=n.onCallEnded,e.onmute=n.onCallEnded}),h.Client.getInstance().dispatchEvent({name:v.Events.MicAccessResult,result:!0,stream:e}),i(e)}):t.getUserMedia(s).then(function(e){n.logger.info("Media access granted"),n._callStreams[a]=e,e.getTracks().forEach(function(e){e.onended=n.onCallEnded,e.onmute=n.onCallEnded}),h.Client.getInstance().dispatchEvent({name:v.Events.MicAccessResult,result:!0,stream:e}),i(e)},function(r){if("NotFoundError"===r.name){var c={audio:!0};n.logger.info("[backup constraints]: "+JSON.stringify(s)),void 0!==e&&(e.settings.videoDirections.sendVideo=!1,c=n._composeConstraints(e)),t.getUserMedia(c).then(function(e){n.logger.info("Media access granted"),n._callStreams[a]=e,e.getTracks().forEach(function(e){e.onended=n.onCallEnded,e.onmute=n.onCallEnded}),h.Client.getInstance().dispatchEvent({name:v.Events.MicAccessResult,result:!0,stream:e}),i(e)},function(e){n.logger.error("Media access denied: "+(e?e.message||e.name||e:"unknown")),h.Client.getInstance().dispatchEvent({name:v.Events.MicAccessResult,result:!1,stream:null}),o(e)})}else n.logger.error("Media access denied: "+(r?r.message||r.name||r:"unknown")),h.Client.getInstance().dispatchEvent({name:v.Events.MicAccessResult,result:!1,stream:null}),o(r)})}})}},{key:"_updateCallStream",value:function(e){return this.remCallStream(e),this.getCallStream(e)}},{key:"updateCallStream",value:function(e){var t=this;return this.logger.info("Updating call "+e.id()+" stream"),new Promise(function(n,r){var i=t._callStreams[e.id()];t.getCallStream(e,!0).then(function(n){var r=i.getTracks(),o=n.getTracks(),a=r.map(function(e){return e.kind}).sort(),s=o.map(function(e){return e.kind}).sort();return r.length===o.length&&a.every(function(e,t){return e===s[t]})?e.peerConnection.updateCustomMedia(n):(e.peerConnection.fastRemoveCustomMedia(i),t._remCallStream(i),e.peerConnection.addCustomMedia(n))}).then(function(r){setTimeout(function(){return t.updateLocalVideo()},500),e.peerConnection.restoreMute();var o=function(){i.getTracks().forEach(function(t){e.peerConnection.getTransceivers().some(function(e){return e.sender.track&&e.sender.track.id===t.id})||t.stop()})};setTimeout(o,500),setTimeout(o,2e3),setTimeout(o,5e3),n(r)}).catch(r)})}},{key:"remCallStream",value:function(e){var t=void 0===e?"__default":e.id();this._callStreams[t]&&(this._remCallStream(this._callStreams[t]),this._callStreams[t]=void 0,delete this._callStreams[t])}},{key:"_remCallStream",value:function(e){e&&(p.default.isIphone()||e.getTracks().forEach(function(t){t.onended=void 0,t.onmute=void 0,t.stop(),e.removeTrack(t)}))}},{key:"clear",value:function(){this._mirrorStream&&this._mirrorStream.getTracks().forEach(function(e){e.onended=void 0,e.onmute=void 0,e.stop()}),this._mirrorStream=void 0;for(var e in this._callStreams)if(this._callStreams.hasOwnProperty(e)){var t=this._callStreams[e];t&&t.getTracks().forEach(function(e){e.onended=void 0,e.onmute=void 0,e.stop()})}this._callStreams={}}},{key:"getLocalMediaRenderers",value:function(){return this._localMediaRenderers}},{key:"showLocalVideo",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise(function(n,r){e.isLocalVideoRequested&&n(e._localMediaRenderers[0]);var i=e._getVideoFromCalls();if(i){var o=new y.MediaRenderer(new MediaStream([i]),"video",t,!0,"voximplantlocalvideo");e._localMediaRenderers.push(o),n(o),e.dispatchEvent({name:d.default.HardwareEvents.MediaRendererAdded,renderer:o}),e.isLocalVideoRequested=!0}else e.getDedicatedMirrorStream().then(function(r){e._dedicatedMirrorStream=r;var i=new y.MediaRenderer(r,"video",t,!0,"voximplantlocalvideo");e._localMediaRenderers.push(i),n(i),e.dispatchEvent({name:d.default.HardwareEvents.MediaRendererAdded,renderer:i}),e.isLocalVideoRequested=!0}).catch(r)})}},{key:"getDedicatedMirrorStream",value:function(){return this._dedicatedMirrorStream?Promise.resolve(this._dedicatedMirrorStream):t.getUserMedia({video:g.CameraManager.get().getCallConstraints("__local__")})}},{key:"stopDedicatedMirrorStream",value:function(){if(this._dedicatedMirrorStream){this._dedicatedMirrorStream.getTracks().forEach(function(e){e.onended=null,e.onmute=null,e.stop()});try{this._dedicatedMirrorStream.stop()}catch(e){}this._dedicatedMirrorStream=null}}},{key:"updateLocalVideo",value:function(){var e=this;if((!this._localMediaRenderers||0!==this._localMediaRenderers.length)&&this.isLocalVideoRequested){var t=this._getVideoFromCalls();t?this._localMediaRenderers[0].stream.getVideoTracks()[0].id!==t.id&&(this._localMediaRenderers[0].replaceVideo(new MediaStream([t])),this.stopDedicatedMirrorStream(),this.dispatchEvent({name:d.default.HardwareEvents.MediaRendererUpdated,renderer:this._localMediaRenderers[0]})):this.getDedicatedMirrorStream().then(function(t){e._dedicatedMirrorStream=t,e._localMediaRenderers[0]&&(e._localMediaRenderers[0].kind="video",e._localMediaRenderers[0].replaceVideo(t),e.dispatchEvent({name:d.default.HardwareEvents.MediaRendererUpdated,renderer:e._localMediaRenderers[0]}))})}}},{key:"hideLocalVideo",value:function(){return this.isLocalVideoRequested?(this.dispatchEvent({name:d.default.HardwareEvents.BeforeMediaRendererRemoved,renderer:this._localMediaRenderers[0]}),this.isLocalVideoRequested=!1,this._dedicatedMirrorStream&&this.stopDedicatedMirrorStream(),0!==this._localMediaRenderers.length?(this._localMediaRenderers[0].clear(),this._localMediaRenderers[0].stream=null,this._localMediaRenderers.shift(),this.dispatchEvent({name:d.default.HardwareEvents.MediaRendererRemoved,renderer:this._localMediaRenderers[0]}),Promise.resolve()):void 0):Promise.resolve()}},{key:"on",value:function(e,n,r){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"on",this).call(this,e,n)}},{key:"off",value:function(e,n){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"off",this).call(this,e,n)}},{key:"_newScreenSharing",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new Promise(function(i,o){p.default.getScreenMedia().then(function(o){n.logger.info("Media access granted");var a={stream:o,renderer:null};if(o.getTracks().forEach(function(t){t.addEventListener("ended",function(){return e.stopSharingScreen()})}),t&&!r){var s=new y.MediaRenderer(o,"sharing",!0,!0);n._localMediaRenderers.push(s),a.renderer=s,n.dispatchEvent({name:d.default.HardwareEvents.MediaRendererAdded,renderer:s}),n.dispatchEvent({name:C.CallEvents.LocalVideoStreamAdded,type:a.renderer.kind,element:a.renderer.element,videoStream:a.renderer.stream})}void 0===n._sharingStreams[e.id()]&&(n._sharingStreams[e.id()]=[]),n._sharingStreams[e.id()].push(a),i(a)}).catch(function(e){n.logger.error("Media access denied: "+(e?e.message||e.name||e:"unknown")),o(e)})})}},{key:"_getScreenSharing",value:function(e){return void 0!==this._sharingStreams[e.id()]?this._sharingStreams[e.id()]:[]}},{key:"_clearScreenSharing",value:function(e,t){var n=this;return new Promise(function(r,i){n._sharingStreams[e.id()]=n._sharingStreams[e.id()].filter(function(e){return e.stream.id!==t.stream.id}),t.renderer&&(n._localMediaRenderers=n._localMediaRenderers.filter(function(e){return e.id!==t.renderer.id}),n.dispatchEvent({name:d.default.HardwareEvents.BeforeMediaRendererRemoved,renderer:t.renderer}),t.renderer.clear(),n.dispatchEvent({name:d.default.HardwareEvents.MediaRendererRemoved,renderer:t.renderer}),t.renderer=void 0),t.stream.getTracks().forEach(function(e){e.onended=null,e.stop()}),r()})}},{key:"_getTracksKind",value:function(e){var t={},n=this._callStreams[e.id()];void 0!==n&&n.getTracks().forEach(function(e){return t[e.id]=e.kind});var r=this._sharingStreams[e.id()];return void 0!==r&&r.forEach(function(e){e.stream.getTracks().forEach(function(e){return t[e.id]="sharing"})}),t}},{key:"_traceName",value:function(){return"StreamManager"}},{key:"_getVideoFromCalls",value:function(){var e=_.CallManager.get(),t=[];for(var n in e.calls)if(e.calls.hasOwnProperty(n)){var r=function(){var r=e.calls[n];if(!r.active())return"break";var i={time:r.getCallDuration(),track:null};if(r.peerConnection){r.peerConnection.getTransceivers().forEach(function(e){null===i.track&&-1!==e.direction.indexOf("send")&&e.sender.track&&"video"===e.sender.track.kind&&"live"===e.sender.track.readyState&&(i.track=e.sender.track)})}i.track&&t.push(i)}();if("break"===r)break}return t.length?(t.sort(function(e,t){return e.time>t.time?1:e.time<t.time?-1:0}),t[0].track):null}},{key:"onCallEnded",value:function(){}},{key:"_composeConstraints",value:function(e){var t=void 0===e?"__default":e.id(),n={};return"__default"!==t&&void 0!==e&&e.settings.videoDirections.sendVideo?n.video=g.CameraManager.get().getCallConstraints(t):n.video=!1,"__default"===t||e.settings.audioDirections.sendAudio?n.audio=m.AudioDeviceManager.get().getCallConstraints(t):n.audio=!1,n}}],[{key:"get",value:function(){return void 0===t.instance&&(t.instance=new t),t.instance}},{key:"getUserMedia",value:function(e){return new Promise(function(n,r){navigator.mediaDevices.getUserMedia(e).then(function(e){t.umCache.push(e),n(e)}).catch(r)})}},{key:"clearUmCache",value:function(){t.umCache.forEach(function(e){var n=t.get()._dedicatedMirrorStream;n&&e.id===n.id||e.getTracks().forEach(function(e){return e.stop()})})}}]),t}(f.EventTarget);S.umCache=[],l([u.LogManager.d_trace(u.LogCategory.HARDWARE)],S.prototype,"getCallStream",null),l([u.LogManager.d_trace(u.LogCategory.HARDWARE)],S.prototype,"_updateCallStream",null),l([u.LogManager.d_trace(u.LogCategory.HARDWARE)],S.prototype,"updateCallStream",null),l([u.LogManager.d_trace(u.LogCategory.HARDWARE)],S.prototype,"remCallStream",null),l([u.LogManager.d_trace(u.LogCategory.HARDWARE)],S.prototype,"_remCallStream",null),l([u.LogManager.d_trace(u.LogCategory.HARDWARE)],S.prototype,"clear",null),l([u.LogManager.d_trace(u.LogCategory.HARDWARE)],S.prototype,"getLocalMediaRenderers",null),l([u.LogManager.d_trace(u.LogCategory.HARDWARE)],S.prototype,"showLocalVideo",null),l([u.LogManager.d_trace(u.LogCategory.HARDWARE)],S.prototype,"hideLocalVideo",null),l([u.LogManager.d_trace(u.LogCategory.HARDWARE)],S.prototype,"on",null),l([u.LogManager.d_trace(u.LogCategory.HARDWARE)],S.prototype,"off",null),l([u.LogManager.d_trace(u.LogCategory.HARDWARE)],S.prototype,"_newScreenSharing",null),l([u.LogManager.d_trace(u.LogCategory.HARDWARE)],S.prototype,"_getScreenSharing",null),l([u.LogManager.d_trace(u.LogCategory.HARDWARE)],S.prototype,"_clearScreenSharing",null),l([u.LogManager.d_trace(u.LogCategory.HARDWARE)],S.prototype,"_getTracksKind",null),l([u.LogManager.d_trace(u.LogCategory.HARDWARE)],S.prototype,"onCallEnded",null),l([u.LogManager.d_trace(u.LogCategory.HARDWARE)],S.prototype,"_composeConstraints",null),t.StreamManager=S},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});!function(e){e[e.InfoUpdated="InfoUpdated"]="InfoUpdated",e[e.Removed="Removed"]="Removed",e[e.RemoteMediaAdded="RemoteMediaAdded"]="RemoteMediaAdded",e[e.RemoteMediaRemoved="RemoteMediaRemoved"]="RemoteMediaRemoved",e[e.RTCStatsReceived="RTCStatsReceived"]="RTCStatsReceived"}(t.EndpointEvents||(t.EndpointEvents={}))},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=function(){function e(){r(this,e)}return i(e,[{key:"_traceName",value:function(){return"SDPMuggle"}}],[{key:"detectDirections",value:function(t){var n=[],r=t.split(/(\r\n|\r|\n)/).filter(e.validLine),i="";return r.forEach(function(e){if(0===e.indexOf("m=")){var t=e.substr(2);i=t.split(" ")[0]}""===i||"a=sendrecv"!==e&&"a=sendonly"!==e&&"a=recvonly"!==e&&"a=inactive"!==e||(n.push({type:i,direction:e.substr(2)}),i="")}),n}},{key:"removeTelephoneEvents",value:function(t){if(-1!==t.sdp.indexOf("a=rtpmap:127 telephone-event/8000")){for(var n=t.sdp.split(/(\r\n|\r|\n)/).filter(e.validLine),r=-1,i=0;i<n.length;i++){if(-1!==n[i].indexOf("m=audio")){var o=n[i];"string"==typeof o&&(n[i]=o.replace(" 127",""))}-1!==n[i].indexOf("a=rtpmap:127 telephone-event/8000")&&(r=i)}return n.splice(r,1),new RTCSessionDescription({sdp:n.join("\r\n")+"\r\n",type:t.type})}return t}},{key:"removeDoubleOpus",value:function(t){if(-1!==t.sdp.indexOf("a=rtpmap:109 opus")&&-1!==t.sdp.indexOf("a=rtpmap:111 opus")){for(var n=t.sdp.split(/(\r\n|\r|\n)/).filter(e.validLine),r=-1,i=0;i<n.length;i++){if(-1!==n[i].indexOf("m=audio")){var o=n[i];"string"==typeof o&&(n[i]=o.replace(" 109",""))}-1!==n[i].indexOf("a=rtpmap:109 opus")&&(r=i)}return n.splice(r,1),new RTCSessionDescription({sdp:n.join("\r\n")+"\r\n",type:t.type})}return t}},{key:"removeDoublePT",value:function(t){for(var n=t.sdp.split(/(\r\n|\r|\n)/).filter(e.validLine),r=[],i=0;i<n.length;i++){var o=n[i];0===o.indexOf("m=video")&&(r=o.split(" "),n[i]=r.filter(function(e,t){if(0===t)return!0;for(var n=t-1;n>=2;n--)if(r[n]===e)return!1;return!0}).join(" "))}return new RTCSessionDescription({sdp:n.join("\r\n")+"\r\n",type:t.type})}},{key:"removeTransportCC",value:function(t){if(-1!==t.sdp.indexOf("http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")){var n=t.sdp.split(/(\r\n|\r|\n)/).filter(e.validLine),r=[];return n.forEach(function(e,t){-1!==e.indexOf("http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")&&r.unshift(t)}),r.forEach(function(e){return n.splice(e,1)}),new RTCSessionDescription({sdp:n.join("\r\n")+"\r\n",type:t.type})}return t}},{key:"removeTIAS",value:function(t){if(-1!==t.sdp.indexOf("b=TIAS:13888000")||-1!==t.sdp.indexOf("b=AS:13888")){var n=t.sdp.split(/(\r\n|\r|\n)/).filter(e.validLine),r=[];n.forEach(function(e,t){-1===e.indexOf("b=TIAS:13888000")&&-1===e.indexOf("b=AS:13888")||r.unshift(t)}),r.forEach(function(e){return n.splice(e,1)}),t={type:t.type,sdp:n.join("\r\n")+"\r\n"}}return t}},{key:"fixVideoRecieve",value:function(t,n){if(-1!==t.sdp.indexOf("m=video")&&!n){var r=t.sdp.split(/(\r\n|\r|\n)/).filter(e.validLine),i=null;return r=r.map(function(e,t){return null===i?-1!==e.indexOf("m=video")&&(i=t):"a=sendrecv"===e?e="a=sendonly":"a=recvonly"===e&&(e="a=inactive"),e}),new RTCSessionDescription({sdp:r.join("\r\n")+"\r\n",type:t.type})}return t}},{key:"addSetupAttribute",value:function(e){return-1==e.indexOf("a=setup:")&&(e+="a=setup:actpass\r\n"),e}},{key:"findTrackByMid",value:function(t,n){for(var r=t.split(/(\r\n|\r|\n)/).filter(e.validLine),i=-1,o=0;o<r.length&&(-1===r[o].indexOf("a=mid:")||-1===i);o++)if(-1!==r[o].indexOf("a=mid:"+n)&&(i=o),-1!==r[o].indexOf("msid:")&&-1!==i)return r[o].split(" ").slice(-1).pop();return""}},{key:"addXAS",value:function(e){if(o.Client.getInstance().config().experiments.xas&&o.Client.getInstance().config().experiments.xas){var t=e.sdp,n=o.Client.getInstance().config().experiments.xas;return void 0!==n.as&&-1!==n.as&&(t=t.replace(/(a=mid:video.*\r\n)/g,"$1b=AS:"+n.as+"\r\n")),void 0!==n.tias&&-1!==n.tias&&(t=t.replace(/(a=mid:video.*\r\n)/g,"$1b=TIAS:"+n.as+"\r\n")),new RTCSessionDescription({sdp:t,type:e.type})}return e}},{key:"fixFFMIDBug",value:function(e){if(-1==e.sdp.indexOf("a=mid")){var t=e.sdp.replace(/(m=audio.*\r\n)/g,"$1a=mid:0\r\n");return new RTCSessionDescription({sdp:t,type:e.type})}return e}},{key:"fixFMTP",value:function(t){var n=t.sdp.split(/(\r\n|\r|\n)/).filter(e.validLine),r=[];return n=n.filter(function(e){if(0==e.indexOf("a=fmtp")){var n=e.split(" ")[1],i=n.replace("apt=","");return-1!==t.sdp.indexOf("a=rtpmap:"+i)||(r.push(n[0].replace("a=fmtp:","")),!1)}return!0}).filter(function(e){return-1===e.indexOf("a=rtpmap:")||-1===r.indexOf(e.split(" ")[0].replace("a=rtpmap:",""))}).map(function(e){if(-1!==e.indexOf("m=")){return e.split(" ").filter(function(e){return-1===r.indexOf(e)}).join(" ")}return e}),{sdp:n.join("\r\n")+"\r\n",type:t.type}}}]),e}();a.validLine=RegExp.prototype.test.bind(/^([a-z])=(.*)/),t.SDPMuggle=a},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(0);!function(e){e[e.multiplex="multiplex"]="multiplex",e[e.audio="audio"]="audio",e[e.video="video"]="video",e[e.screen="screen"]="screen",e[e.data="data"]="data",e[e.unbundled="unbundled"]="unbundled"}(t.CallstatsIoFabricUsage||(t.CallstatsIoFabricUsage={}));!function(e){e[e.fabricHold="fabricHold"]="fabricHold",e[e.fabricResume="fabricResume"]="fabricResume",e[e.audioMute="audioMute"]="audioMute",e[e.audioUnmute="audioUnmute"]="audioUnmute",e[e.videoPause="videoPause"]="videoPause",e[e.videoResume="videoResume"]="videoResume",e[e.fabricTerminated="fabricTerminated"]="fabricTerminated",e[e.screenShareStart="screenShareStart"]="screenShareStart",e[e.screenShareStop="screenShareStop"]="screenShareStop",e[e.dominantSpeaker="dominantSpeaker"]="dominantSpeaker",e[e.activeDeviceList="activeDeviceList"]="activeDeviceList"}(t.CallstatsIoFabricEvent||(t.CallstatsIoFabricEvent={}));!function(e){e[e.getUserMedia="getUserMedia"]="getUserMedia",e[e.createOffer="createOffer"]="createOffer",e[e.createAnswer="createAnswer"]="createAnswer",e[e.setLocalDescription="setLocalDescription"]="setLocalDescription",e[e.setRemoteDescription="setRemoteDescription"]="setRemoteDescription",e[e.addIceCandidate="addIceCandidate"]="addIceCandidate",e[e.iceConnectionFailure="iceConnectionFailure"]="iceConnectionFailure",e[e.signalingError="signalingError"]="signalingError",e[e.applicationLog="applicationLog"]="applicationLog"}(t.CallstatsioWrtcFuncNames||(t.CallstatsioWrtcFuncNames={}));var a=function(){function e(t){r(this,e),this._params=t,this.inited=!1,this.pendingFabric=[];var n=window;void 0!==n.callstats&&(this.callstats=new n.callstats(null,n.io))}return i(e,[{key:"init",value:function(t){var n=this;return!!e.moduleEnabled&&(o.LogManager.get().writeMessage(o.LogCategory.UTILS,"[CallstatsIo]",o.LogLevel.INFO," Callstats.io SDK initialization start"),this.callstats.initialize(this._params.AppID,this._params.AppSecret,t,function(){o.LogManager.get().writeMessage(o.LogCategory.UTILS,"[CallstatsIo]",o.LogLevel.INFO," Callstats.io SDK initialization successful"),n.inited=!0,n.pendingFabric.map(function(e){n.callstats.addNewFabric(e.pc,e.remoteUser,e.fabricUsage,e.callID)})},function(){},this.packParams()),!0)}},{key:"packParams",value:function(){var e={};return this._params.disableBeforeUnloadHandler&&(e.disableBeforeUnloadHandler=this._params.disableBeforeUnloadHandler),this._params.applicationVersion&&(e.applicationVersion=this._params.applicationVersion),e}},{key:"addNewFabric",value:function(t,n,r,i){if(!e.moduleEnabled)return!1;this.inited?(o.LogManager.get().writeMessage(o.LogCategory.UTILS,"[CallstatsIo]",o.LogLevel.INFO," Callstats.io addNewFabric"),this.callstats.addNewFabric(t,n,r,i)):this.pendingFabric.push({pc:t,remoteUser:n,fabricUsage:r,callID:i})}},{key:"sendFabricEvent",value:function(t,n,r){if(!e.moduleEnabled)return!1;this.callstats.sendFabricEvent(t,n,r)}},{key:"reportError",value:function(t,n,r,i,o,a){if(!e.moduleEnabled)return!1;this.callstats.reportError(t,n,r,i,o,a)}},{key:"_traceName",value:function(){return"CallstatsIo"}}],[{key:"isModuleEnabled",value:function(){return e.moduleEnabled}},{key:"get",value:function(t){return void 0!==window.callstats&&(e.moduleEnabled=!0),void 0===e.instance&&(e.instance=new e(t)),void 0!==t&&(e.instance._params=t),e.instance}}]),e}();a.moduleEnabled=!1,t.CallstatsIo=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});!function(e){e.onError="onError",e.onCreateConversation="onCreateConversation",e.onEditConversation="onEditConversation",e.onRemoveConversation="onRemoveConversation",e.onGetConversation="onGetConversation",e.onGetPublicConversations="onGetPublicConversations",e.onGetUser="onGetUser",e.onEditUser="onEditUser",e.onSetStatus="onSetStatus",e.onSendMessage="onSendMessage",e.onEditMessage="onEditMessage",e.onRemoveMessage="onRemoveMessage",e.isRead="isRead",e.onTyping="onTyping",e.onSubscribe="onSubscribe",e.onUnsubscribe="onUnsubscribe",e.onGetSubscriptionList="onGetSubscriptionList",e.onCreateBot="onCreateBot",e.onRemoveBot="onRemoveBot",e.onRetransmitEvents="onRetransmitEvents"}(t.MsgEvent||(t.MsgEvent={}))},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,t,n,r){var i,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":o(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(a<3?i(s):a>3?i(t,n,s):i(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),c=n(19),l=n(26),u=n(47),d=n(33),f=n(28),g=n(21),p=n(11),v=n(48),h=n(29),m={0:"Something went wrong. Please check your input or required parameters."},y=function(){function e(){var t=this;if(r(this,e),e.instance)throw new Error(v.MESSAGING_ERR_1);this.eventListeners={},this.awaitPromiseList={},this.cm=u.default.get(),this.signalling=c.MsgSignaling.get(),this.signalling.addEventListener(l.MsgEvent.onError,function(e,n){t._dispatchEvent(g.default.MessengerEvents.Error,{initiator:t.currentUserId,code:e.code,description:e.description,messengerAction:g.default.MessengerAction[e.on_incoming_event],timestamp:"number"==typeof e.timestamp?1e3*e.timestamp:void 0,requestUuid:n},n)}),this.signalling.addEventListener(l.MsgEvent.onEditUser,function(e,n){t._dispatchEvent(g.default.MessengerEvents.EditUser,{user:{userId:Number(e.object.user_id),userName:e.object.user_name,displayName:e.object.display_name,conversationsList:e.object.conversations_list,notificationEvents:e.object.notification_events?e.object.notification_events.map(t.msgEventToMessengerEvent):void 0,customData:e.object.custom_data,privateCustomData:e.object.private_custom_data},initiator:Number(e.initiator),messengerAction:g.default.MessengerAction[e.on_incoming_event],timestamp:"number"==typeof e.timestamp?1e3*e.timestamp:void 0,requestUuid:n},n)}),this.signalling.addEventListener(l.MsgEvent.onGetUser,function(e,n){t._dispatchEvent(g.default.MessengerEvents.GetUser,{user:{userId:Number(e.object.user_id),userName:e.object.user_name,displayName:e.object.display_name,conversationsList:e.object.conversations_list,notificationEvents:e.object.notification_events?e.object.notification_events.map(t.msgEventToMessengerEvent):void 0,customData:e.object.custom_data,privateCustomData:e.object.private_custom_data},initiator:Number(e.initiator),messengerAction:g.default.MessengerAction[e.on_incoming_event],requestUuid:n},n)}),this.signalling.addEventListener(l.MsgEvent.onSetStatus,function(e,n){t._dispatchEvent(g.default.MessengerEvents.SetStatus,{online:e.object.online,initiator:Number(e.initiator),messengerAction:g.default.MessengerAction[e.on_incoming_event],timestamp:"number"==typeof e.timestamp?1e3*e.timestamp:void 0,requestUuid:n},n)}),this.signalling.addEventListener(l.MsgEvent.onSubscribe,function(e,n){t._dispatchEvent(g.default.MessengerEvents.Subscribe,{users:e.object.user_id,initiator:Number(e.initiator),messengerAction:g.default.MessengerAction[e.on_incoming_event],requestUuid:n},n)}),this.signalling.addEventListener(l.MsgEvent.onUnsubscribe,function(e,n){t._dispatchEvent(g.default.MessengerEvents.Unsubscribe,{users:e.object.user_id,initiator:Number(e.initiator),messengerAction:g.default.MessengerAction[e.on_incoming_event],requestUuid:n},n)}),this.signalling.addEventListener(l.MsgEvent.onGetSubscriptionList,function(e,n){t._dispatchEvent(g.default.MessengerEvents.GetSubscriptionList,{users:e.object.subscriptions,initiator:Number(e.initiator),messengerAction:g.default.MessengerAction[e.on_incoming_event],requestUuid:n},n)})}return i(e,[{key:"addEventListener",value:function(e,t){void 0===this.eventListeners[e]&&(this.eventListeners[e]=[]),this.eventListeners[e].push(t)}},{key:"removeEventListener",value:function(e,t){if(void 0!==this.eventListeners[e])if("function"==typeof t){for(var n=0;n<this.eventListeners[e].length;n++)if(this.eventListeners[e][n]===t){this.eventListeners[e].splice(n,1);break}}else this.eventListeners[e]=[]}},{key:"on",value:function(e,t){this.addEventListener(e,t)}},{key:"off",value:function(e,t){this.removeEventListener(e,t)}},{key:"_dispatchEvent",value:function(e,t,n){void 0!==this.eventListeners[e]&&this.eventListeners[e].forEach(function(e){"function"==typeof e&&e(t)}),n&&void 0!==this.awaitPromiseList[n]&&(e===g.default.MessengerEvents.Error&&"function"==typeof this.awaitPromiseList[n].reject&&this.awaitPromiseList[n].reject(t),"function"==typeof this.awaitPromiseList[n].resolve&&this.awaitPromiseList[n].resolve(t),window.clearTimeout(this.awaitPromiseList[n].expire)),void 0!==this.eventListeners[e]&&0!=this.eventListeners[e].length||s.LogManager.get().writeMessage(s.LogCategory.MESSAGING,"",s.LogLevel.INFO,"The "+e+" event dispatched, but no handler registered for this event type.")}},{key:"_registerPromise",value:function(t,n,r){this.awaitPromiseList[t]={resolve:n,reject:r,expire:window.setTimeout(r,e.rejectTimeout)}}},{key:"getConversation",value:function(e){return this.cm.getConversation(e)}},{key:"getConversations",value:function(e){return Array.isArray(e)&&e.length>30?void s.LogManager.get().writeMessage(s.LogCategory.MESSAGING,"Rate limit",s.LogLevel.ERROR,"you can get maximum 30 conversation in a single getConversations call"):this.cm.getConversations(e)}},{key:"getPublicConversations",value:function(){return this.cm.getPublicConversations()}},{key:"getRawConversations",value:function(e){return this.cm.getConversations(e)}},{key:"createConversation",value:function(e,t,n,r,i,o){return this.cm.createConversation(e,t,n,r,i,o)}},{key:"createConversationFromCache",value:function(e){return e&&"object"===(void 0===e?"undefined":o(e))?d.Conversation.createFromCache(e):null}},{key:"joinConversation",value:function(t){var n=this;return new Promise(function(r,i){var o=n.signalling.sendWsMessage(h.MsgAction.joinConversation,{uuid:t});e.getInstance()._registerPromise(o,r,i)})}},{key:"leaveConversation",value:function(t){var n=this;return new Promise(function(r,i){var o=n.signalling.sendWsMessage(h.MsgAction.leaveConversation,{uuid:t});e.getInstance()._registerPromise(o,r,i)})}},{key:"getMe",value:function(){return u.default.extractUserName(p.Authenticator.get().username())}},{key:"getMyId",value:function(){return this.currentUserId?Promise.resolve(this.currentUserId):this.getUser(this.getMe()).then(function(e){return e.user.userId})}},{key:"getUser",value:function(t){var n=this;return new Promise(function(r,i){var o=void 0,a=function e(t){t.requestUuid===o&&(clearTimeout(c),n.off(g.default.MessengerEvents.GetUser,e),n.off(g.default.MessengerEvents.Error,s),t.user.userName===n.getMe()&&(n.currentUserId=Number(t.user.userId)),r(t))},s=function e(t){t.requestUuid===o&&(clearTimeout(c),n.off(g.default.MessengerEvents.GetUser,a),n.off(g.default.MessengerEvents.Error,e),i(t))},c=setTimeout(function(){e.getInstance().off(g.default.MessengerEvents.GetUser,a),e.getInstance().off(g.default.MessengerEvents.Error,s),e.getInstance().reject(g.default.MessengerError.Error_0,g.default.MessengerAction.getUser).catch(i)},e.rejectTimeout);n.on(g.default.MessengerEvents.GetUser,a),n.on(g.default.MessengerEvents.Error,s),o=n.signalling.sendWsMessage(h.MsgAction.getUser,{user_name:t})})}},{key:"getUserById",value:function(t){var n=this;return new Promise(function(r,i){var o=n.signalling.sendWsMessage(h.MsgAction.getUser,{user_id:t});e.getInstance()._registerPromise(o,r,i)})}},{key:"getUsers",value:function(t){if(!Array.isArray(t))return e.getInstance().reject(g.default.MessengerError.Error_0,g.default.MessengerAction.getUsers);var n=void 0,r=Promise.all(t.map(function(t){return new Promise(function(r,i){var o=function i(o){o.requestUuid===n&&o.user.userName===t&&(clearTimeout(s),e.getInstance().off(g.default.MessengerEvents.GetUser,i),e.getInstance().off(g.default.MessengerEvents.Error,a),r(o))},a=function t(r){r.requestUuid===n&&(clearTimeout(s),e.getInstance().off(g.default.MessengerEvents.GetUser,o),e.getInstance().off(g.default.MessengerEvents.Error,t),i(r))},s=setTimeout(function(){e.getInstance().off(g.default.MessengerEvents.GetUser,o),e.getInstance().off(g.default.MessengerEvents.Error,a),e.getInstance().reject(g.default.MessengerError.Error_0,g.default.MessengerAction.getUsers).catch(i)},e.rejectTimeout);e.getInstance().on(g.default.MessengerEvents.GetUser,o),e.getInstance().on(g.default.MessengerEvents.Error,a)})}));return n=this.signalling.sendWsMessage(h.MsgAction.getUsers,{users:t.map(function(e){return{user_name:e}})}),r}},{key:"getUsersById",value:function(t){if(!Array.isArray(t))return e.getInstance().reject(g.default.MessengerError.Error_0,g.default.MessengerAction.getUsers);var n=void 0,r=Promise.all(t.map(function(t){return new Promise(function(r,i){var o=function i(o){o.requestUuid===n&&o.user.userId===t&&(clearTimeout(s),e.getInstance().off(g.default.MessengerEvents.GetUser,i),e.getInstance().off(g.default.MessengerEvents.Error,a),r(o))},a=function t(r){r.requestUuid===n&&(clearTimeout(s),e.getInstance().off(g.default.MessengerEvents.GetUser,o),e.getInstance().off(g.default.MessengerEvents.Error,t),i(r))},s=setTimeout(function(){e.getInstance().off(g.default.MessengerEvents.GetUser,o),e.getInstance().off(g.default.MessengerEvents.Error,a),e.getInstance().reject(g.default.MessengerError.Error_0,g.default.MessengerAction.getUsers).catch(i)},e.rejectTimeout);e.getInstance().on(g.default.MessengerEvents.GetUser,o),e.getInstance().on(g.default.MessengerEvents.Error,a)})}));return n=this.signalling.sendWsMessage(h.MsgAction.getUsers,{users:t.map(function(e){return{user_id:e}})}),r}},{key:"editUser",value:function(t,n){var r=this,i={};return t&&(i.custom_data=t),n&&(i.private_custom_data=n),new Promise(function(t,n){var o=r.signalling.sendWsMessage(h.MsgAction.editUser,i);e.getInstance()._registerPromise(o,t,n)})}},{key:"setStatus",value:function(t){var n=this;return new Promise(function(r,i){var o=n.signalling.sendWsMessage(h.MsgAction.setStatus,{online:t});e.getInstance()._registerPromise(o,r,i)})}},{key:"subscribe",value:function(t){var n=this;return new Promise(function(r,i){var o=n.signalling.sendWsMessage(h.MsgAction.subscribe,{user_id:t});e.getInstance()._registerPromise(o,r,i)})}},{key:"unsubscribe",value:function(t,n){var r=this;return new Promise(function(i,o){var a=r.signalling.sendWsMessage(h.MsgAction.unsubscribe,{user_id:t,all:n});e.getInstance()._registerPromise(a,i,o)})}},{key:"getSubscriptionList",value:function(){var t=this;return new Promise(function(n,r){var i=t.signalling.sendWsMessage(h.MsgAction.getSubscriptionList,{});e.getInstance()._registerPromise(i,n,r)})}},{key:"manageNotification",value:function(t){var n=this;return new Promise(function(r,i){var o=n.signalling.sendWsMessage(h.MsgAction.manageNotification,{notifications:t.map(function(e){return e===g.default.MessengerEvents.CreateConversation?l.MsgEvent.onCreateConversation:e===g.default.MessengerEvents.SendMessage?l.MsgEvent.onSendMessage:e===g.default.MessengerEvents.EditMessage?l.MsgEvent.onEditMessage:void 0})});e.getInstance()._registerPromise(o,r,i)})}},{key:"createMessageFromCache",value:function(e){return e&&"object"===(void 0===e?"undefined":o(e))?f.Message.createFromCache(e):null}},{key:"reject",value:function(e,t){var n={code:e,description:m[e],initiator:this.currentUserId,messengerAction:t};return this._dispatchEvent(g.default.MessengerEvents.Error,n),Promise.reject(n)}},{key:"msgEventToMessengerEvent",value:function(e){return e===l.MsgEvent.onCreateConversation?g.default.MessengerEvents.CreateConversation:e===l.MsgEvent.onSendMessage?g.default.MessengerEvents.SendMessage:e===l.MsgEvent.onEditMessage?g.default.MessengerEvents.EditMessage:e}},{key:"_traceName",value:function(){return"Messenger"}}],[{key:"getInstance",value:function(){return e.instance=e.instance||new e,e.instance}}]),e}();y.rejectTimeout=2e4,a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"addEventListener",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"removeEventListener",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"on",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"off",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"_dispatchEvent",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"_registerPromise",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"getConversation",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"getConversations",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"getPublicConversations",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"getRawConversations",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"createConversation",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"createConversationFromCache",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"joinConversation",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"leaveConversation",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"getMe",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"getMyId",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"getUser",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"getUserById",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"getUsers",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"getUsersById",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"editUser",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"setStatus",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"subscribe",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"unsubscribe",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"getSubscriptionList",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"manageNotification",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y.prototype,"createMessageFromCache",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],y,"getInstance",null),t.Messenger=y},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,t,n,r){var i,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":o(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(a<3?i(s):a>3?i(t,n,s):i(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),c=n(19),l=n(29),u=n(27),d=function(){function e(t,n){r(this,e),this._text=t,void 0!==n&&Array.isArray(n)&&n.every(function(e){return e&&"object"===(void 0===e?"undefined":o(e))})?this._payload=n:this._payload=[]}return i(e,[{key:"toCache",value:function(){return{uuid:this._uuid,text:this._text,payload:this._payload,conversation:this._conversation,sender:this._sender}}},{key:"getPayload",value:function(){var e={text:this._text,conversation:this._conversation};return void 0!==this._payload&&Array.isArray(this._payload)&&this._payload.every(function(e){return"object"===(void 0===e?"undefined":o(e))})?e.payload=this._payload:e.payload=[],e}},{key:"sendTo",value:function(e){var t=this;return this._conversation=e.uuid,new Promise(function(e,n){var r=c.MsgSignaling.get().sendWsMessage(l.MsgAction.sendMessage,t.getPayload());u.Messenger.getInstance()._registerPromise(r,e,n)})}},{key:"update",value:function(){var e=this;return new Promise(function(t,n){var r=c.MsgSignaling.get().sendWsMessage(l.MsgAction.editMessage,Object.assign(e.getPayload(),{uuid:e._uuid}));u.Messenger.getInstance()._registerPromise(r,t,n)})}},{key:"remove",value:function(){var e=this;return new Promise(function(t,n){var r=c.MsgSignaling.get().sendWsMessage(l.MsgAction.removeMessage,{uuid:e._uuid,conversation:e.conversation});u.Messenger.getInstance()._registerPromise(r,t,n)})}},{key:"_traceName",value:function(){return"Message"}},{key:"uuid",get:function(){return this._uuid}},{key:"conversation",get:function(){return this._conversation}},{key:"text",get:function(){return this._text},set:function(e){this._text=e}},{key:"payload",get:function(){return this._payload},set:function(e){this._payload=e}},{key:"sender",get:function(){return this._sender}}],[{key:"_createFromBus",value:function(t,n){var r=new e(t.text,t.payload);return r._uuid=t.uuid,r._conversation=t.conversation,r._sender=n,r}},{key:"createFromCache",value:function(t){var n=new e(t.text,t.payload);return n._uuid=t.uuid,n._conversation=t.conversation,n._sender=Number(t.sender),n}}]),e}();a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],d.prototype,"toCache",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],d.prototype,"getPayload",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],d.prototype,"sendTo",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],d.prototype,"update",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],d.prototype,"remove",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],d,"_createFromBus",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],d,"createFromCache",null),t.Message=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});!function(e){e.UNKNOWN="UNKNOWN",e.createConversation="createConversation",e.editConversation="editConversation",e.removeConversation="removeConversation",e.joinConversation="joinConversation",e.leaveConversation="leaveConversation",e.getConversation="getConversation",e.getConversations="getConversations",e.getPublicConversations="getPublicConversations",e.searchConversations="searchConversations",e.removeEmptyConversation="removeEmptyConversation",e.addParticipants="addParticipants",e.editParticipants="editParticipants",e.removeParticipants="removeParticipants",e.getUser="getUser",e.getUsers="getUsers",e.editUser="editUser",e.setStatus="setStatus",e.sendMessage="sendMessage",e.editMessage="editMessage",e.removeMessage="removeMessage",e.typingMessage="typingMessage",e.isRead="isRead",e.subscribe="subscribe",e.unsubscribe="unsubscribe",e.manageNotification="manageNotification",e.getSubscriptionList="getSubscriptionList",e.createBot="createBot",e.removeBot="removeBot",e.retransmitEvents="retransmitEvents"}(t.MsgAction||(t.MsgAction={}))},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,t,n,r){var i,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":o(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(a<3?i(s):a>3?i(t,n,s):i(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(t,"__esModule",{value:!0});var s,c=n(0),l=n(2),u=n(6),d=n(12),f=n(13),g=n(3),p=n(42),v=n(1),h=n(4),m=n(32);!function(e){e[e.IDLE=0]="IDLE",e[e.REMOTEOFFER=1]="REMOTEOFFER",e[e.LOCALOFFER=2]="LOCALOFFER",e[e.ESTABLISHING=3]="ESTABLISHING",e[e.ESTABLISHED=4]="ESTABLISHED",e[e.CLOSED=5]="CLOSED"}(s=t.PeerConnectionState||(t.PeerConnectionState={}));var y;!function(e){e[e.CLIENT_SERVER_V1=0]="CLIENT_SERVER_V1",e[e.P2P=1]="P2P",e[e.CONFERENCE=2]="CONFERENCE"}(y=t.PeerConnectionMode||(t.PeerConnectionMode={}));var C=function(){function e(t,n,i){r(this,e),this.id=t,this.mode=n,this.videoEnabled=i,this.onHold=!1,this.muteMicState=!1,this.SEND_CANDIDATE_DELAY=1e3,this.mediaRepository=[],this.candidateList=[],this.localCandidateTimer=-1,this.logger=c.LogManager.get().createLogger(c.LogCategory.RTC,this._traceName()+" "+t),this.logger.info("PC created"),this.state=s.IDLE,this.pendingCandidates=[],"_default"!==t&&u.CallManager.get().calls[t]&&(this.reInviteQ=new p.ReInviteQ(u.CallManager.get().calls[t],this._canReInvite))}return i(e,[{key:"getId",value:function(){return this.id}},{key:"getState",value:function(){return this.state}},{key:"processRemoteAnswer",value:function(e,t){return this.state=s.ESTABLISHING,this._processRemoteAnswer(e,t)}},{key:"getLocalOffer",value:function(){return this.state===s.IDLE||this.state===s.ESTABLISHED||s.LOCALOFFER?(this.logger.info("getLocalOffer()"),this.state=s.LOCALOFFER,this._getLocalOffer()):(this.logger.error("getLocalOffer() in state "+s[this.state]),new Promise(function(e,t){t("Invalid state")}))}},{key:"getLocalAnswer",value:function(){return this._getLocalAnswer()}},{key:"processRemoteOffer",value:function(e){return this.state===s.IDLE||this.state===s.ESTABLISHED?(this.state=s.ESTABLISHING,this._processRemoteOffer(e)):(this.logger.error("processRemoteOffer() in state "+s[this.state]),new Promise(function(e,t){t("Invalid state")}))}},{key:"close",value:function(){this.logger.info("close()"),this._close()}},{key:"addRemoteCandidate",value:function(e,t){return this.logger.info("addRemoteCandidate("+e+", "+t+")"),this._addRemoteCandidate(e,t)}},{key:"handleReinvite",value:function(e,t,n){return this._handleReinvite(e,t,n)}},{key:"handleRemoteOffer",value:function(e,t,n){return this._handleRemoteOffer(e,t,n)}},{key:"addCandidateToSend",value:function(e,t){this.pendingCandidates.push([t,e]),this.canSendCandidates&&this.startCandidateSendTimer()}},{key:"canStartSendingCandidates",value:function(){this.canSendCandidates=!0,this.startCandidateSendTimer()}},{key:"sendDTMF",value:function(e){this._sendDTMF(e,500,50)}},{key:"setVideoEnabled",value:function(e){var t=this.videoEnabled.receiveVideo;this.videoEnabled=e,t!=e.receiveVideo&&this._hold(this.onHold)}},{key:"setVideoFlags",value:function(e){this.videoEnabled=e}},{key:"getDirections",value:function(){return this._getDirections()}},{key:"setHoldKey",value:function(e){this.onHold=e}},{key:"getTrackKind",value:function(e){if(this._call){var t=h.default.StreamManager.get()._getTracksKind(this._call),n=this.getTransceivers(),r=m.default.parse(e),i=[];for(var o in t)!function(e){if(t.hasOwnProperty(e)){var o=n.find(function(t){return!t.stopped&&t.sender&&t.sender.track&&t.sender.track.id===e});if(o){var a=r.media.find(function(e){return e.attr.some(function(e){return"mid"===e.name&&e.value===o.mid})});if(a){var s=a.attr.find(function(e){return"msid"===e.name});if(s){var c=s.value.split(" ");if(c.length>1){var l=c[1];l!=e&&i.push({from:e,to:l})}}}}}}(o);var a=Object.assign({},t);return i.forEach(function(e){var t=a[e.from];delete a[e.from],a[e.to]=t}),a}return{}}},{key:"sendMedia",value:function(e,t){var n=this;return new Promise(function(e,t){if(n.onHold)return void t({result:!1,call:n._call});n.reInviteQ.add({fx:function(){v.Client.getInstance().config();h.default.StreamManager.get().updateCallStream(n._call)},reject:t,resolve:function(t){n.restoreMute(),e(t)}})})}},{key:"hold",value:function(e){var t=this;return new Promise(function(n,r){t.onHold===e&&n({call:t._call,name:"Updated",result:!0}),t.reInviteQ.add({fx:function(){t._hold(e)},reject:r,resolve:function(e){t.restoreMute(),n(e)}})})}},{key:"hdnFRS",value:function(){var e=this;return new Promise(function(t,n){if(e.onHold)return void n({result:!1,call:e._call});e.reInviteQ.add({fx:function(){e._hdnFRS()},reject:n,resolve:function(n){e.restoreMute(),t(n)}})})}},{key:"muteMicrophone",value:function(e){var t=this;this.muteMicState!==e&&(this.muteMicState=e,this.getTransceivers().forEach(function(e){"audio"===(e.sender&&e.sender.track?e.sender.track.kind:null)&&"live"===e.sender.track.readyState&&(e.sender.track.enabled=!t.muteMicState)}))}},{key:"restoreMute",value:function(){var e=this;if(this._call.settings.active){setTimeout(function(){e._call.settings.state!==d.CallState.ENDED&&(e._call.restoreRMute(),e.getTransceivers().forEach(function(t){"audio"===(t.sender&&t.sender.track?t.sender.track.kind:null)&&"live"===t.sender.track.readyState&&(t.sender.track.enabled=!e.muteMicState)}))},100)}}},{key:"restoreVideoSending",value:function(){}},{key:"addCustomMedia",value:function(e){var t=this;return new Promise(function(n,r){t.reInviteQ.add({fx:function(){t._addCustomMedia(e)},reject:r,resolve:function(e){t.restoreMute(),n()}})})}},{key:"fastAddCustomMedia",value:function(e){this._addCustomMedia(e)}},{key:"fastRemoveCustomMedia",value:function(e){this._removeCustomMedia(e)}},{key:"removeCustomMedia",value:function(e){var t=this;return new Promise(function(n,r){t.reInviteQ.add({fx:function(){t._removeCustomMedia(e)},reject:r,resolve:function(e){t.restoreMute(),n()}})})}},{key:"updateCustomMedia",value:function(e){this._updateCustomMedia(e)}},{key:"replaceVideoTrack",value:function(e){this._replaceVideoTrack(e)}},{key:"_traceName",value:function(){return"PeerConnection"}},{key:"setState",value:function(e){this.logger.info("Transmitting from "+s[this.state]+" to "+s[e]),this.state=e}},{key:"sendLocalCandidateToPeer",value:function(e,t){var n=this;this._call=u.CallManager.get().calls[this.id],this.mode===y.CLIENT_SERVER_V1?l.VoxSignaling.get().callRemoteFunction(g.RemoteFunction.addCandidate,this.id,e,t):(this.candidateList.push([t,e]),this.localCandidateTimer<=0&&(this.localCandidateTimer=window.setTimeout(function(){window.clearTimeout(n.localCandidateTimer),n.localCandidateTimer=-1,u.CallManager.get().calls[n.id]&&u.CallManager.get().calls[n.id].sendInfo(f.Constants.P2P_SPD_FRAG_MIME_TYPE,JSON.stringify(n.candidateList),{}),n.candidateList=[]},200)))}},{key:"startCandidateSendTimer",value:function(){var e=this;null!==this.candidateSendTimer&&void 0!==this.candidateSendTimer||(this.candidateSendTimer=setTimeout(function(){e.candidateSendTimer=null,e.pendingCandidates.length>0&&u.CallManager.get().calls[e.id]&&u.CallManager.get().calls[e.id].sendInfo(f.Constants.P2P_SPD_FRAG_MIME_TYPE,JSON.stringify(e.pendingCandidates),{}),e.pendingCandidates=[]},this.SEND_CANDIDATE_DELAY))}},{key:"remoteStreams",get:function(){return this._remoteStreams}}]),e}();a([c.LogManager.d_trace(c.LogCategory.RTC)],C.prototype,"getState",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],C.prototype,"processRemoteAnswer",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],C.prototype,"getLocalOffer",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],C.prototype,"getLocalAnswer",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],C.prototype,"processRemoteOffer",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],C.prototype,"close",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],C.prototype,"addRemoteCandidate",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],C.prototype,"handleReinvite",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],C.prototype,"handleRemoteOffer",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],C.prototype,"addCandidateToSend",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],C.prototype,"canStartSendingCandidates",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],C.prototype,"sendDTMF",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],C.prototype,"setVideoEnabled",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],C.prototype,"setVideoFlags",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],C.prototype,"setHoldKey",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],C.prototype,"getTrackKind",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],C.prototype,"sendMedia",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],C.prototype,"hold",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],C.prototype,"hdnFRS",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],C.prototype,"muteMicrophone",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],C.prototype,"restoreMute",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],C.prototype,"restoreVideoSending",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],C.prototype,"addCustomMedia",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],C.prototype,"fastAddCustomMedia",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],C.prototype,"fastRemoveCustomMedia",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],C.prototype,"removeCustomMedia",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],C.prototype,"updateCustomMedia",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],C.prototype,"replaceVideoTrack",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],C.prototype,"setState",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],C.prototype,"sendLocalCandidateToPeer",null),a([c.LogManager.d_trace(c.LogCategory.RTC)],C.prototype,"startCandidateSendTimer",null),t.PeerConnection=C},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(10),a=n(57),s=n(58),c=function(){function e(){throw r(this,e),new Error("Please, use the EndpointManager.get() instead create new object")}return i(e,null,[{key:"get",value:function(){return void 0===this.instance&&(o.PCFactory.hasTransceivers?e.instance=new a.TransceiversEndpointManager:e.instance=new s.PlainEndpointManager),this.instance}}]),e}();t.EndpointManager=c},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){r(this,e),this.attrCount=0,this.bandwCount=0,this.mediaCount=0,this.dummyLines=[]}return i(e,[{key:"addSessionAttribute",value:function(e){void 0===this.attr&&(this.attr=[]),this.attr.push(e),this.attrCount++}},{key:"addMediaAttribute",value:function(e,t){void 0===this.media[t].attr&&(this.media[t].attr=[]);var n=e.value.split(" ")[0],r=["ssrc"],i=["rtcp","ice-ufrag","ice-pwd","ice-options","fingerprint","setup"],o=["rtpmap","rtcp-fb","fmtp"],a=["extmap"];~i.indexOf(e.name)?this.addAttr(t,e,"ice"):~o.indexOf(e.name)?this.addAttr(t,e,"rtpmap",n):~a.indexOf(e.name)?this.addAttr(t,e,"extmap"):~r.indexOf(e.name)?this.addAttr(t,e,"ssrc"):this.media[t].attr.push(e),this.media[t].attrCount++}},{key:"addAttr",value:function(e,t,n,r){var i=this.media[e].attr.findIndex(function(e){return r?e.name===n&&e.value[0].value.split(" ")[0]===r:e.name===n});-1!==i?this.media[e].attr[i].value.push(t):this.media[e].attr.push({name:n,value:[t]})}},{key:"toString",value:function(){var t=this,n=[];n.push("v=0"),n.push("o="+this.origin.user+" "+this.origin.id+" "+this.origin.version+" "+this.origin.netType+" "+this.origin.addrType+" "+this.origin.addr),n.push("s="+this.name),this.conn&&n.push(e.printConnectionInfo(this.conn));for(var r=0;r<this.bandwCount;r++)n.push(e.printBandwidthInfo(this.bandw[r]));n.push("t="+this.time.start+" "+this.time.stop);for(var i=0;i<this.attrCount;i++)n.push(e.printAttrInfo(this.attr[i]));for(var o=0;o<this.mediaCount;o++)!function(r){for(var i=t.media[r],o="m="+i.descr.media+" "+i.descr.port+(i.descr.portCount?"/"+i.descr.portCount:"")+" "+i.descr.transport,a=0;a<i.descr.fmtCount;a++)o+=" "+i.descr.fmt[a];n.push(o),i.conn&&n.push(e.printConnectionInfo(i.conn));for(var s=0;s<i.bandwCount;s++)n.push(e.printBandwidthInfo(i.bandw[s]));var c=["sendrecv","sendonly","recvonly","inactive"],l=i.attr.find(function(e){return!!~c.indexOf(e.name)});l&&n.push(e.printAttrInfo(l));var u=i.attr.find(function(e){return"ice"===e.name});u&&u.value.forEach(function(t){n.push(e.printAttrInfo(t))});for(var d=i.attr.filter(function(e){return"ice"!==e.name&&!~c.indexOf(e.name)}),f=0;f<d.length;f++)Array.isArray(d[f].value)?d[f].value.forEach(function(t){n.push(e.printAttrInfo(t))}):n.push(e.printAttrInfo(d[f]))}(o);return n.join("\r\n")+"\r\n"}}],[{key:"parse",value:function(t){var n=new e;return e.splitLines(t).forEach(function(t,r){switch(t.trim().charAt(0)){case"a":var i=e.parseAttr(t,r);if(i)if(n.mediaCount){if(!(n.media[n.mediaCount-1].attrCount<260))throw new Error("Error adding media attribute, attribute is ignored");n.addMediaAttribute(i,n.mediaCount-1)}else{if(!(n.attrCount<260))throw new Error("Error adding media attribute, attribute is ignored");n.addSessionAttribute(i)}break;case"o":n.origin=e.parseOrigin(t,r);break;case"s":n.name=e.parseGenericLine(t,r);break;case"c":var o=e.parseConnectionInfo(t,r);n.mediaCount?n.media[n.mediaCount-1].conn=o:n.conn=o;break;case"t":n.time=e.parseTime(t,r);break;case"m":var a=e.parseMedia(t,r);if(void 0===n.media&&(n.media=[]),!(n.mediaCount<256))throw new Error("Error adding media, media is ignored");n.media[n.mediaCount]=a,n.mediaCount++;break;case"v":e.parseVersion(t,r);break;case"b":var s=e.parseBandwidthInfo(t,r);if(n.mediaCount){if(!(n.media[n.mediaCount-1].bandwCount<8))throw new Error("Error adding session bandwidth info, info is ignored");n.media[n.mediaCount-1].bandw.push(s),n.media[n.mediaCount-1].bandwCount++}else{if(!(n.bandwCount<8))throw new Error("Error adding session bandwidth info, info is ignored");void 0===n.bandw&&(n.bandw=[]),n.bandw[n.bandwCount]=s,n.bandwCount++}break;default:n.dummyLines.push(e.parseGenericLine(t,r))}}),n}},{key:"parseAttr",value:function(t,n){0!==t.indexOf("a=")&&e.scannerError(t,n);var r=e.chopLine(t).split(":");return{name:r[0],value:r.slice(1).join(":")}}},{key:"splitLines",value:function(e){return e.split(/(\r\n|\r|\n)/).filter(function(e){return e.length>0}).filter(RegExp.prototype.test.bind(/^([a-z])=(.*)/))}},{key:"parseGenericLine",value:function(t,n){return 1!==t.indexOf("=")&&e.scannerError(t,n),t.substr(2)}},{key:"parseOrigin",value:function(t,n){0!==t.indexOf("o=")&&e.scannerError(t,n);var r=e.chopLine(t).split(/[\s\t]+/);return{user:r[0],id:r[1],version:r[2],netType:r[3],addrType:r[4],addr:r[5]}}},{key:"parseVersion",value:function(t,n){0!==t.indexOf("v=0")&&e.scannerError(t,n)}},{key:"parseTime",value:function(t,n){0!==t.indexOf("t=")&&e.scannerError(t,n);var r=e.chopLine(t).split(/[\s\t]+/);return{start:parseInt(r[0]),stop:parseInt(r[1])}}},{key:"parseConnectionInfo",value:function(t,n){0!==t.indexOf("c=")&&e.scannerError(t,n);var r=e.chopLine(t).split(/[\s\t]+/);return{netType:r[0],addrType:r[1],addr:r[2]}}},{key:"parseBandwidthInfo",value:function(t,n){0!==t.indexOf("b=")&&e.scannerError(t,n);var r=e.chopLine(t).split(/[:]+/);return{modifier:r[0],value:parseInt(r[1])}}},{key:"scannerError",value:function(e,t){throw new Error("Error parsing sdp in line "+t+': "'+e+'" is not valid sdp line')}},{key:"chopLine",value:function(e){return e.substr(2)}},{key:"parseMedia",value:function(t,n){0!==t.indexOf("m=")&&e.scannerError(t,n);var r=e.chopLine(t).split(/[\s\t]+/),i=r[1].split("/");return{descr:{media:r[0],port:parseInt(i[0]),portCount:parseInt(i[1]||"0"),transport:r[2],fmtCount:r.length-3,fmt:r.slice(3)},attrCount:0,bandwCount:0,attr:[],bandw:[]}}},{key:"printConnectionInfo",value:function(e){return"c="+e.netType+" "+e.addrType+" "+e.addr}},{key:"printBandwidthInfo",value:function(e){return"b="+e.modifier+":"+e.value}},{key:"printAttrInfo",value:function(e){return"a="+e.name+(e.value?":"+e.value:"")}}]),e}();o.SDP_EINSDP="Wrong sdp lines",t.default=o},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,t,n,r){var i,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":o(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(a<3?i(s):a>3?i(t,n,s):i(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),c=n(27),l=n(47),u=n(28),d=n(19),f=n(29),g=n(43),p=n(21),v=function(){function e(t){r(this,e),this._backup={},this._uuid=t.uuid,this._participants=t.participants,this._title=t.title,this._direct=t.direct,this._publicJoin=t.publicJoin,this._uberConversation=t.uberConversation,this._customData=t.customData,this._createdAt=t.createdAt,this._lastUpdate=t.lastUpdate,this._lastSeq=Number(t.lastSeq)}return i(e,[{key:"updateSeq",value:function(e){"number"==typeof e&&e>this._lastSeq&&(this._lastSeq=e),this._lastUpdate=Date.now()/1e3|0}},{key:"toCache",value:function(){return{uuid:this._uuid,title:this._title,participants:this._participants,direct:this._direct,publicJoin:this._publicJoin,uberConversation:this._uberConversation,createdAt:this._createdAt,lastUpdate:this._lastUpdate,customData:this._customData,lastSeq:this._lastSeq}}},{key:"_getCreatePayload",value:function(){return{participants:this._prepareParticipants(this._participants).map(function(e){return Object.assign(e,{flags:e.flags?e.flags:7})}),title:"string"==typeof this._title?this._title:"",direct:"boolean"==typeof this._direct&&this._direct,enable_public_join:"boolean"==typeof this._publicJoin&&this._publicJoin,uber_conversation:"boolean"==typeof this._uberConversation?this._uberConversation:void 0,custom_data:"object"==o(this._customData)?this._customData:{}}}},{key:"_getEditPayload",value:function(){if(void 0===this._uuid)throw Error("You must get conversation UUID with MessengetAction.getConversation() action!");return{uuid:this._uuid,title:"string"==typeof this._title?this._title:"",enable_public_join:"boolean"==typeof this._publicJoin&&this._publicJoin,custom_data:"object"==o(this._customData)?this._customData:{}}}},{key:"_getUserPermissions",value:function(e){var t=(e.isOwner?"1000000000":"")+[e.canRemoveAll,e.canEditAll,e.canManageParticipants,e.canRemove,e.canEdit,e.canWrite].map(function(e){return e?1:0}).join("");return parseInt(t,2)}},{key:"_prepareParticipants",value:function(e){var t=this;return e.map(function(e){return{user_id:e.userId,flags:t._getUserPermissions(e),last_read:e.lastRead}})}},{key:"_revertChanges",value:function(){var e=this;Object.keys(this._backup).forEach(function(t){e[t]=e._backup[t]}),this._backup={}}},{key:"update",value:function(){return l.default.get().editConversation(this)}},{key:"setTitle",value:function(e){return"string"!=typeof e?c.Messenger.getInstance().reject(p.default.MessengerError.Error_0,p.default.MessengerAction.editConversation):(this._backup.title=this._title,this._title=e,l.default.get().editConversation(this))}},{key:"setPublicJoin",value:function(e){return"boolean"!=typeof e?c.Messenger.getInstance().reject(p.default.MessengerError.Error_0,p.default.MessengerAction.editConversation):(this._backup.publicJoin=this._publicJoin,this._publicJoin=e,l.default.get().editConversation(this))}},{key:"setCustomData",value:function(e){return!e||Array.isArray(e)||"object"!=(void 0===e?"undefined":o(e))?c.Messenger.getInstance().reject(p.default.MessengerError.Error_0,p.default.MessengerAction.editConversation):(this._backup.customData=this._customData,this._customData=e,l.default.get().editConversation(this))}},{key:"addParticipants",value:function(e){var t=this;return Array.isArray(e)&&0!=e.length?new Promise(function(n,r){var i=d.MsgSignaling.get().sendWsMessage(f.MsgAction.addParticipants,{uuid:t._uuid,participants:t._prepareParticipants(e)});c.Messenger.getInstance()._registerPromise(i,n,r)}):c.Messenger.getInstance().reject(p.default.MessengerError.Error_0,p.default.MessengerAction.addParticipants)}},{key:"editParticipants",value:function(e){var t=this;return Array.isArray(e)&&0!=e.length?new Promise(function(n,r){var i=d.MsgSignaling.get().sendWsMessage(f.MsgAction.editParticipants,{uuid:t._uuid,participants:t._prepareParticipants(e)});c.Messenger.getInstance()._registerPromise(i,n,r)}):c.Messenger.getInstance().reject(p.default.MessengerError.Error_0,p.default.MessengerAction.editParticipants)}},{key:"removeParticipants",value:function(e){var t=this;return Array.isArray(e)&&0!=e.length?new Promise(function(n,r){var i=d.MsgSignaling.get().sendWsMessage(f.MsgAction.removeParticipants,{uuid:t._uuid,participants:e.filter(function(e){return void 0!==e.userId}).map(function(e){return e.userId})});c.Messenger.getInstance()._registerPromise(i,n,r)}):c.Messenger.getInstance().reject(p.default.MessengerError.Error_0,p.default.MessengerAction.removeParticipants)}},{key:"sendMessage",value:function(e,t){return"string"==typeof e&&void 0!==t&&Array.isArray(t)&&t.every(function(e){return e&&"object"===(void 0===e?"undefined":o(e))})?new u.Message(e,t).sendTo(this):c.Messenger.getInstance().reject(p.default.MessengerError.Error_0,p.default.MessengerAction.sendMessage)}},{key:"typing",value:function(){var e=this;return this._debounceLock?Promise.resolve(!1):(setTimeout(function(){e._debounceLock=!1},1e4),this._debounceLock=!0,new Promise(function(t,n){var r=d.MsgSignaling.get().sendWsMessage(f.MsgAction.typingMessage,{conversation:e._uuid});c.Messenger.getInstance()._registerPromise(r,t,n)}))}},{key:"markAsRead",value:function(e){var t=this;return new Promise(function(n,r){var i=d.MsgSignaling.get().sendWsMessage(f.MsgAction.isRead,{conversation:t._uuid,seq:e});c.Messenger.getInstance()._registerPromise(i,n,r)})}},{key:"retransmitEvents",value:function(e,t,n){var r=this;return"number"!=typeof t||"number"!=typeof e?c.Messenger.getInstance().reject(p.default.MessengerError.Error_0,p.default.MessengerAction.retransmitEvents):new Promise(function(i,o){var a=void 0,s=void 0,l=void 0;Promise.all(Array(t-e+1).fill(0).map(function(t,n){return n+e}).map(function(e){return new Promise(function(t,n){var r=function n(r){r.events&&r.events[0]&&Number(r.events[0].seq)===e&&r.requestUuid===a&&(clearTimeout(o),c.Messenger.getInstance().off(p.default.MessengerEvents.RetransmitEvents,n),c.Messenger.getInstance().off(p.default.MessengerEvents.Error,i),s||(s=r.initiator),l||(l=r.messengerAction),t(r.events[0]))},i=function t(i){i.messengerAction==p.default.MessengerAction.retransmitEvents&&i.events&&i.events[0]&&Number(i.events[0].seq)===e&&(clearTimeout(o),c.Messenger.getInstance().off(p.default.MessengerEvents.RetransmitEvents,r),c.Messenger.getInstance().off(p.default.MessengerEvents.Error,t),n(i))},o=setTimeout(function(){c.Messenger.getInstance().off(p.default.MessengerEvents.RetransmitEvents,r),c.Messenger.getInstance().off(p.default.MessengerEvents.Error,i),c.Messenger.getInstance().reject(p.default.MessengerError.Error_0,p.default.MessengerAction.retransmitEvents).catch(n)},c.Messenger.rejectTimeout);c.Messenger.getInstance().on(p.default.MessengerEvents.RetransmitEvents,r),c.Messenger.getInstance().on(p.default.MessengerEvents.Error,i)})})).then(function(e){return i({initiator:s,messengerAction:l,events:e,requestUuid:a})}).catch(o),a=d.MsgSignaling.get().sendWsMessage(f.MsgAction.retransmitEvents,{conversation:r._uuid,events_from:0|e,events_to:0|t,count:n})})}},{key:"_traceName",value:function(){return"Conversation"}},{key:"uuid",get:function(){return this._uuid}},{key:"title",get:function(){return this._title},set:function(e){this._backup.title=this._title,this._title=e}},{key:"createdAt",get:function(){return this._createdAt}},{key:"lastUpdate",get:function(){return this._lastUpdate}},{key:"direct",get:function(){return this._direct}},{key:"uberConversation",get:function(){return this._uberConversation}},{key:"publicJoin",get:function(){return this._publicJoin},set:function(e){this._backup.publicJoin=this._publicJoin,this._publicJoin=e}},{key:"participants",get:function(){return this._participants}},{key:"customData",get:function(){return this._customData},set:function(e){this._backup.customData=this._customData,this._customData=e}},{key:"lastSeq",get:function(){return this._lastSeq}}],[{key:"_createFromBus",value:function(t,n){return new e({participants:t.participants&&Array.isArray(t.participants)?t.participants.map(function(e){var t=Number(e.flags)===g.MsgPermissions.all,n=Number(e.flags)>g.MsgPermissions.is_owner&&e.flags<g.MsgPermissions.all,r=Number(e.flags).toString(2).slice(-6).split("").reverse();return{userId:Number(e.user_id),lastRead:e.last_read,isOwner:t||n,canWrite:t||"1"===r[0],canEdit:t||"1"===r[1],canRemove:t||"1"===r[2],canManageParticipants:t||"1"===r[3],canEditAll:t||"1"===r[4],canRemoveAll:t||"1"===r[5]}}):[],title:t.title,uuid:t.uuid,direct:t.direct,publicJoin:t.enable_public_join,uberConversation:t.uber_conversation,createdAt:t.created_at,lastUpdate:t.last_update,lastSeq:n,customData:t.custom_data&&"object"===o(t.custom_data)?t.custom_data:void 0})}},{key:"createFromCache",value:function(t){return new e({uuid:t.uuid,title:t.title,participants:t.participants||[],direct:t.direct,publicJoin:t.publicJoin,uberConversation:t.uberConversation,createdAt:t.createdAt,lastUpdate:t.lastUpdate,customData:t.customData})}}]),e}();a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],v.prototype,"updateSeq",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],v.prototype,"toCache",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],v.prototype,"_getCreatePayload",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],v.prototype,"_getEditPayload",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],v.prototype,"_prepareParticipants",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],v.prototype,"_revertChanges",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],v.prototype,"update",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],v.prototype,"addParticipants",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],v.prototype,"editParticipants",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],v.prototype,"removeParticipants",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],v.prototype,"typing",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],v.prototype,"markAsRead",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],v.prototype,"retransmitEvents",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],v,"_createFromBus",null),a([s.LogManager.d_trace(s.LogCategory.MESSAGING)],v,"createFromCache",null),t.Conversation=v},function(e,t,n){"use strict";function r(){return o.Client.getInstance()}function i(){if(!a.Authenticator.get().authorized())throw new Error("NOT_AUTHORIZED");return s.default.Messenger.getInstance()}Object.defineProperty(t,"__esModule",{value:!0});var o=n(1);n(69);var a=n(11),s=n(21),c=n(21);t.Messaging=c.Messaging;var l=n(8);t.Events=l.Events;var u=n(5);t.CallEvents=u.CallEvents;var d=n(39);t.Endpoint=d.Endpoint;var f=n(23);t.EndpointEvents=f.EndpointEvents;var g=n(15);t.OperatorACDStatuses=g.OperatorACDStatuses,t.QueueTypes=g.QueueTypes;var p=n(0);t.LogCategory=p.LogCategory,t.LogLevel=p.LogLevel,t.ClientState=p.ClientState,function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(4)),t.getInstance=r,t.version=o.Client.getInstance().version,t.getMessenger=i},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,t,n,r){var i,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":o(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(a<3?i(s):a>3?i(t,n,s):i(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),c=n(22),l=function(){function e(){if(r(this,e),void 0!==e.instance)throw new Error("Error - use StreamManager.get()");navigator&&navigator.mediaDevices&&navigator.mediaDevices.getSupportedConstraints?this._supportedConstraints=navigator.mediaDevices.getSupportedConstraints():this._supportedConstraints={},this.__defaultParams={},this._lastAudioInputDevices=[],this._lastAudioOutputDevices=[],this._callParams={},this.logger=s.LogManager.get().createLogger(s.LogCategory.USERMEDIA,this._traceName())}return i(e,[{key:"getAudioContext",value:function(){if(this.audioContext)return this.audioContext;if(void 0!==window.AudioContext||void 0!==window.webkitAudioContext){window.AudioContext=window.AudioContext||window.webkitAudioContext;try{return this.audioContext=new AudioContext,this.audioContext}catch(e){return this.audioContext=null,null}}}},{key:"prepareAudioContext",value:function(){this.getAudioContext()}},{key:"getInputDevices",value:function(){var e=this;return navigator.mediaDevices.enumerateDevices().then(function(t){return e.logger.info("Got input devices: "+JSON.stringify(t)),e._lastAudioInputDevices=t.map(function(e){if("audio"===e.kind||"audioinput"===e.kind)return{id:e.deviceId,name:e.label,group:e.groupId}}).filter(function(e){return void 0!==e}),e._lastAudioInputDevices})}},{key:"getOutputDevices",value:function(){var e=this;return navigator.mediaDevices.enumerateDevices().then(function(t){return e.logger.info("Got output devices: "+JSON.stringify(t)),e._lastAudioOutputDevices=t.map(function(e){if("audiooutput"===e.kind)return{id:e.deviceId,name:e.label,group:e.groupId}}).filter(function(e){return void 0!==e}),e._lastAudioOutputDevices})}},{key:"getDefaultAudioSettings",value:function(){return this.__defaultParams}},{key:"setDefaultAudioSettings",value:function(e){this.logger.info("Set default audio settings: "+JSON.stringify(e)),this.__defaultParams=e}},{key:"setCallAudioSettings",value:function(e,t){var n=this;return this.logger.info("Setting call "+e.id+" audio settings: "+JSON.stringify(t)),new Promise(function(r,i){n._callParams[e.id()]===t&&r();var o=n._callParams[e.id()].outputId!==t.outputId,a=n._callParams[e.id()].inputId!==t.inputId||n._callParams[e.id()].noiseSuppression!==t.noiseSuppression||n._callParams[e.id()].echoCancellation!==t.echoCancellation||n._callParams[e.id()].disableAudio!==t.disableAudio;n.logger.info("Must update renderers: "+o+", must update source: "+a),n._callParams[e.id()]=t,o&&e.getEndpoints().forEach(function(e){e.mediaRenderers.forEach(function(e){return e.useAudioOutput(t.outputId)})}),a?c.StreamManager.get().updateCallStream(e).then(function(){r()}).catch(function(t){n.logger.warning("Failed to update call "+e.id()+" stream: "+t),i(t)}):r()})}},{key:"getCallAudioSettings",value:function(e){return this._callParams[e.id()]}},{key:"getCallConstraints",value:function(e){return this._callParams[e]?this._getAudioConstraints(this._callParams[e]):(this._callParams[e]=this.__defaultParams,this._getAudioConstraints(this.__defaultParams))}},{key:"_getAudioConstraints",value:function(e){if(e.disableAudio)return!1;var t="ideal";e.strict&&(t="exact");var n={};return e.inputId&&(this._lastAudioInputDevices&&this._lastAudioInputDevices.some(function(t){return t.id===e.inputId})?(n.deviceId={},n.deviceId[t]=e.inputId):this.logger.warning("There is no audio input device with id "+e.inputId)),e.echoCancellation&&this._supportedConstraints.echoCancellation&&(n.echoCancellation=e.echoCancellation),e.noiseSuppression&&this._supportedConstraints.noiseSuppression&&(n.noiseSuppression=e.echoCancellation),e.autoGainControl&&this._supportedConstraints.autoGainControl&&(n.autoGainControl=e.autoGainControl),e.advanced&&(n.advanced=e.advanced),n.echoCancellationType="system",!Object.keys(n)||n}},{key:"_traceName",value:function(){return"AudioDeviceManager"}}],[{key:"get",value:function(){return void 0===e.instance&&(e.instance=new e),e.instance}}]),e}();a([s.LogManager.d_trace(s.LogCategory.HARDWARE)],l.prototype,"getInputDevices",null),a([s.LogManager.d_trace(s.LogCategory.HARDWARE)],l.prototype,"getOutputDevices",null),a([s.LogManager.d_trace(s.LogCategory.HARDWARE)],l.prototype,"getDefaultAudioSettings",null),a([s.LogManager.d_trace(s.LogCategory.HARDWARE)],l.prototype,"setDefaultAudioSettings",null),a([s.LogManager.d_trace(s.LogCategory.HARDWARE)],l.prototype,"setCallAudioSettings",null),a([s.LogManager.d_trace(s.LogCategory.HARDWARE)],l.prototype,"getCallAudioSettings",null),a([s.LogManager.d_trace(s.LogCategory.HARDWARE)],l.prototype,"getCallConstraints",null),a([s.LogManager.d_trace(s.LogCategory.HARDWARE)],l.prototype,"_getAudioConstraints",null),t.AudioDeviceManager=l},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,t,n,r){var i,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":o(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(a<3?i(s):a>3?i(t,n,s):i(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),c=n(22),l=n(4),u=function(){function e(){if(r(this,e),void 0!==e.instance)throw new Error("Error - use StreamManager.get()");navigator&&navigator.mediaDevices&&navigator.mediaDevices.getSupportedConstraints?this._supportedConstraints=navigator.mediaDevices.getSupportedConstraints():this._supportedConstraints={},this._callParams={},this._lastCameraDevices=[],this.__defaultParams={},this.logger=s.LogManager.get().createLogger(s.LogCategory.USERMEDIA,this._traceName())}return i(e,[{key:"setDefaultVideoSettings",value:function(e){var t=this;return new Promise(function(n){var r=t._validateCameraParams(e);t.logger.info("Setting  default video settings, params: "+JSON.stringify(e)+", valid params: "+JSON.stringify(r)),t.__defaultParams=r,setTimeout(function(){l.Hardware.StreamManager.get().updateLocalVideo()},1e3),n(null)})}},{key:"getDefaultVideoSettings",value:function(){return this.__defaultParams}},{key:"setCallVideoSettings",value:function(e,t){var n=this,r=this._validateCameraParams(t);return this.logger.info("Setting call "+e.id()+" video settings, params: "+JSON.stringify(t)+", valid params: "+JSON.stringify(r)),this._callParams[e.id()]=r,new Promise(function(t,r){c.StreamManager.get().updateCallStream(e).then(function(){t()}).catch(function(t){n.logger.warning("Failed to set call "+e.id()+" video settings: "+t),r(t)})})}},{key:"getCallVideoSettings",value:function(e){return this._callParams[e.id()]}},{key:"getCallConstraints",value:function(e){return"__local__"===e?(this._callParams[e]=this.__defaultParams,this._getVideoConstraints(this.__defaultParams)):this._callParams[e]?this._getVideoConstraints(this._callParams[e]):(this._callParams[e]=this.__defaultParams,this._getVideoConstraints(this.__defaultParams))}},{key:"getInputDevices",value:function(){var e=this;return navigator.mediaDevices.enumerateDevices().then(function(t){return e.logger.info("Got input devices: "+JSON.stringify(t)),e._lastCameraDevices=t.map(function(e){if("video"===e.kind||"videoinput"===e.kind)return{id:e.deviceId,name:e.label,group:e.groupId}}).filter(function(e){return void 0!==e}),e._lastCameraDevices})}},{key:"_getVideoConstraints",value:function(e){var t={};return e.cameraId?this._lastCameraDevices&&this._lastCameraDevices.some(function(t){return t.id===e.cameraId})?(t.deviceId={},t.deviceId.ideal=e.cameraId):this.logger.warning("There is no video device with id "+e.cameraId):void 0!==e.facingMode&&(!1===e.facingMode?t.facingMode="environment":t.facingMode="user"),e.frameHeight&&(t.height={},e.strict?t.height.min=e.frameHeight:t.height.ideal=e.frameHeight),e.frameWidth&&(t.width={},e.strict?t.width.min=e.frameWidth:t.width.ideal=e.frameWidth),e.frameRate&&e.frameRate>0&&this._supportedConstraints.frameRate&&(t.frameRate=e.frameRate+""),!Object.keys(t)||t}},{key:"_validateCameraParams",value:function(e){if(e.videoQuality){(e.frameHeight||e.frameWidth)&&this.logger.warning('"videoQuality" parameter detected. The "frameHeight" and the "frameWidth" params will be ignored');var t=this._videoQualityToSize(e.videoQuality);e.frameWidth=t.w,e.frameHeight=t.h}return e}},{key:"_videoQualityToSize",value:function(e){switch(e){case l.Hardware.VideoQuality.VIDEO_QUALITY_HIGH:return{w:1280,h:720};case l.Hardware.VideoQuality.VIDEO_QUALITY_MEDIUM:return{w:640,h:480};case l.Hardware.VideoQuality.VIDEO_QUALITY_LOW:return{w:320,h:240};case l.Hardware.VideoQuality.VIDEO_SIZE_QQVGA:return{w:160,h:120};case l.Hardware.VideoQuality.VIDEO_SIZE_QCIF:return{w:176,h:144};case l.Hardware.VideoQuality.VIDEO_SIZE_QVGA:return{w:320,h:240};case l.Hardware.VideoQuality.VIDEO_SIZE_CIF:return{w:352,h:288};case l.Hardware.VideoQuality.VIDEO_SIZE_nHD:return{w:640,h:360};case l.Hardware.VideoQuality.VIDEO_SIZE_VGA:return{w:640,h:480};case l.Hardware.VideoQuality.VIDEO_SIZE_SVGA:return{w:800,h:600};case l.Hardware.VideoQuality.VIDEO_SIZE_HD:return{w:1280,h:720};case l.Hardware.VideoQuality.VIDEO_SIZE_UXGA:return{w:1600,h:1200};case l.Hardware.VideoQuality.VIDEO_SIZE_FHD:return{w:1920,h:1080};case l.Hardware.VideoQuality.VIDEO_SIZE_UHD:return{w:3840,h:2160};default:return{w:320,h:240}}}},{key:"testResolutions",value:function(e){var t=this,n=[l.Hardware.VideoQuality.VIDEO_SIZE_QQVGA,l.Hardware.VideoQuality.VIDEO_SIZE_QCIF,l.Hardware.VideoQuality.VIDEO_SIZE_QVGA,l.Hardware.VideoQuality.VIDEO_SIZE_CIF,l.Hardware.VideoQuality.VIDEO_SIZE_nHD,l.Hardware.VideoQuality.VIDEO_SIZE_VGA,l.Hardware.VideoQuality.VIDEO_SIZE_SVGA,l.Hardware.VideoQuality.VIDEO_SIZE_HD,l.Hardware.VideoQuality.VIDEO_SIZE_UXGA,l.Hardware.VideoQuality.VIDEO_SIZE_FHD,l.Hardware.VideoQuality.VIDEO_SIZE_UHD];return this._lastResolutionTestResult?new Promise(function(e,n){e(t._lastResolutionTestResult)}):this._testResolutions(n,{},e)}},{key:"_testResolutions",value:function(e,t,n){var r=this;if(e.length){var i=e.shift(),o={strict:!0},a=this._videoQualityToSize(i);o.frameWidth=a.w,o.frameHeight=a.h,n&&(o.cameraId=n);var s={video:this._getVideoConstraints(o)};return c.StreamManager.getUserMedia(s).then(function(o){return r.logger.info("_testResolutions(): Media access granted"),o.getTracks().forEach(function(e){return e.stop()}),t[l.Hardware.VideoQuality[i]]=!0,r._testResolutions(e,t,n)},function(o){return r.logger.error("_testResolutions(): Media access denied: "+(o?o.message||o.name||o:"unknown")),t[l.Hardware.VideoQuality[i]]=!1,r._testResolutions(e,t,n)})}return this._lastResolutionTestResult=t,t}},{key:"loadResolutionTestResult",value:function(e){return!![l.Hardware.VideoQuality.VIDEO_SIZE_QQVGA,l.Hardware.VideoQuality.VIDEO_SIZE_QCIF,l.Hardware.VideoQuality.VIDEO_SIZE_QVGA,l.Hardware.VideoQuality.VIDEO_SIZE_CIF,l.Hardware.VideoQuality.VIDEO_SIZE_nHD,l.Hardware.VideoQuality.VIDEO_SIZE_VGA,l.Hardware.VideoQuality.VIDEO_SIZE_SVGA,l.Hardware.VideoQuality.VIDEO_SIZE_HD,l.Hardware.VideoQuality.VIDEO_SIZE_UXGA,l.Hardware.VideoQuality.VIDEO_SIZE_FHD,l.Hardware.VideoQuality.VIDEO_SIZE_UHD].every(function(t){return void 0!==e[l.Hardware.VideoQuality[t]]})&&(this._lastResolutionTestResult=e,!0)}},{key:"_traceName",value:function(){return"CameraManager"}}],[{key:"get",value:function(){return void 0===e.instance&&(e.instance=new e),e.instance}},{key:"legacyParamConverter",value:function(e){var t={videoQuality:l.Hardware.VideoQuality.VIDEO_QUALITY_MEDIUM};return e.width&&("string"==typeof e.width||"number"==typeof e.width?(delete t.videoQuality,t.frameWidth=e.width):"string"==typeof e.width.exact||"number"==typeof e.width.exact?(delete t.videoQuality,t.frameWidth=e.width.exact,t.strict=!0):"string"==typeof e.width.min||"number"==typeof e.width.min?(delete t.videoQuality,t.frameWidth=e.width.min):"string"==typeof e.width.max||"number"==typeof e.width.max?(delete t.videoQuality,t.frameWidth=e.width.max):"string"!=typeof e.width.ideal&&"number"!=typeof e.width.ideal||(delete t.videoQuality,t.frameWidth=e.width.ideal)),e.height&&("string"==typeof e.height||"number"==typeof e.height?(delete t.videoQuality,t.frameHeight=e.height):"string"==typeof e.height.exact||"number"==typeof e.height.exact?(delete t.videoQuality,t.frameHeight=e.height.exact,t.strict=!0):"string"==typeof e.height.min||"number"==typeof e.height.min?(delete t.videoQuality,t.frameHeight=e.height.min):"string"==typeof e.height.max||"number"==typeof e.height.max?(delete t.videoQuality,t.frameHeight=e.height.max):"string"!=typeof e.height.ideal&&"number"!=typeof e.height.ideal||(delete t.videoQuality,t.frameHeight=e.height.ideal)),t}}]),e}();a([s.LogManager.d_trace(s.LogCategory.HARDWARE)],u.prototype,"setDefaultVideoSettings",null),a([s.LogManager.d_trace(s.LogCategory.HARDWARE)],u.prototype,"getDefaultVideoSettings",null),a([s.LogManager.d_trace(s.LogCategory.HARDWARE)],u.prototype,"setCallVideoSettings",null),a([s.LogManager.d_trace(s.LogCategory.HARDWARE)],u.prototype,"getCallVideoSettings",null),a([s.LogManager.d_trace(s.LogCategory.HARDWARE)],u.prototype,"getCallConstraints",null),a([s.LogManager.d_trace(s.LogCategory.HARDWARE)],u.prototype,"getInputDevices",null),a([s.LogManager.d_trace(s.LogCategory.HARDWARE)],u.prototype,"_getVideoConstraints",null),a([s.LogManager.d_trace(s.LogCategory.HARDWARE)],u.prototype,"_validateCameraParams",null),a([s.LogManager.d_trace(s.LogCategory.HARDWARE)],u,"legacyParamConverter",null),t.CameraManager=u},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,t,n,r){var i,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":o(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(a<3?i(s):a>3?i(t,n,s):i(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(t,"__esModule",{value:!0});var s=n(9),c=n(1),l=n(0),u=n(16),d=n(5),f=n(8),g=n(4),p=n(23),v=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=this,c=arguments[4];arguments[5];if(r(this,e),this.stream=t,this.kind=n,this.placeOnDom=i,this.isLocal=o,this._playElemLock=0,this.isRemoving=!1,void 0===this.kind&&(this.kind=t.getVideoTracks().length?"video":"audio"),this._id=u.Utils.generateUUID(),this.logger=l.LogManager.get().createLogger(l.LogCategory.USERMEDIA,this._traceName()),this.stream.getTracks().forEach(function(e){e.onended=function(){a.checkStreamActive(t)}}),this.stream.getTracks().length){if(this.element=document.getElementById(this.stream.getTracks()[0].id)||document.createElement("sharing"===this.kind?"video":this.kind),this.element.autoplay=!0,this.isLocal&&(this.element.muted=!0),this.element.setAttribute("playsinline",null),c?document.getElementById("voximplantlocalvideo")?this.element.id=this.stream.getTracks()[0].id:this.element.id="voximplantlocalvideo":this.element.id=this.stream.getTracks()[0].id,"audio"!==n)this.element.width=400,this.element.height=300,this.element.muted=!0;else{var d=g.default.AudioDeviceManager.get().getDefaultAudioSettings();d.outputId&&"function"==typeof this.element.setSinkId&&this.element.setSinkId("").then(function(){a.element.setSinkId(d.outputId+"")}).catch(function(){a.element.setSinkId(d.outputId+"")})}s.default.attachMedia(this),this.placeOnDom&&this.renderDefault()}}return i(e,[{key:"checkStreamActive",value:function(e){e.getTracks().some(function(e){return"live"===e.readyState})||this.clear()}},{key:"renderDefault",value:function(){var e=c.Client.getInstance(),t=this.isLocal?e.config().localVideoContainerId:e.config().remoteVideoContainerId,n=document.getElementById(t);this.render(n)}},{key:"render",value:function(e){if(this.logger.info("render()"),!(c.Client.getInstance().config()&&c.Client.getInstance().config().experiments&&c.Client.getInstance().config().experiments.preventRendering)){var t=e||document.body;void 0!==this.element.parentElement&&null!==this.element.parentElement?this.element.parentElement&&this.element.parentElement.removeChild(this.element):this.element.parentNode&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),t.appendChild(this.element),this.playElement()}}},{key:"replaceVideo",value:function(e){this.stream=e,s.default.attachMedia(this)}},{key:"clear",value:function(){if(this.isRemoving)return void this.logger.info("MediaRendered ID: already removing "+this._id+". Ignored.");this.isRemoving=!0,this.onBeforeDestroy&&this.onBeforeDestroy(),this.element&&(s.default.detachMedia(this),this.element.id="",void 0!==this.element.parentElement&&null!==this.element.parentElement?this.element.parentElement&&this.element.parentElement.removeChild(this.element):this.element.parentNode&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)),this.onDestroy&&this.onDestroy()}},{key:"setVolume",value:function(e){this.logger.info("setVolume("+e+")"),this.element&&(this.element.volume=e)}},{key:"useAudioOutput",value:function(e){this.logger.info("useAudioOutput("+e+")");try{"function"==typeof this.element.setSinkId&&this.element.setSinkId(e)}catch(e){this.logger.warning("Set audio output is impossible. Browser not support this option.")}}},{key:"_traceName",value:function(){return"MediaRenderer"}},{key:"playElement",value:function(){var e=this;this._playElemLock=1;var t=this.element.play();void 0!==t&&t.then(function(){e._playElemLock=0},function(t){setTimeout(function(){var t=e.element.play();void 0!==t&&t.then(function(){e._playElemLock=0},function(t){e._playElemLock=0,e.logger.warning("Can't start playing MediaRenderer ID:"+e._id),c.Client.getInstance().dispatchEvent({name:f.Events.PlaybackError,element:e.element,error:t})})},400)})}},{key:"pauseElement",value:function(){if(0===this._playElemLock||this._playElemLock>10)if(this.element instanceof HTMLVideoElement){var e=this.element.pause();void 0!==e&&e.catch(function(e){})}else this.element.pause();else this._playElemLock+=1,setTimeout(this.pauseElement,400)}},{key:"notifyAboutCreation",value:function(e,t){var n=this;t.wasAdded?(t.dispatchEvent({name:p.EndpointEvents.RemoteMediaAdded,call:e,endpoint:t,mediaRenderer:this}),e.dispatchEvent({name:d.CallEvents.MediaElementCreated,call:e,stream:this.stream,element:this.element,type:this.kind})):setTimeout(function(){return n.notifyAboutCreation(e,t)},400)}},{key:"id",get:function(){return this._id}}]),e}();a([l.LogManager.d_trace(l.LogCategory.USERMEDIA)],v.prototype,"checkStreamActive",null),a([l.LogManager.d_trace(l.LogCategory.USERMEDIA)],v.prototype,"renderDefault",null),a([l.LogManager.d_trace(l.LogCategory.USERMEDIA)],v.prototype,"render",null),a([l.LogManager.d_trace(l.LogCategory.USERMEDIA)],v.prototype,"clear",null),a([l.LogManager.d_trace(l.LogCategory.USERMEDIA)],v.prototype,"setVolume",null),a([l.LogManager.d_trace(l.LogCategory.USERMEDIA)],v.prototype,"useAudioOutput",null),t.MediaRenderer=v},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,t,n,r){var i,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":o(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(a<3?i(s):a>3?i(t,n,s):i(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),c=n(39),l=n(37),u=n(23),d=n(5),f=n(13),g=function(){function e(){r(this,e),this._endpointList={},this._trackListMap={},this._trackKindMap={},this._endpointInfo={},this._mediaRendererList={},this.logger=s.LogManager.get().createLogger(s.LogCategory.ENDPOINT,"EndpointManager")}return i(e,[{key:"setCallVolume",value:function(e,t){var n=this._endpointList[e.id()]||{};Object.values(n).forEach(function(e){(e.mediaRenderers||[]).forEach(function(e){return e.setVolume(t)})})}},{key:"_getEndpointByTrackId",value:function(e,t){var n=this._trackListMap[e.id()]||{},r=this._endpointList[e.id()]||{};return n[t]&&r[n[t]]?r[n[t]]:this.getDefaultEndPoint(e)}},{key:"_getMediaTypeTrack",value:function(e,t){return(this._trackKindMap[e.id()]||{})[t.id]||t.kind}},{key:"addEndPoint",value:function(e,t){var n=this._endpointInfo[e.id()];return n&&(this._endpointList[e.id()][t.id]=t,n[t.id]?(t.displayName=n[t.id].displayName,t.place=n[t.id].place,t.sipUri=n[t.id].sipURI,t.userName=n[t.id].username,t.notifyAboutCreation(e)):t.isDefault&&t.notifyAboutCreation(e)),t}},{key:"getDefaultEndPoint",value:function(e){var t=this._endpointList[e.id()]||{};if(t[e.id()])return t[e.id()];var n=new c.Endpoint(!0);return n.id=e.id(),this.addEndPoint(e,n),n}},{key:"deleteEndpoint",value:function(e,t){(this._endpointList[e.id()]||{})[t.id]?(t.mediaRenderers.forEach(function(e){e.clear()}),t.dispatchEvent({name:u.EndpointEvents.Removed,call:e,endpoint:t}),delete this._endpointList[e.id()][t.id]):this.logger.error("Trying remove non existing endpoint with id:"+t.id+" on the call: "+e.id())}},{key:"addStreamToEndpoint",value:function(e,t,n){var r=this,i="video";1===n.getTracks().length&&(i=this.getMediaTypeTrack(e,n.getTracks()[0]));var o=new l.MediaRenderer(n,i,!1,!1,void 0,e.settings.isConference);this._mediaRendererList[e.id()]||(this._mediaRendererList[e.id()]=[]),this._mediaRendererList[e.id()].push(o),t.mediaRenderers.push(o),o.notifyAboutCreation(e,t),n.getTracks().forEach(function(i){i.onmute=function(){var a=setTimeout(function(){o.clear(),i.onunmute=function(){r.addStreamToEndpoint(e,t,n)}},1e4);i.onunmute=function(){a&&clearTimeout(a)}}}),o.onBeforeDestroy=function(){t&&t.mediaRenderers&&(t.mediaRenderers=t.mediaRenderers.filter(function(e){return e.id!==o.id})),r._mediaRendererList&&r._mediaRendererList[e.id()]&&(r._mediaRendererList[e.id()]=r._mediaRendererList[e.id()].filter(function(e){return e.id!==o.id})),t.dispatchEvent({name:u.EndpointEvents.RemoteMediaRemoved,call:e,endpoint:t,mediaRenderer:o}),e.dispatchEvent({name:d.CallEvents.MediaElementRemoved,call:e,stream:o.stream,element:o.element,type:o.kind})}}},{key:"_traceName",value:function(){return"AbstractEndpointManager"}},{key:"addStream",value:function(e,t){var n=t.getTracks(),r=void 0;for(var i in n)r=r||this.getEndpointByTrack(e,n[i]);r&&this.addStreamToEndpoint(e,r,t)}},{key:"addTrack",value:function(e,t){var n=this;e.settings.isConference&&t.muted?t.onunmute=function(){t.onunmute=void 0,n.addStream(e,new MediaStream([t]))}:this.addStream(e,new MediaStream([t]))}},{key:"clear",value:function(e){var t=this;return delete this._mediaRendererList[e.id()],delete this._endpointInfo[e.id()],delete this._trackListMap[e.id()],new Promise(function(n,r){var i=t._endpointList[e.id()]||{},o=!0,a=!1,s=void 0;try{for(var c,l=Object.values(i)[Symbol.iterator]();!(o=(c=l.next()).done);o=!0){var d=c.value;d.mediaRenderers.forEach(function(e){e.clear()}),d.dispatchEvent({name:u.EndpointEvents.Removed,call:e,endpoint:d})}}catch(e){a=!0,s=e}finally{try{!o&&l.return&&l.return()}finally{if(a)throw s}}delete t._endpointList[e.id()],n()})}},{key:"endpointInfoUpdated",value:function(e,t,n){var r=this,i=this._endpointInfo[e.id()]||{},o=this._endpointList[e.id()]||{};i[n.id]=n;var a=o[n.id];if(!a||t!=f.Constants.VI_CONF_PARTICIPANT_INFO_ADDED&&t!==f.Constants.VI_CONF_PARTICIPANT_INFO_UPDATED)t!=f.Constants.VI_CONF_PARTICIPANT_INFO_ADDED&&t!==f.Constants.VI_CONF_PARTICIPANT_INFO_UPDATED||setTimeout(function(){r.endpointInfoUpdated(e,t,n)},400);else{var s=!a.sipUri;a.displayName=n.displayName,a.place=n.place,a.sipUri=n.sipURI,a.userName=n.username,s?a.notifyAboutCreation(e):a.dispatchEvent({name:u.EndpointEvents.InfoUpdated,call:e,endpoint:a})}this._endpointInfo[e.id()]=i}},{key:"setEndpointDescription",value:function(e,t){var n=this;if(t&&t.endpoints){var r=this._endpointList[e.id()],i=[];for(var o in r)r.hasOwnProperty(o)&&(t.endpoints[o]||o===e.id()||i.push(r[o]));i.forEach(function(t){return n.deleteEndpoint(e,t)});var a={},s={};for(var l in t.endpoints)if(t.endpoints.hasOwnProperty(l)){if(""===l)this.getDefaultEndPoint(e);else if(!r[l]){var u=new c.Endpoint(!1);u.id=l,u.place=t.endpoints[l].place,this.addEndPoint(e,u)}if(t.endpoints[l].tracks)for(var d in t.endpoints[l].tracks)t.endpoints[l].tracks.hasOwnProperty(d)&&(a[d]=l,s[d]=t.endpoints[l].tracks[d])}this._trackListMap[e.id()]=a,this._trackKindMap[e.id()]=s}}},{key:"useAudioOutput",value:function(e,t){var n=this._endpointList[e.id()];n&&Object.values(n).forEach(function(e){return e.useAudioOutput(t)})}},{key:"getEndpoints",value:function(e){return Object.values(this._endpointList[e.id()]||{})}},{key:"registerCall",value:function(e){this._endpointList[e.id()]={},this._trackListMap[e.id()]={},this._trackKindMap[e.id()]={},this._endpointInfo[e.id()]={},this._mediaRendererList[e.id()]=[]}}]),e}();a([s.LogManager.d_trace(s.LogCategory.ENDPOINT)],g.prototype,"setCallVolume",null),a([s.LogManager.d_trace(s.LogCategory.ENDPOINT)],g.prototype,"_getEndpointByTrackId",null),a([s.LogManager.d_trace(s.LogCategory.ENDPOINT)],g.prototype,"_getMediaTypeTrack",null),a([s.LogManager.d_trace(s.LogCategory.ENDPOINT)],g.prototype,"addEndPoint",null),a([s.LogManager.d_trace(s.LogCategory.ENDPOINT)],g.prototype,"getDefaultEndPoint",null),a([s.LogManager.d_trace(s.LogCategory.ENDPOINT)],g.prototype,"deleteEndpoint",null),a([s.LogManager.d_trace(s.LogCategory.ENDPOINT)],g.prototype,"addStreamToEndpoint",null),a([s.LogManager.d_trace(s.LogCategory.ENDPOINT)],g.prototype,"addStream",null),a([s.LogManager.d_trace(s.LogCategory.ENDPOINT)],g.prototype,"addTrack",null),a([s.LogManager.d_trace(s.LogCategory.ENDPOINT)],g.prototype,"clear",null),a([s.LogManager.d_trace(s.LogCategory.ENDPOINT)],g.prototype,"endpointInfoUpdated",null),a([s.LogManager.d_trace(s.LogCategory.ENDPOINT)],g.prototype,"setEndpointDescription",null),a([s.LogManager.d_trace(s.LogCategory.ENDPOINT)],g.prototype,"useAudioOutput",null),a([s.LogManager.d_trace(s.LogCategory.ENDPOINT)],g.prototype,"getEndpoints",null),a([s.LogManager.d_trace(s.LogCategory.ENDPOINT)],g.prototype,"registerCall",null),t.AbstractEndpointManager=g},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(r)};Object.defineProperty(t,"__esModule",{value:!0});var c=n(18),l=n(23),u=n(0),d=n(5),f=function(e){function t(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];r(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.isDefault=e,n.sipUri="",n.displayName="",n.userName="",n.wasAdded=!1,n.mediaRenderers=[],n.addDefaultEventListener(l.EndpointEvents.RemoteMediaAdded,function(e){e.mediaRenderer.renderDefault()}),n.logger=u.LogManager.get().createLogger(u.LogCategory.ENDPOINT,n._traceName()+" "+n.id),n}return o(t,e),a(t,[{key:"useAudioOutput",value:function(e){this.logger.info("useAudioOutput("+e+")"),this.mediaRenderers&&this.mediaRenderers.forEach(function(t){return t.useAudioOutput(e)})}},{key:"updateInfo",value:function(e){this.place=e.place,this.sipUri=e.sipURI,this.displayName=e.displayName,this.userName=e.username}},{key:"on",value:function(e,n,r){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"on",this).call(this,e,n)}},{key:"off",value:function(e,n){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"off",this).call(this,e,n)}},{key:"notifyAboutCreation",value:function(e){this.wasAdded||(e.dispatchEvent({name:d.CallEvents.EndpointAdded,call:e,endpoint:this}),this.wasAdded=!0)}},{key:"_traceName",value:function(){return"Endpoint"}}]),t}(c.EventTarget);t.Endpoint=f},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(r)},c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":c(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var u=n(12),d=n(2),f=n(0),g=n(3),p=n(13),v=n(1),h=n(4),m=n(5),y=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),a(t,[{key:"answer",value:function(e,n,r){var i=this;s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"answer",this).call(this,e,n),void 0!==e&&(void 0!==n&&"object"===(void 0===n?"undefined":c(n))||(n={}),n[p.Constants.CALL_DATA_HEADER]=e),this._answerHeaders=n;v.Client.getInstance().config();return new Promise(function(e,t){i._answerPromise=e,"object"===(void 0===r?"undefined":c(r))&&(i.settings.videoDirections=r);var n=function(){h.default.StreamManager.get().getCallStream(i).then(function(e){i._peerConnection.fastAddCustomMedia(e),i._peerConnection.getLocalAnswer().then(function(e){var t={tracks:i.peerConnection.getTrackKind(e.sdp)};d.VoxSignaling.get().callRemoteFunction(g.RemoteFunction.acceptCall,i.id(),i._answerHeaders,e.sdp,t),i._peerConnection._fixFFSoundBug(),i._answerPromise()}).catch(function(){})}).catch(function(e){return t(e)})};i._peerConnection?n():setTimeout(n,600)})}},{key:"setActive",value:function(e){var t=this;return e===this.settings.active?new Promise(function(e,n){n({name:m.CallEvents.Updated,result:!1,call:t})}):(this._setActive(e),this.peerConnection.hold(!e))}},{key:"_traceName",value:function(){return"CallExMedia"}}]),t}(u.Call);l([f.LogManager.d_trace(f.LogCategory.CALL)],y.prototype,"answer",null),l([f.LogManager.d_trace(f.LogCategory.CALL)],y.prototype,"setActive",null),t.CallExMedia=y},function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":s(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var l=n(0),u=n(12),d=n(1),f=n(5),g=n(4),p=n(62),v=n(63),h=function(){function e(){o(this,e),this._calls=new WeakMap,this.preferredVideoCodec="",this.preferredVideoCodec=d.Client.getInstance().config().H264first?"video/H264":d.Client.getInstance().config().VP8first?"video/VP8":""}return a(e,[{key:"addCall",value:function(e){e&&"object"===(void 0===e?"undefined":s(e))&&this._calls.set(e,{codecMismatch:{audioLevel:v.Statistic.QualityIssueLevel.None,videoLevel:v.Statistic.QualityIssueLevel.None,sharingLevel:v.Statistic.QualityIssueLevel.None,audioChecks:0,videoChecks:0,sharingChecks:0},highMediaLatency:{levels:[],latencies:[],lastJitterBuffers:{},prevLevel:v.Statistic.QualityIssueLevel.None},ICEDisconnected:{level:v.Statistic.QualityIssueLevel.None},localVideoDegradation:{videoLevel:v.Statistic.QualityIssueLevel.None,sharingLevel:v.Statistic.QualityIssueLevel.None},noAudioSignal:{level:v.Statistic.QualityIssueLevel.None},packetLoss:{level:v.Statistic.QualityIssueLevel.None,lastLost:0,lastTotal:0,checks:0}})}},{key:"deleteCall",value:function(e){e&&"object"===(void 0===e?"undefined":s(e))&&this._calls.has(e)&&this._calls.delete(e)}},{key:"analyzeCallStats",value:function(e,t){if(e&&"object"===(void 0===e?"undefined":s(e))&&this._calls.has(e)){var n=this._calls.get(e),r=g.default.StreamManager.get()._getTracksKind(e);e.state()===u.CallState.ALERTING||e.state()===u.CallState.PROGRESSING||e.state()===u.CallState.ENDED||(n.codecMismatch=this.checkCodecMismatch(e,t,r,n.codecMismatch),n.highMediaLatency=this.checkMediaLatency(e,t,r,n.highMediaLatency),n.localVideoDegradation=this.checkLocalVideoDegradation(e,t,r,n.localVideoDegradation),n.packetLoss=this.checkPacketLoss(e,t,n.packetLoss)),this._calls.set(e,n)}}},{key:"checkICEConnection",value:function(e,t){if(e&&"object"===(void 0===e?"undefined":s(e))&&this._calls.has(e)){var n=this._calls.get(e);"failed"===t&&n.ICEDisconnected.level!==v.Statistic.QualityIssueLevel.Critical?(e.dispatchEvent({call:e,name:f.CallEvents.QualityIssueICEDisconnected,level:v.Statistic.QualityIssueLevel.Critical}),n.ICEDisconnected.level=v.Statistic.QualityIssueLevel.Critical,this._calls.set(e,n)):"failed"!==t&&n.ICEDisconnected.level===v.Statistic.QualityIssueLevel.Critical&&(e.dispatchEvent({call:e,name:f.CallEvents.QualityIssueICEDisconnected,level:v.Statistic.QualityIssueLevel.None}),n.ICEDisconnected.level=v.Statistic.QualityIssueLevel.None,this._calls.set(e,n))}}},{key:"checkCodecMismatch",value:function(t,n,r,i){var o=n.filter(function(e){return"codec"===e.type});if(o.length){var a=Object.keys(r).find(function(e){return r[e]===p.TrackType.video}),s=Object.keys(r).find(function(e){return r[e]===p.TrackType.audio}),c=Object.keys(r).find(function(e){return r[e]===p.TrackType.sharing}),l=n.filter(function(e){return"track"===e.type}),u=n.filter(function(e){return"outbound-rtp"===e.type}),d=(l.find(function(e){return e.trackIdentifier===a})||{id:void 0}).id,g=(l.find(function(e){return e.trackIdentifier===s})||{id:void 0}).id,h=(l.find(function(e){return e.trackIdentifier===c})||{id:void 0}).id,m=u.find(function(e){return e.trackId===d}),y=u.find(function(e){return e.trackId===g}),C=u.find(function(e){return e.trackId===h}),_=m&&m.codecId?m.codecId:void 0,S=y&&y.codecId?y.codecId:void 0,E=C&&C.codecId?C.codecId:void 0,L=(o.find(function(e){return e.id===_})||{mimeType:void 0}).mimeType,b=(o.find(function(e){return e.id===S}),(o.find(function(e){return e.id===E})||{mimeType:void 0}).mimeType),M=t.settings.H264first?"video/H264":t.settings.VP8first?"video/VP8":this.preferredVideoCodec,R=void 0===L,T=void 0===L;m&&m.bytesSent&&(R?i.videoLevel===v.Statistic.QualityIssueLevel.Critical&&i.videoChecks>e.MAX_STATS_CHECKS?(t.dispatchEvent({call:t,name:f.CallEvents.QualityIssueCodecMismatch,level:v.Statistic.QualityIssueLevel.Critical,kind:p.TrackType.video,sendCodec:L}),i.videoLevel=v.Statistic.QualityIssueLevel.Critical,i.videoChecks=0):(i.videoLevel=v.Statistic.QualityIssueLevel.Critical,i.videoChecks=i.videoChecks+1):M&&M!==L&&(t.dispatchEvent({call:t,name:f.CallEvents.QualityIssueCodecMismatch,level:v.Statistic.QualityIssueLevel.Major,kind:p.TrackType.video,sendCodec:L}),i.videoLevel=v.Statistic.QualityIssueLevel.Major,i.videoChecks=0)),C&&C.bytesSent&&(T?i.sharingLevel===v.Statistic.QualityIssueLevel.Critical&&i.sharingChecks>e.MAX_STATS_CHECKS?(t.dispatchEvent({call:t,name:f.CallEvents.QualityIssueCodecMismatch,level:v.Statistic.QualityIssueLevel.Critical,kind:p.TrackType.sharing,sendCodec:b}),i.sharingLevel=v.Statistic.QualityIssueLevel.Critical,i.sharingChecks=0):(i.sharingLevel=v.Statistic.QualityIssueLevel.Critical,i.sharingChecks=i.videoChecks+1):M&&M!==b&&(t.dispatchEvent({call:t,name:f.CallEvents.QualityIssueCodecMismatch,level:v.Statistic.QualityIssueLevel.Major,kind:p.TrackType.sharing,sendCodec:b}),i.sharingLevel=v.Statistic.QualityIssueLevel.Major,i.sharingChecks=0))}return i}},{key:"checkMediaLatency",value:function(e,t,n,o){var a=t.find(function(e){return"candidate-pair"===e.type&&(e.selected||e.nominated&&"succeeded"===e.state)}),s=t.filter(function(e){return"inbound-rtp"===e.type}),c=t.filter(function(e){return"track"===e.type&&s.some(function(t){return t.trackId===e.id})}),l=c.reduce(function(e,t){var n=void 0!==t.jitterBufferDelay?t.jitterBufferDelay-(o.lastJitterBuffers[t.id]||{delay:0}).delay:void 0,r=void 0!==t.jitterBufferEmittedCount?t.jitterBufferEmittedCount-(o.lastJitterBuffers[t.id]||{emittedCount:0}).emittedCount:void 0,i=void 0!==n&&r?1e3*n/r:0;return i>e?i:e},0),u=1e3*(a&&a.currentRoundTripTime||0),d=Math.round(u/2+l);if(o.latencies.push(d),d>300?o.levels.push(v.Statistic.QualityIssueLevel.Critical):d>200?o.levels.push(v.Statistic.QualityIssueLevel.Major):d>100?o.levels.push(v.Statistic.QualityIssueLevel.Minor):o.levels.push(v.Statistic.QualityIssueLevel.None),5===o.levels.length){var g=[v.Statistic.QualityIssueLevel.Critical,v.Statistic.QualityIssueLevel.Major,v.Statistic.QualityIssueLevel.Minor,v.Statistic.QualityIssueLevel.None],p=o.levels.reduce(function(e,t){return e[g.indexOf(t)]++,e},[0,0,0,0]);if(p.includes(5)){var h=g[p.indexOf(5)];h===v.Statistic.QualityIssueLevel.None&&o.prevLevel===v.Statistic.QualityIssueLevel.None||e.dispatchEvent({call:e,name:f.CallEvents.QualityIssueHighMediaLatency,level:h,latency:d}),o.prevLevel=h}else{var m=p.reduce(function(e,t,n){return 2!==e.length&&t&&e.push(n),e},[]),y=Math.log1p(p[m[0]])-Math.log1p(p[m[1]]),C=g[y>.5?m[0]:m[1]],_=o.levels.map(function(e,t){return e===C?o.latencies[t]:0});C===v.Statistic.QualityIssueLevel.None&&o.prevLevel===v.Statistic.QualityIssueLevel.None||e.dispatchEvent({call:e,name:f.CallEvents.QualityIssueHighMediaLatency,level:C,latency:Math.max.apply(Math,i(_))}),o.prevLevel=C}o.levels=[],o.latencies=[]}return o.lastJitterBuffers=c.reduce(function(e,t){return Object.assign(e,r({},t.id,{delay:t.jitterBufferDelay,emittedCount:t.jitterBufferEmittedCount}))},{}),o}},{key:"checkLocalVideoDegradation",value:function(e,t,n,r){var i=n?Object.keys(n).find(function(e){return n[e]===p.TrackType.video}):void 0,o=n?Object.keys(n).find(function(e){return n[e]===p.TrackType.sharing}):void 0;if(i){var a=t.filter(function(e){return"track"===e.type}).find(function(e){return e.trackIdentifier===i});if(a&&a.frameHeight&&a.frameWidth){var s=g.default.CameraManager.get().getCallVideoSettings(e),c=Math.min(a.frameWidth,a.frameHeight)/Math.min(s.frameWidth||320,s.frameHeight||240),l=v.Statistic.QualityIssueLevel.None;l=c<.5?v.Statistic.QualityIssueLevel.Critical:c<=.7?v.Statistic.QualityIssueLevel.Major:c<=.85?v.Statistic.QualityIssueLevel.Minor:v.Statistic.QualityIssueLevel.None,r.videoLevel!==l&&(e.dispatchEvent({call:e,name:f.CallEvents.QualityIssueLocalVideoDegradation,level:l,kind:p.TrackType.video,targetWidth:s.frameWidth||320,targetHeight:s.frameHeight||240,actualWidth:a.frameWidth,actualHeight:a.frameHeight}),r.videoLevel=l)}}if(o){var u=t.filter(function(e){return"track"===e.type}).find(function(e){return e.trackIdentifier===o});if(u&&void 0!==u.framesPerSecond){var d=v.Statistic.QualityIssueLevel.None;d=u.framesPerSecond<4?v.Statistic.QualityIssueLevel.Critical:u.framesPerSecond<8?v.Statistic.QualityIssueLevel.Major:u.framesPerSecond<15?v.Statistic.QualityIssueLevel.Minor:v.Statistic.QualityIssueLevel.None,r.sharingLevel!==d&&(e.dispatchEvent({call:e,name:f.CallEvents.QualityIssueLocalVideoDegradation,level:d,kind:p.TrackType.sharing,fps:u.framesPerSecond}),r.sharingLevel=d)}}return r}},{key:"checkAudioSignal",value:function(e,t,n,r){var i=n?Object.keys(n).find(function(e){return n[e]===p.TrackType.audio}):void 0;if(i){var o=t.filter(function(e){return"track"===e.type}).find(function(e){return e.trackIdentifier===i});o&&void 0!==o.audioLevel&&o.audioLevel>0&&r.level===v.Statistic.QualityIssueLevel.Critical&&(e.dispatchEvent({call:e,name:f.CallEvents.QualityIssueNoAudioSignal,level:v.Statistic.QualityIssueLevel.None}),r.level=v.Statistic.QualityIssueLevel.None),o&&void 0!==o.audioLevel&&0===o.audioLevel&&(e.dispatchEvent({call:e,name:f.CallEvents.QualityIssueNoAudioSignal,level:v.Statistic.QualityIssueLevel.Critical}),r.level=v.Statistic.QualityIssueLevel.Critical)}return r}},{key:"checkPacketLoss",value:function(e,t,n){var r=t.filter(function(e){return"inbound-rtp"===e.type});if(n.checks=n.checks+1,5===n.checks){var i=r.length?r.reduce(function(e,t){return{lost:e.lost+(t.packetsLost||0),total:e.total+(t.packetsLost||0)+(t.packetsReceived||0)}},{lost:0,total:0}):{lost:0,total:0},o=i.total-n.lastTotal?(i.lost-n.lastLost)/(i.total-n.lastTotal):0,a=v.Statistic.QualityIssueLevel.None;a=o>=.15?v.Statistic.QualityIssueLevel.Critical:o>=.1?v.Statistic.QualityIssueLevel.Major:o>=.05?v.Statistic.QualityIssueLevel.Minor:v.Statistic.QualityIssueLevel.None,n.level!==a&&(e.dispatchEvent({call:e,name:f.CallEvents.QualityIssuePacketLoss,level:a,packetLoss:o}),n.level=a),n.lastLost=i.lost,n.lastTotal=i.total,n.checks=0}return n}},{key:"checkLowBandwidth",value:function(){}}],[{key:"get",value:function(){return void 0===this.inst&&(this.inst=new e),this.inst}}]),e}();h.MAX_STATS_CHECKS=4,c([l.LogManager.d_trace(l.LogCategory.RTC)],h.prototype,"addCall",null),c([l.LogManager.d_trace(l.LogCategory.RTC)],h.prototype,"deleteCall",null),t.CallStatsAnalyzer=h},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,t,n,r){var i,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":o(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(a<3?i(s):a>3?i(t,n,s):i(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(t,"__esModule",{value:!0});var s=n(5),c=n(0),l=function(){function e(t,n){var i=this;r(this,e),this._pcStatus=n,this._q=[],t.on(s.CallEvents.Updated,function(t){if(c.LogManager.get().writeMessage(c.LogCategory.REINVITEQ,"CallEvent",c.LogLevel.TRACE,"Updated with result "+t.result),e._currentReinvite){var n=e._currentReinvite;t.result?n.resolve(t):n.reject(t),e._currentReinvite=void 0}i.runNext()}),t.on(s.CallEvents.PendingUpdate,function(t){c.LogManager.get().writeMessage(c.LogCategory.REINVITEQ,"CallEvent",c.LogLevel.TRACE,"IncomingUpdate. Local RI=="+o(e._currentReinvite)),e._currentReinvite&&(e._currentReinvite.reject(),e._currentReinvite=void 0)}),t.on(s.CallEvents.UpdateFailed,function(t){c.LogManager.get().writeMessage(c.LogCategory.REINVITEQ,"CallEvent",c.LogLevel.TRACE,"UpdateFailed"),e._currentReinvite&&(e._currentReinvite.reject(),e._currentReinvite=void 0)})}return i(e,[{key:"runNext",value:function(){void 0===e._currentReinvite&&this._q.length>0&&this._pcStatus()&&(e._currentReinvite=this._q.splice(0,1)[0],e._currentReinvite.fx())}},{key:"add",value:function(e){this._q.push(e),this.runNext()}},{key:"clear",value:function(){this._q.forEach(function(e){e.reject()})}},{key:"_traceName",value:function(){return"ReInviteQ"}}]),e}();a([c.LogManager.d_trace(c.LogCategory.REINVITEQ)],l.prototype,"runNext",null),a([c.LogManager.d_trace(c.LogCategory.REINVITEQ)],l.prototype,"add",null),a([c.LogManager.d_trace(c.LogCategory.REINVITEQ)],l.prototype,"clear",null),t.ReInviteQ=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});n(26);!function(e){e[e.Chat="chat"]="Chat"}(t.MsgService||(t.MsgService={}));!function(e){e[e.none=0]="none",e[e.can_write=1]="can_write",e[e.can_edit=2]="can_edit",e[e.can_remove=4]="can_remove",e[e.can_manage_participants=8]="can_manage_participants",e[e.can_edit_all=16]="can_edit_all",e[e.can_remove_all=32]="can_remove_all",e[e.is_owner=32768]="is_owner",e[e.all=65535]="all"}(t.MsgPermissions||(t.MsgPermissions={}))},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(20),a=n(15),s=n(0),c=n(3),l=n(2),u=n(16),d=n(8),f=n(1),g="The operator status update failed by timeout.",p="You try to perform multiple ACD operations at the same time. This can lead to an unexpected behavior of your application.",v="You probably use the same credentials in the different browsers or multiple browser's windows. This can cause conflicts between instances.",h=function(){function e(){r(this,e)}return i(e,null,[{key:"setConnectionId",value:function(e){this._connectionId=e}},{key:"removeConnectionId",value:function(){this._connectionId=void 0}},{key:"setStatus",value:function(t){var n=this;return new Promise(function(r,i){e._checkBeforeRun(a.OperatorACDStatuses[t],i);var o=e.newUUID;l.VoxSignaling.get().callRemoteFunction(c.RemoteFunction.setOperatorACDStatus,t,o),n._acdRequests.push({resolve:r,reject:i,timer:window.setTimeout(function(){e._acdRequests=e._acdRequests.filter(function(e){return e.uuid!==o}),i(g)},58e3),uuid:o,status:t})})}},{key:"getStatus",value:function(){var t=this;return new Promise(function(n,r){e._checkBeforeRun(void 0,r);var i=e.newUUID;l.VoxSignaling.get().callRemoteFunction(c.RemoteFunction.getOperatorACDStatus,i),t._acdRequests.push({resolve:n,reject:r,timer:window.setTimeout(function(){e._acdRequests=e._acdRequests.filter(function(e){return e.uuid!==i}),r(g)},58e3),uuid:i})})}},{key:"onError",value:function(t,n,r){var i=e._getActorByUUID(t),o=i.actor,a=i.actorIdx;o&&(clearTimeout(o.timer),o.reject(new Error(u.Utils.strFormat("Wrong ACD status name {0}",o.status||"get operation"))),e._acdRequests.splice(0,a+1))}},{key:"onStatusUpdated",value:function(t,n){e._checkConnectionId(n);var r=e._getActorByUUID(n),i=r.actor,o=r.actorIdx;if(i){if(clearTimeout(i.timer),0!==o)for(var a=0;a<o;a++)clearTimeout(e._acdRequests[a].timer),e._acdRequests[a].reject(new Error(u.Utils.strFormat("The {0} status is set in your code after {1}. The {0} status is ignored.",i.status||"get operation",t)));void 0===i.status||i.status===t?i.resolve(t):i.reject(new Error(u.Utils.strFormat("The {0} status is not acceptable for the current operator state. The operator is {1} now. Please, check the ACD module documentation for details.",i.status,t))),e._acdRequests.splice(0,o+1)}f.Client.getInstance().dispatchEvent({name:d.Events.ACDStatusUpdated,id:e._getConnectonIdFromUUID(n),status:t})}},{key:"_checkBeforeRun",value:function(t,n){e._connectionId||n(new Error("You can't set an operator status before login.")),e._acdRequests.length>0&&(s.LogManager.get().writeMessage(s.LogCategory.CLIENT,"ACD",s.LogLevel.WARNING,p),f.Client.getInstance().dispatchEvent({name:d.Events.ACDError,code:5,message:p})),void 0===t||Object.values(a.OperatorACDStatuses).includes(t)||n(new Error(u.Utils.strFormat("Wrong ACD status name {0}",t)))}},{key:"_getActorByUUID",value:function(e){var t=-1;return{actor:this._acdRequests.find(function(n,r){if(n.uuid===e)return t=r,!0}),actorIdx:t}}},{key:"_getConnectonIdFromUUID",value:function(t){var n=t.split("_");return 1===n.length||"gw"===n[1]?e._connectionId:n[1]}},{key:"_checkConnectionId",value:function(t){var n=t.split("_");1!==n.length&&n[1]===e._connectionId||(f.Client.getInstance().dispatchEvent({name:d.Events.ACDError,code:6,message:v}),s.LogManager.get().writeMessage(s.LogCategory.CLIENT,"ACD",s.LogLevel.WARNING,v))}},{key:"newUUID",get:function(){return(new o.default).toString()+"_"+e._connectionId}}]),e}();h._acdRequests=[],t.default=h},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(20),a=n(15),s=n(0),c=n(3),l=n(2),u=n(16),d=n(8),f=n(1),g="The operator status update failed by timeout.",p="You try to perform multiple ACD operations at the same time. This can lead to an unexpected behavior of your application.",v="You probably use the same credentials in the different browsers or multiple browser's windows. This can cause conflicts between instances.",h=function(){function e(){r(this,e)}return i(e,null,[{key:"setConnectionId",value:function(e){this._connectionId=e}},{key:"removeConnectionId",value:function(){this._connectionId=void 0}},{key:"setStatus",value:function(t){var n=this;return new Promise(function(r,i){e._checkBeforeRun(a.OperatorACDStatuses[t],i);var o=e.newUUID;l.VoxSignaling.get().callRemoteFunction(c.RemoteFunction.setOperatorMessagingStatus,t,o),n._acdRequests.push({resolve:r,reject:i,timer:window.setTimeout(function(){e._acdRequests=e._acdRequests.filter(function(e){return e.uuid!==o}),i(g)},58e3),uuid:o,status:t})})}},{key:"getStatus",value:function(){var t=this;return new Promise(function(n,r){e._checkBeforeRun(void 0,r);var i=e.newUUID;l.VoxSignaling.get().callRemoteFunction(c.RemoteFunction.getOperatorMessagingStatus,i),t._acdRequests.push({resolve:n,reject:r,timer:window.setTimeout(function(){e._acdRequests=e._acdRequests.filter(function(e){return e.uuid!==i}),r(g)},58e3),uuid:i})})}},{key:"onError",value:function(t,n,r){var i=e._getActorByUUID(t),o=i.actor,a=i.actorIdx;o&&(clearTimeout(o.timer),o.reject(new Error(u.Utils.strFormat("Wrong ACD status name {0}",o.status||"get operation"))),e._acdRequests.splice(0,a+1))}},{key:"onStatusUpdated",value:function(t,n){e._checkConnectionId(n);var r=e._getActorByUUID(n),i=r.actor,o=r.actorIdx;if(i){if(clearTimeout(i.timer),0!==o)for(var a=0;a<o;a++)clearTimeout(e._acdRequests[a].timer),e._acdRequests[a].reject(new Error(u.Utils.strFormat("The {0} status is set in your code after {1}. The {0} status is ignored.",i.status||"get operation",t)));void 0===i.status||i.status===t?i.resolve(t):i.reject(new Error(u.Utils.strFormat("The {0} status is not acceptable for the current operator state. The operator is {1} now. Please, check the ACD module documentation for details.",i.status,t))),e._acdRequests.splice(0,o+1)}f.Client.getInstance().dispatchEvent({name:d.Events.SQMessagingStatusUpdated,id:e._getConnectonIdFromUUID(n),status:t})}},{key:"_checkBeforeRun",value:function(t,n){e._connectionId||n(new Error("You can't set an operator status before login.")),e._acdRequests.length>0&&(s.LogManager.get().writeMessage(s.LogCategory.CLIENT,"ACD",s.LogLevel.WARNING,p),f.Client.getInstance().dispatchEvent({name:d.Events.SQError,code:5,message:p})),void 0===t||Object.values(a.OperatorACDStatuses).includes(t)||n(new Error(u.Utils.strFormat("Wrong ACD status name {0}",t)))}},{key:"_getActorByUUID",value:function(e){var t=-1;return{actor:this._acdRequests.find(function(n,r){if(n.uuid===e)return t=r,!0}),actorIdx:t}}},{key:"_getConnectonIdFromUUID",value:function(t){var n=t.split("_");return 1===n.length||"gw"===n[1]?e._connectionId:n[1]}},{key:"_checkConnectionId",value:function(t){var n=t.split("_");1!==n.length&&n[1]===e._connectionId||(f.Client.getInstance().dispatchEvent({name:d.Events.SQError,code:6,message:v}),s.LogManager.get().writeMessage(s.LogCategory.CLIENT,"ACD",s.LogLevel.WARNING,v))}},{key:"newUUID",get:function(){return(new o.default).toString()+"_"+e._connectionId}}]),e}();h._acdRequests=[],t.default=h},function(e,t,n){"use strict";var r={};r.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},r.localCName=r.generateIdentifier(),r.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},r.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},r.getDescription=function(e){var t=r.splitSections(e);return t&&t[0]},r.getMediaSections=function(e){var t=r.splitSections(e);return t.shift(),t},r.matchPrefix=function(e,t){return r.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},r.parseCandidate=function(e){var t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");for(var n={foundation:t[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:n[t[r]]=t[r+1]}return n},r.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},r.parseIceOptions=function(e){return e.substr(14).split(" ")},r.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},r.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},r.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},r.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},r.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)t=r[i].trim().split("="),n[t[0].trim()]=t[1];return n},r.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach(function(t){e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)}),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},r.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},r.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},r.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},r.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(function(e){return parseInt(e,10)})}},r.getMid=function(e){var t=r.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},r.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},r.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:r.matchPrefix(e+t,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},r.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},r.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?r.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},r.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},r.getCryptoParameters=function(e,t){return r.matchPrefix(e+t,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(e,t){var n=r.matchPrefix(e+t,"a=ice-ufrag:")[0],i=r.matchPrefix(e+t,"a=ice-pwd:")[0];return n&&i?{usernameFragment:n.substr(12),password:i.substr(10)}:null},r.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},r.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=r.splitLines(e),i=n[0].split(" "),o=3;o<i.length;o++){var a=i[o],s=r.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(s){var c=r.parseRtpMap(s),l=r.matchPrefix(e,"a=fmtp:"+a+" ");switch(c.parameters=l.length?r.parseFmtp(l[0]):{},c.rtcpFeedback=r.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(r.parseRtcpFb),t.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(c.name.toUpperCase())}}}return r.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(r.parseExtmap(e))}),t},r.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){n+=r.writeRtpMap(e),n+=r.writeFmtp(e),n+=r.writeRtcpFb(e)});var i=0;return t.codecs.forEach(function(e){e.maxptime>i&&(i=e.maxptime)}),i>0&&(n+="a=maxptime:"+i+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach(function(e){n+=r.writeExtmap(e)}),n},r.parseRtpEncodingParameters=function(e){var t,n=[],i=r.parseRtpParameters(e),o=-1!==i.fecMechanisms.indexOf("RED"),a=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=s.length>0&&s[0].ssrc,l=r.matchPrefix(e,"a=ssrc-group:FID").map(function(e){return e.substr(17).split(" ").map(function(e){return parseInt(e,10)})});l.length>0&&l[0].length>1&&l[0][0]===c&&(t=l[0][1]),i.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var r={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(r.rtx={ssrc:t}),n.push(r),o&&(r=JSON.parse(JSON.stringify(r)),r.fec={ssrc:c,mechanism:a?"red+ulpfec":"red"},n.push(r))}}),0===n.length&&c&&n.push({ssrc:c});var u=r.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substr(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substr(5),10)*.95-16e3:void 0,n.forEach(function(e){e.maxBitrate=u})),n},r.parseRtcpParameters=function(e){var t={},n=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var i=r.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var o=r.matchPrefix(e,"a=rtcp-mux");return t.mux=o.length>0,t},r.parseMsid=function(e){var t,n=r.matchPrefix(e,"a=msid:");if(1===n.length)return t=n[0].substr(7).split(" "),{stream:t[0],track:t[1]};var i=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return i.length>0?(t=i[0].value.split(" "),{stream:t[0],track:t[1]}):void 0},r.parseSctpDescription=function(e){var t,n=r.parseMLine(e),i=r.matchPrefix(e,"a=max-message-size:");i.length>0&&(t=parseInt(i[0].substr(19),10)),isNaN(t)&&(t=65536);var o=r.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:n.fmt,maxMessageSize:t};if(r.matchPrefix(e,"a=sctpmap:").length>0){var a=r.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(a[0],10),protocol:a[1],maxMessageSize:t}}},r.writeSctpDescription=function(e,t){var n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,21)},r.writeSessionBoilerplate=function(e,t,n){var i,o=void 0!==t?t:2;return i=e||r.generateSessionId(),"v=0\r\no="+(n||"thisisadapterortc")+" "+i+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},r.writeMediaSection=function(e,t,n,i){var o=r.writeRtpDescription(e.kind,t);if(o+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",e.direction?o+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),o},r.getDirection=function(e,t){for(var n=r.splitLines(e),i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2)}return t?r.getDirection(t):"sendrecv"},r.getKind=function(e){return r.splitLines(e)[0].split(" ")[0].substr(2)},r.isRejected=function(e){return"0"===e.split(" ",2)[1]},r.parseMLine=function(e){var t=r.splitLines(e),n=t[0].substr(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},r.parseOLine=function(e){var t=r.matchPrefix(e,"o=")[0],n=t.substr(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},r.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=r.splitLines(e),n=0;n<t.length;n++)if(t[n].length<2||"="!==t[n].charAt(1))return!1;return!0},e.exports=r},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,t,n,r){var i,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":o(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(a<3?i(s):a>3?i(t,n,s):i(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(t,"__esModule",{value:!0});var s=n(19),c=n(27),l=n(33),u=n(28),d=n(0),f=n(21),g=n(26),p=n(48),v=n(29),h=function(){function e(){var t=this;if(r(this,e),e.instance)throw new Error(p.MESSAGING_ERR_2);this.signalling=s.MsgSignaling.get(),this.signalling.addEventListener(g.MsgEvent.onCreateConversation,function(e,n){t.resolveEvent(e,f.default.MessengerEvents.CreateConversation,n)}),this.signalling.addEventListener(g.MsgEvent.onEditConversation,function(e,n){t.resolveEvent(e,f.default.MessengerEvents.EditConversation,n)}),this.signalling.addEventListener(g.MsgEvent.onRemoveConversation,function(e,t){c.Messenger.getInstance()._dispatchEvent(f.default.MessengerEvents.RemoveConversation,{uuid:e.object.uuid,seq:e.seq,messengerAction:f.default.MessengerAction[e.on_incoming_event],initiator:Number(e.initiator),timestamp:"number"==typeof e.timestamp?1e3*e.timestamp:void 0,requestUuid:t},t)}),this.signalling.addEventListener(g.MsgEvent.onGetConversation,function(e,n){t.resolveEvent(e,f.default.MessengerEvents.GetConversation,n)}),this.signalling.addEventListener(g.MsgEvent.onGetPublicConversations,function(e,t){c.Messenger.getInstance()._dispatchEvent(f.default.MessengerEvents.GetPublicConversations,{conversations:e.object.uuid,initiator:Number(e.initiator),messengerAction:f.default.MessengerAction[e.on_incoming_event],requestUuid:t},t)}),this.signalling.addEventListener(g.MsgEvent.onSendMessage,function(e,n){t.resolveMessageEvent(e,f.default.MessengerEvents.SendMessage,n)}),this.signalling.addEventListener(g.MsgEvent.onEditMessage,function(e,n){t.resolveMessageEvent(e,f.default.MessengerEvents.EditMessage,n)}),this.signalling.addEventListener(g.MsgEvent.onRemoveMessage,function(e,n){t.resolveMessageEvent(e,f.default.MessengerEvents.RemoveMessage,n)}),this.signalling.addEventListener(g.MsgEvent.isRead,function(e,t){c.Messenger.getInstance()._dispatchEvent(f.default.MessengerEvents.Read,{conversation:e.object.conversation,seq:e.object.seq,initiator:Number(e.initiator),messengerAction:f.default.MessengerAction[e.on_incoming_event],requestUuid:t},t)}),this.signalling.addEventListener(g.MsgEvent.onTyping,function(e,t){c.Messenger.getInstance()._dispatchEvent(f.default.MessengerEvents.Typing,{conversation:e.object.conversation,initiator:Number(e.initiator),messengerAction:f.default.MessengerAction[e.on_incoming_event],requestUuid:t},t)}),this.signalling.addEventListener(g.MsgEvent.onRetransmitEvents,function(e,t){c.Messenger.getInstance()._dispatchEvent(f.default.MessengerEvents.RetransmitEvents,{events:[e.object&&e.object.event?-1==e.object.event.indexOf("Message")&&e.object.payload?{conversation:l.Conversation._createFromBus(e.object.payload.object,e.object.payload.seq),initiator:Number(e.object.payload.initiator),seq:e.object.payload.seq,messengerAction:f.default.MessengerAction[e.object.payload.on_incoming_event],timestamp:"number"==typeof e.object.payload.timestamp?1e3*e.object.payload.timestamp:void 0}:{message:u.Message._createFromBus(e.object.payload.object,Number(e.object.payload.initiator)),initiator:Number(e.object.payload.initiator),seq:e.object.payload.seq,timestamp:"number"==typeof e.object.payload.timestamp?1e3*e.object.payload.timestamp:void 0,messengerAction:f.default.MessengerAction[e.object.payload.on_incoming_event]}:void 0],initiator:Number(e.initiator),messengerAction:f.default.MessengerAction[e.on_incoming_event],requestUuid:t},t)})}return i(e,[{key:"resolveEvent",value:function(e,t,n){var r=l.Conversation._createFromBus(e.object,e.seq);void 0!==r&&r.updateSeq(e.seq),c.Messenger.getInstance()._dispatchEvent(t,{conversation:r,initiator:Number(e.initiator),seq:e.seq,messengerAction:f.default.MessengerAction[e.on_incoming_event],timestamp:"number"==typeof e.timestamp?1e3*e.timestamp:void 0,requestUuid:n},n)}},{key:"resolveMessageEvent",value:function(e,t,n){var r=u.Message._createFromBus(e.object,Number(e.initiator));c.Messenger.getInstance()._dispatchEvent(t,{message:r,initiator:Number(e.initiator),seq:e.seq,messengerAction:f.default.MessengerAction[e.on_incoming_event],timestamp:"number"==typeof e.timestamp?1e3*e.timestamp:void 0},n)}},{key:"createConversation",value:function(e,t,n,r,i,o){var a=this;return new Promise(function(s,u){var d=a.signalling.sendWsMessage(v.MsgAction.createConversation,new l.Conversation({participants:e,title:t,direct:n,publicJoin:r,customData:o,uberConversation:i})._getCreatePayload());c.Messenger.getInstance()._registerPromise(d,s,u)})}},{key:"editConversation",value:function(e){var t=this;return new Promise(function(n,r){var i=void 0,o=function e(t){t.requestUuid===i&&(clearTimeout(s),c.Messenger.getInstance().off(f.default.MessengerEvents.EditConversation,e),c.Messenger.getInstance().off(f.default.MessengerEvents.Error,a),n(t))},a=function t(n){n.requestUuid===i&&(clearTimeout(s),c.Messenger.getInstance().off(f.default.MessengerEvents.EditConversation,o),c.Messenger.getInstance().off(f.default.MessengerEvents.Error,t),e._revertChanges(),r(n))},s=setTimeout(function(){c.Messenger.getInstance().off(f.default.MessengerEvents.EditConversation,o),c.Messenger.getInstance().off(f.default.MessengerEvents.Error,a),c.Messenger.getInstance().reject(f.default.MessengerError.Error_0,f.default.MessengerAction.editConversation).catch(r)},c.Messenger.rejectTimeout);c.Messenger.getInstance().on(f.default.MessengerEvents.EditConversation,o),c.Messenger.getInstance().on(f.default.MessengerEvents.Error,a),i=t.signalling.sendWsMessage(v.MsgAction.editConversation,e._getEditPayload())})}},{key:"getConversation",value:function(e){var t=this;return new Promise(function(n,r){var i=t.signalling.sendWsMessage(v.MsgAction.getConversation,{uuid:e});c.Messenger.getInstance()._registerPromise(i,n,r)})}},{key:"getConversations",value:function(e){if(!Array.isArray(e))return c.Messenger.getInstance().reject(f.default.MessengerError.Error_0,f.default.MessengerAction.getConversations);var t=void 0,n=Promise.all(e.map(function(e){return new Promise(function(n,r){var i=function r(i){i.requestUuid===t&&i.conversation.uuid===e&&(clearTimeout(a),c.Messenger.getInstance().off(f.default.MessengerEvents.GetConversation,r),c.Messenger.getInstance().off(f.default.MessengerEvents.Error,o),n(i))},o=function e(n){n.requestUuid===t&&(clearTimeout(a),c.Messenger.getInstance().off(f.default.MessengerEvents.GetConversation,i),c.Messenger.getInstance().off(f.default.MessengerEvents.Error,e),r(n))},a=setTimeout(function(){c.Messenger.getInstance().off(f.default.MessengerEvents.GetConversation,i),c.Messenger.getInstance().off(f.default.MessengerEvents.Error,o),c.Messenger.getInstance().reject(f.default.MessengerError.Error_0,f.default.MessengerAction.getConversation).catch(r)},c.Messenger.rejectTimeout);c.Messenger.getInstance().on(f.default.MessengerEvents.GetConversation,i),c.Messenger.getInstance().on(f.default.MessengerEvents.Error,o)})}));return t=this.signalling.sendWsMessage(v.MsgAction.getConversations,{uuid:e}),n}},{key:"getPublicConversations",value:function(){var e=this;return new Promise(function(t,n){var r=e.signalling.sendWsMessage(v.MsgAction.getPublicConversations,{});c.Messenger.getInstance()._registerPromise(r,t,n)})}},{key:"_traceName",value:function(){return"ConversationManager"}}],[{key:"get",value:function(){return e.instance=e.instance||new e,e.instance}},{key:"deserialize",value:function(e){return l.Conversation.createFromCache(e)}},{key:"serialize",value:function(e){return e.toCache()}},{key:"extractUserName",value:function(e){if(-1===e.indexOf("@"))return e;var t=e.split("@");return t[1]=t[1].split(".").splice(0,2).join("."),t.join("@")}}]),e}();a([d.LogManager.d_trace(d.LogCategory.MESSAGING)],h.prototype,"resolveEvent",null),a([d.LogManager.d_trace(d.LogCategory.MESSAGING)],h.prototype,"resolveMessageEvent",null),a([d.LogManager.d_trace(d.LogCategory.MESSAGING)],h.prototype,"createConversation",null),a([d.LogManager.d_trace(d.LogCategory.MESSAGING)],h.prototype,"editConversation",null),a([d.LogManager.d_trace(d.LogCategory.MESSAGING)],h.prototype,"getConversation",null),a([d.LogManager.d_trace(d.LogCategory.MESSAGING)],h.prototype,"getConversations",null),a([d.LogManager.d_trace(d.LogCategory.MESSAGING)],h.prototype,"getPublicConversations",null),a([d.LogManager.d_trace(d.LogCategory.MESSAGING)],h,"get",null),a([d.LogManager.d_trace(d.LogCategory.MESSAGING)],h,"deserialize",null),a([d.LogManager.d_trace(d.LogCategory.MESSAGING)],h,"serialize",null),a([d.LogManager.d_trace(d.LogCategory.MESSAGING)],h,"extractUserName",null),t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MESSAGING_ERR_1="Error - use Client.getIM()",t.MESSAGING_ERR_2="Error - use ConversationManager.get()"},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(17),a=n(0),s=function(){function e(){r(this,e)}return i(e,[{key:"_traceName",value:function(){return"FF"}}],[{key:"attachStream",value:function(e){var t=e.element;void 0===t.srcObject?t.mozSrcObject=e.stream:t.srcObject=e.stream,t.load(),e.playElement()}},{key:"detachStream",value:function(e){var t=e.element;void 0===t.srcObject?t.mozSrcObject=null:t.srcObject=null,t.load(),t.src=""}},{key:"screenSharingSupported",value:function(){return new Promise(function(e,t){if("https:"!=window.location.protocol)return void e(!1);e(!0)})}},{key:"getScreenMedia",value:function(){var e={audio:!1,video:{mediaSource:"window"}};return a.LogManager.get().writeMessage(a.LogCategory.USERMEDIA,"[constraints]",a.LogLevel.TRACE,JSON.stringify(e)),navigator.mediaDevices.getUserMedia(e)}},{key:"getRTCStats",value:function(t){return new Promise(function(n,r){t.getStats(null).then(function(t){var r=[];t.forEach(function(e){"inbound-rtp"!=e.type&&"outbound-rtp"!=e.type||r.push(e)}),n({raw:r,formatted:e.prepareRTCStats(t)})}).catch(r)})}},{key:"prepareRTCStats",value:function(e){var t=[];return e.forEach(function(e){"outbound-rtp"===e.type||e.isRemote?t.push(Object.assign(e,{framesPerSecond:e.framesPerSecond?e.framesPerSecond:e.framerateMean,encoderBitrate:e.bitrateMean})):t.push(e)}),t}},{key:"getDTMFSender",value:function(e,t){var n=/Firefox\/([0-9\.]+)(?:\s|$)/,r=navigator.userAgent;if(n.test(r)){if(+n.exec(r)[1].split(".")[0]>=53){var i=e.getSenders().map(function(e){if(e.track&&"audio"===e.track.kind&&e.dtmf)return e.dtmf});if(i.length>0)return i[0]}}return new o.SignalingDTMFSender(t)}}]),e}();t.FF=s},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(17),a=n(1),s=n(0),c=function(){function e(){r(this,e)}return i(e,[{key:"_traceName",value:function(){return"Webkit"}}],[{key:"attachStream",value:function(e){var t=e.element;try{t.srcObject=e.stream,t.load(),e.playElement();var n=a.Client.getInstance()._defaultSinkId;null!=n&&"function"==typeof t.setSinkId&&t.setSinkId(n)}catch(e){s.LogManager.get().writeMessage(s.LogCategory.USERMEDIA,"Webkit: ",s.LogLevel.WARNING,JSON.stringify(e))}}},{key:"detachStream",value:function(e){e.element.srcObject=null,e.pauseElement(),e.element.src=""}},{key:"getDTMFSender",value:function(e,t){if(!e.createDTMFSender)return new o.SignalingDTMFSender(t);var n=[];return e.getLocalStreams().forEach(function(e){e.getAudioTracks().forEach(function(e){n.push(e)})}),n.length?e.createDTMFSender(n[0]):void 0}},{key:"screenSharingSupported",value:function(){return-1!==navigator.userAgent.indexOf("Android")?Promise.resolve(!1):new Promise(function(e,t){if(navigator.getDisplayMedia)e(!0);else if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)e(!0);else{var n=function t(n){n.origin===window.location.origin&&"VoximplantWebsdkExtensionLoaded"===n.data&&(window.removeEventListener("message",t),clearTimeout(r),e(!0))};window.addEventListener("message",n),window.postMessage("VoximplantWebsdkCheckExtension","*");var r=setTimeout(function(){window.removeEventListener("message",n),e(!1)},800)}})}},{key:"getScreenMedia",value:function(){return navigator.getDisplayMedia?navigator.getDisplayMedia({video:!0}):navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia?navigator.mediaDevices.getDisplayMedia({video:!0}):new Promise(function(e,t){window.postMessage("voximplantWebsdkGetSourceId","*");var n=function n(r){if(r.data&&r.origin===window.location.origin&&r.data.result){if("err"===r.data.result)return t(new Error(r.data.reason));if("ok"===r.data.result&&void 0!==r.data.sourceId){window.removeEventListener("message",n);var i={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:screen.width>1920?screen.width:1920,maxHeight:screen.height>1080?screen.height:1080,chromeMediaSourceId:r.data.sourceId},optional:[{googTemporalLayeredScreencast:!0}]}};s.LogManager.get().writeMessage(s.LogCategory.USERMEDIA,"[constraints]",s.LogLevel.INFO,JSON.stringify(i)),navigator.mediaDevices.getUserMedia(i).then(function(t){e(t)},function(e){t(e)})}}};window.addEventListener("message",n)})}},{key:"getRTCStats",value:function(t){return new Promise(function(n,r){var i=[];t.getStats(null).then(function(t){t.forEach(function(e){"outbound-rtp"!=e.type&&"inbound-rtp"!=e.type||i.push(e)}),n({raw:i,formatted:e.prepareRTCStats(t)})}).catch(r)})}},{key:"prepareRTCStats",value:function(e){var t=[];return e.forEach(function(e){"inbound-rtp"===e.type&&e.isRemote?t.push(Object.assign(e,{type:"remote-inbound-rtp"})):"outbound-rtp"===e.type&&e.isRemote?t.push(Object.assign(e,{type:"remote-outbound-rtp"})):t.push(e)}),t}}]),e}();t.Webkit=c},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){r(this,e)}return i(e,[{key:"_traceName",value:function(){return"Edge"}}],[{key:"attachStream",value:function(e){e.element.srcObject=e.stream,e.playElement()}},{key:"detachStream",value:function(e){e.pauseElement(),e.element.src=""}},{key:"getScreenMedia",value:function(){return navigator.getDisplayMedia?navigator.getDisplayMedia():new Promise(function(e,t){t(new Error("Screen sharing not allowed for you platform"))})}},{key:"getRTCStats",value:function(e){return new Promise(function(e,t){t(new Error("RTCStats sharing not allowed for you platform"))})}},{key:"screenSharingSupported",value:function(){return new Promise(function(e,t){if(navigator.getDisplayMedia)return void e(!0);e(!1)})}}]),e}();t.Edge=o},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(17),a=function(){function e(){r(this,e)}return i(e,[{key:"_traceName",value:function(){return"Safari"}}],[{key:"attachStream",value:function(e){e.element.srcObject=e.stream}},{key:"detachStream",value:function(e){e.pauseElement(),e.element.src=""}},{key:"getDTMFSender",value:function(e,t){return new o.SignalingDTMFSender(t)}},{key:"getScreenMedia",value:function(){return navigator.mediaDevices.getDisplayMedia()}},{key:"screenSharingSupported",value:function(){return navigator&&navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia?Promise.resolve(!0):Promise.resolve(!1)}},{key:"getRTCStats",value:function(t){return new Promise(function(n,r){var i=[];t.getStats(null).then(function(t){t.forEach(function(e){if("ssrc"==e.type){var t={};t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,i.push(t)}}),n({raw:i,formatted:e.prepareRTCStats(t)})}).catch(r)})}},{key:"prepareRTCStats",value:function(e){var t=[];return e.forEach(function(e){"track"!==e.type||e.kind?"outbound-rtp"===e.type||"inbound-rtp"===e.type?t.push(Object.assign(e,{trackId:e.mediaTrackId})):t.push(e):t.push(Object.assign(e,{kind:e.id.includes("audio")?"audio":e.id.includes("video")?"video":void 0}))}),t}}]),e}();t.Safari=a},function(e,t,n){!function(t,n){e.exports=n()}(0,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var i in e)t.d(r,i,function(t){return e[t]}.bind(null,i));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=86)}({17:function(e,t,n){var r,i,o;i=[t],void 0===(o="function"==typeof(r=function(n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return t=e,i=[{key:"getFirstMatch",value:function(e,t){var n=t.match(e);return n&&n.length>0&&n[1]||""}},{key:"getSecondMatch",value:function(e,t){var n=t.match(e);return n&&n.length>1&&n[2]||""}},{key:"matchAndReturnConst",value:function(e,t,n){if(e.test(t))return n}},{key:"getWindowsVersionName",value:function(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}},{key:"getAndroidVersionName",value:function(e){var t=e.split(".").splice(0,2).map(function(e){return parseInt(e,10)||0});if(t.push(0),!(1===t[0]&&t[1]<5))return 1===t[0]&&t[1]<6?"Cupcake":1===t[0]&&t[1]>=6?"Donut":2===t[0]&&t[1]<2?"Eclair":2===t[0]&&2===t[1]?"Froyo":2===t[0]&&t[1]>2?"Gingerbread":3===t[0]?"Honeycomb":4===t[0]&&t[1]<1?"Ice Cream Sandwich":4===t[0]&&t[1]<4?"Jelly Bean":4===t[0]&&t[1]>=4?"KitKat":5===t[0]?"Lollipop":6===t[0]?"Marshmallow":7===t[0]?"Nougat":8===t[0]?"Oreo":void 0}},{key:"getVersionPrecision",value:function(e){return e.split(".").length}},{key:"compareVersions",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=e.getVersionPrecision(t),o=e.getVersionPrecision(n),a=Math.max(i,o),s=0,c=e.map([t,n],function(t){var n=a-e.getVersionPrecision(t),r=t+new Array(n+1).join(".0");return e.map(r.split("."),function(e){return new Array(20-e.length).join("0")+e}).reverse()});for(r&&(s=a-Math.min(i,o)),a-=1;a>=s;){if(c[0][a]>c[1][a])return 1;if(c[0][a]===c[1][a]){if(a===s)return 0;a-=1}else if(c[0][a]<c[1][a])return-1}}},{key:"map",value:function(e,t){var n,r=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(n=0;n<e.length;n+=1)r.push(t(e[n]));return r}}],(n=null)&&r(t.prototype,n),i&&r(t,i),e;var t,n,i}();n.default=i,e.exports=t.default})?r.apply(t,i):r)||(e.exports=o)},86:function(e,t,n){var r,i,o;i=[t,n(87)],void 0===(o="function"==typeof(r=function(n,r){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o;Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0,r=(o=r)&&o.__esModule?o:{default:o};var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return t=e,o=[{key:"getParser",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("string"!=typeof e)throw new Error("UserAgent should be a string");return new r.default(e,t)}},{key:"parse",value:function(e){return new r.default(e).getResult()}}],(n=null)&&i(t.prototype,n),o&&i(t,o),e;var t,n,o}();n.default=a,e.exports=t.default})?r.apply(t,i):r)||(e.exports=o)},87:function(e,t,n){var r,i,o;i=[t,n(88),n(89),n(90),n(91),n(17)],void 0===(o="function"==typeof(r=function(n,r,i,o,a,s){"use strict";function c(e){return e&&e.__esModule?e:{default:e}}function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0,r=c(r),i=c(i),o=c(o),a=c(a),s=c(s);var d=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),null==t||""===t)throw new Error("UserAgent parameter can't be empty");this._ua=t,this.parsedResult={},!0!==n&&this.parse()}return t=e,(n=[{key:"getUA",value:function(){return this._ua}},{key:"test",value:function(e){return e.test(this._ua)}},{key:"parseBrowser",value:function(){var e=this;this.parsedResult.browser={};var t=r.default.find(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some(function(t){return e.test(t)});throw new Error("Browser's test function is not valid")});return t&&(this.parsedResult.browser=t.describe(this.getUA())),this.parsedResult.browser}},{key:"getBrowser",value:function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()}},{key:"getBrowserName",value:function(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""}},{key:"getBrowserVersion",value:function(){return this.getBrowser().version}},{key:"getOS",value:function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()}},{key:"parseOS",value:function(){var e=this;this.parsedResult.os={};var t=i.default.find(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some(function(t){return e.test(t)});throw new Error("Browser's test function is not valid")});return t&&(this.parsedResult.os=t.describe(this.getUA())),this.parsedResult.os}},{key:"getOSName",value:function(e){var t=this.getOS(),n=t.name;return e?String(n).toLowerCase()||"":n||""}},{key:"getOSVersion",value:function(){return this.getOS().version}},{key:"getPlatform",value:function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()}},{key:"getPlatformType",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.getPlatform(),n=t.type;return e?String(n).toLowerCase()||"":n||""}},{key:"parsePlatform",value:function(){var e=this;this.parsedResult.platform={};var t=o.default.find(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some(function(t){return e.test(t)});throw new Error("Browser's test function is not valid")});return t&&(this.parsedResult.platform=t.describe(this.getUA())),this.parsedResult.platform}},{key:"getEngine",value:function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()}},{key:"getEngineName",value:function(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""}},{key:"parseEngine",value:function(){var e=this;this.parsedResult.engine={};var t=a.default.find(function(t){if("function"==typeof t.test)return t.test(e);if(t.test instanceof Array)return t.test.some(function(t){return e.test(t)});throw new Error("Browser's test function is not valid")});return t&&(this.parsedResult.engine=t.describe(this.getUA())),this.parsedResult.engine}},{key:"parse",value:function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this}},{key:"getResult",value:function(){return Object.assign({},this.parsedResult)}},{key:"satisfies",value:function(e){var t=this,n={},r=0,i={},o=0;if(Object.keys(e).forEach(function(t){var a=e[t];"string"==typeof a?(i[t]=a,o+=1):"object"===l(a)&&(n[t]=a,r+=1)}),r>0){var a=Object.keys(n),s=a.find(function(e){return t.isOS(e)});if(s){var c=this.satisfies(n[s]);if(void 0!==c)return c}var u=a.find(function(e){return t.isPlatform(e)});if(u){var d=this.satisfies(n[u]);if(void 0!==d)return d}}if(o>0){var f=Object.keys(i),g=f.find(function(e){return t.isBrowser(e)});if(void 0!==g)return this.compareVersion(i[g])}}},{key:"isBrowser",value:function(e){return this.getBrowserName(!0)===String(e).toLowerCase()}},{key:"compareVersion",value:function(e){var t=[0],n=e,r=!1,i=this.getBrowserVersion();if("string"==typeof i)return">"===e[0]||"<"===e[0]?(n=e.substr(1),"="===e[1]?(r=!0,n=e.substr(2)):t=[],">"===e[0]?t.push(1):t.push(-1)):"="===e[0]?n=e.substr(1):"~"===e[0]&&(r=!0,n=e.substr(1)),t.indexOf(s.default.compareVersions(i,n,r))>-1}},{key:"isOS",value:function(e){return this.getOSName(!0)===String(e).toLowerCase()}},{key:"isPlatform",value:function(e){return this.getPlatformType(!0)===String(e).toLowerCase()}},{key:"isEngine",value:function(e){return this.getEngineName(!0)===String(e).toLowerCase()}},{key:"is",value:function(e){return this.isBrowser(e)||this.isOS(e)||this.isPlatform(e)}},{key:"some",value:function(){var e=this;return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).some(function(t){return e.is(t)})}}])&&u(t.prototype,n),c&&u(t,c),e;var t,n,c}();n.default=d,e.exports=t.default})?r.apply(t,i):r)||(e.exports=o)},88:function(e,t,n){var r,i,o;i=[t,n(17)],void 0===(o="function"==typeof(r=function(n,r){"use strict";var i;Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0,r=(i=r)&&i.__esModule?i:{default:i};var o=/version\/(\d+(\.?_?\d+)+)/i,a=[{test:[/googlebot/i],describe:function(e){var t={name:"Googlebot"},n=r.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,e)||r.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/opera/i],describe:function(e){var t={name:"Opera"},n=r.default.getFirstMatch(o,e)||r.default.getFirstMatch(/(?:opera)[\s\/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/opr\/|opios/i],describe:function(e){var t={name:"Opera"},n=r.default.getFirstMatch(/(?:opr|opios)[\s\/](\S+)/i,e)||r.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/SamsungBrowser/i],describe:function(e){var t={name:"Samsung Internet for Android"},n=r.default.getFirstMatch(o,e)||r.default.getFirstMatch(/(?:SamsungBrowser)[\s\/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/Whale/i],describe:function(e){var t={name:"NAVER Whale Browser"},n=r.default.getFirstMatch(o,e)||r.default.getFirstMatch(/(?:whale)[\s\/](\d+(?:\.\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/MZBrowser/i],describe:function(e){var t={name:"MZ Browser"},n=r.default.getFirstMatch(/(?:MZBrowser)[\s\/](\d+(?:\.\d+)+)/i,e)||r.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/focus/i],describe:function(e){var t={name:"Focus"},n=r.default.getFirstMatch(/(?:focus)[\s\/](\d+(?:\.\d+)+)/i,e)||r.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/swing/i],describe:function(e){var t={name:"Swing"},n=r.default.getFirstMatch(/(?:swing)[\s\/](\d+(?:\.\d+)+)/i,e)||r.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/coast/i],describe:function(e){var t={name:"Opera Coast"},n=r.default.getFirstMatch(o,e)||r.default.getFirstMatch(/(?:coast)[\s\/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/yabrowser/i],describe:function(e){var t={name:"Yandex Browser"},n=r.default.getFirstMatch(o,e)||r.default.getFirstMatch(/(?:yabrowser)[\s\/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/ucbrowser/i],describe:function(e){var t={name:"UC Browser"},n=r.default.getFirstMatch(o,e)||r.default.getFirstMatch(/(?:ucbrowser)[\s\/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/Maxthon|mxios/i],describe:function(e){var t={name:"Maxthon"},n=r.default.getFirstMatch(o,e)||r.default.getFirstMatch(/(?:Maxthon|mxios)[\s\/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/epiphany/i],describe:function(e){var t={name:"Epiphany"},n=r.default.getFirstMatch(o,e)||r.default.getFirstMatch(/(?:epiphany)[\s\/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/puffin/i],describe:function(e){var t={name:"Puffin"},n=r.default.getFirstMatch(o,e)||r.default.getFirstMatch(/(?:puffin)[\s\/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/sleipnir/i],describe:function(e){var t={name:"Sleipnir"},n=r.default.getFirstMatch(o,e)||r.default.getFirstMatch(/(?:sleipnir)[\s\/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/k-meleon/i],describe:function(e){var t={name:"K-Meleon"},n=r.default.getFirstMatch(o,e)||r.default.getFirstMatch(/(?:k-meleon)[\s\/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/micromessenger/i],describe:function(e){var t={name:"WeChat"},n=r.default.getFirstMatch(/(?:micromessenger)[\s\/](\d+(\.?_?\d+)+)/i,e)||r.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/msie|trident/i],describe:function(e){var t={name:"Internet Explorer"},n=r.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/edg([ea]|ios)/i],describe:function(e){var t={name:"Microsoft Edge"},n=r.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/vivaldi/i],describe:function(e){var t={name:"Vivaldi"},n=r.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/seamonkey/i],describe:function(e){var t={name:"SeaMonkey"},n=r.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/sailfish/i],describe:function(e){var t={name:"Sailfish"},n=r.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,e);return n&&(t.version=n),t}},{test:[/silk/i],describe:function(e){var t={name:"Amazon Silk"},n=r.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/phantom/i],describe:function(e){var t={name:"PhantomJS"},n=r.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/slimerjs/i],describe:function(e){var t={name:"SlimerJS"},n=r.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t={name:"BlackBerry"},n=r.default.getFirstMatch(o,e)||r.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t={name:"WebOS Browser"},n=r.default.getFirstMatch(o,e)||r.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/bada/i],describe:function(e){var t={name:"Bada"},n=r.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/tizen/i],describe:function(e){var t={name:"Tizen"},n=r.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,e)||r.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/qupzilla/i],describe:function(e){var t={name:"QupZilla"},n=r.default.getFirstMatch(/(?:qupzilla)[\s\/](\d+(\.?_?\d+)+)/i,e)||r.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/firefox|iceweasel|fxios/i],describe:function(e){var t={name:"Firefox"},n=r.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s\/](\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/chromium/i],describe:function(e){var t={name:"Chromium"},n=r.default.getFirstMatch(/(?:chromium)[\s\/](\d+(\.?_?\d+)+)/i,e)||r.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/chrome|crios|crmo/i],describe:function(e){var t={name:"Chrome"},n=r.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:function(e){var t=!e.test(/like android/i),n=e.test(/android/i);return t&&n},describe:function(e){var t={name:"Android Browser"},n=r.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/playstation 4/i],describe:function(e){var t={name:"PlayStation 4"},n=r.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/safari|applewebkit/i],describe:function(e){var t={name:"Safari"},n=r.default.getFirstMatch(o,e);return n&&(t.version=n),t}},{test:[/.*/i],describe:function(e){return{name:r.default.getFirstMatch(/^(.*)\/(.*) /,e),version:r.default.getSecondMatch(/^(.*)\/(.*) /,e)}}}];n.default=a,e.exports=t.default})?r.apply(t,i):r)||(e.exports=o)},89:function(e,t,n){var r,i,o;i=[t,n(17)],void 0===(o="function"==typeof(r=function(n,r){"use strict";var i;Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0,r=(i=r)&&i.__esModule?i:{default:i};var o=[{test:[/windows phone/i],describe:function(e){return{name:"Windows Phone",version:r.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,e)}}},{test:[/windows/i],describe:function(e){var t=r.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,e);return{name:"Windows",version:t,versionName:r.default.getWindowsVersionName(t)}}},{test:[/macintosh/i],describe:function(e){return{name:"macOS",version:r.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,e).replace(/[_\s]/g,".")}}},{test:[/(ipod|iphone|ipad)/i],describe:function(e){return{name:"iOS",version:r.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,e).replace(/[_\s]/g,".")}}},{test:function(e){var t=!e.test(/like android/i),n=e.test(/android/i);return t&&n},describe:function(e){var t=r.default.getFirstMatch(/android[\s\/-](\d+(\.\d+)*)/i,e),n=r.default.getAndroidVersionName(t),i={name:"Android",version:t};return n&&(i.versionName=n),i}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t=r.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,e),n={name:"WebOS"};return t&&t.length&&(n.version=t),n}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){return{name:"BlackBerry",version:r.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,e)||r.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,e)||r.default.getFirstMatch(/\bbb(\d+)/i,e)}}},{test:[/bada/i],describe:function(e){return{name:"Bada",version:r.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,e)}}},{test:[/tizen/i],describe:function(e){return{name:"Tizen",version:r.default.getFirstMatch(/tizen[\/\s](\d+(\.\d+)*)/i,e)}}},{test:[/linux/i],describe:function(){return{name:"Linux"}}},{test:[/CrOS/],describe:function(){return{name:"Chrome OS"}}},{test:[/PlayStation 4/],describe:function(e){return{name:"PlayStation 4",version:r.default.getFirstMatch(/PlayStation 4[\/\s](\d+(\.\d+)*)/i,e)}}}];n.default=o,e.exports=t.default})?r.apply(t,i):r)||(e.exports=o)},90:function(e,t,n){var r,i,o;i=[t,n(17)],void 0===(o="function"==typeof(r=function(n,r){"use strict";var i;Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0,r=(i=r)&&i.__esModule?i:{default:i};var o={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},a=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(e){var t=r.default.getFirstMatch(/(can-l01)/i,e)&&"Nova",n={type:o.mobile,vendor:"Huawei"};return t&&(n.model=t),n}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:o.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:o.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:o.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:o.tablet,vendor:"Amazon"}}},{test:[/tablet/i],describe:function(){return{type:o.tablet}}},{test:function(e){var t=e.test(/ipod|iphone/i),n=e.test(/like (ipod|iphone)/i);return t&&!n},describe:function(e){var t=r.default.getFirstMatch(/(ipod|iphone)/i,e);return{type:o.mobile,vendor:"Apple",model:t}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:o.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:o.mobile}}},{test:function(e){return"blackberry"===e.getBrowserName(!0)},describe:function(){return{type:o.mobile,vendor:"BlackBerry"}}},{test:function(e){return"bada"===e.getBrowserName(!0)},describe:function(){return{type:o.mobile}}},{test:function(e){return"windows phone"===e.getBrowserName()},describe:function(){return{type:o.mobile,vendor:"Microsoft"}}},{test:function(e){var t=Number(String(e.getOSVersion()).split(".")[0]);return"android"===e.getOSName(!0)&&t>=3},describe:function(){return{type:o.tablet}}},{test:function(e){return"android"===e.getOSName(!0)},describe:function(){return{type:o.mobile}}},{test:function(e){return"macos"===e.getOSName(!0)},describe:function(){return{type:o.desktop,vendor:"Apple"}}},{test:function(e){return"windows"===e.getOSName(!0)},describe:function(){return{type:o.desktop}}},{test:function(e){return"linux"===e.getOSName(!0)},describe:function(){return{type:o.desktop}}},{test:function(e){return"playstation 4"===e.getOSName(!0)},describe:function(){return{type:o.tv}}}];n.default=a,e.exports=t.default})?r.apply(t,i):r)||(e.exports=o)},91:function(e,t,n){var r,i,o;i=[t,n(17)],void 0===(o="function"==typeof(r=function(n,r){"use strict";var i;Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0,r=(i=r)&&i.__esModule?i:{default:i};var o=[{test:function(e){return"microsoft edge"===e.getBrowserName(!0)},describe:function(e){return{name:"EdgeHTML",version:r.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,e)}}},{test:[/trident/i],describe:function(e){var t={name:"Trident"},n=r.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:function(e){return e.test(/presto/i)},describe:function(e){var t={name:"Presto"},n=r.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:function(e){var t=e.test(/gecko/i),n=e.test(/like gecko/i);return t&&!n},describe:function(e){var t={name:"Gecko"},n=r.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:"Blink"}}},{test:[/(apple)?webkit/i],describe:function(e){var t={name:"WebKit"},n=r.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,e);return n&&(t.version=n),t}}];n.default=o,e.exports=t.default})?r.apply(t,i):r)||(e.exports=o)}})})},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":s(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var l,u=n(30),d=n(9),f=n(10),g=n(0),p=n(2),v=n(17),h=n(6),m=n(3),y=n(64),C=n(5),_=n(25),S=n(13),E=n(24),L=n(1),b=n(42),M=n(4),R=n(31),T=n(41),k=n(32),I=M.default.IOSCacheManager;!function(e){e[e.offer="offer"]="offer",e[e.answer="answer"]="answer",e[e.pranswer="pranswer"]="pranswer",e[e.rollback="rollback"]="rollback"}(l||(l={}));var P;!function(e){e[e.controlling="controlling"]="controlling",e[e.controlled="controlled"]="controlled"}(P||(P={}));var w=function(e){function t(e,n,o,a){r(this,t);var s=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,o));s.candidatePool=[],s.iceTimer=null,s.needTransportRestart=!0,s.ICE_TIMEOUT=2e4,s.RENEGOTIATION_TIMEOUT=15e3,s.canDeliverStats=!0,s._needIceRestart=!1,s._canReInvite=function(){return"connected"===s.impl.iceConnectionState||"completed"===s.impl.iceConnectionState};var c=f.PCFactory.get().iceConfig,l=c;return void 0!==l&&null!==l||(l={gatherPolicy:"all",iceServers:[]}),a&&(l.iceServers=a),l.bundlePolicy="max-compat",s._createImpl(l),s}return o(t,e),a(t,[{key:"_getLocalOfferRegular",value:function(){var e=this;return this.iceRole=P.controlling,new Promise(function(t,n){var r={};e._call&&!e._call.settings.isConference&&(r=e.getReceiveOptions()),e.impl.createOffer(r).then(function(t){e.logger.info("_getLocalOfferRegular(), created local SDP: \n"+t.sdp);var n={type:t.type,sdp:t.sdp};return n=f.PCFactory.get().addBandwidthParams(n),n=E.SDPMuggle.removeDoublePT(n),e._call&&e._call.settings.isConference&&(n=e._reduceCodecs(n)),e.codecRearrange(n)}).then(function(t){return e.srcLocalSDP=t.sdp,e.logger.info("_getLocalOfferRegular(), set local SDP: \n"+t.sdp),e._call&&e._call.dispatchEvent({name:"SDP",origin:"getLocalOffer",sdp:t}),e.impl.setLocalDescription(t)}).then(function(){t(e.impl.localDescription)}).catch(function(t){e._call&&e._call.dispatchEvent({name:"SDP",origin:"_getLocalOfferRegular",sdp:e.impl.localDescription,description:"offer_reject: "+t.message}),n(t)})})}},{key:"updateHoldState",value:function(){var e=this;this.impl.getTransceivers().forEach(function(t){t.sender.track&&("audio"===t.sender.track.kind?t.sender.track.enabled=!e.onHold&&!e.muteMicState:t.sender.track.enabled=!e.onHold)})}},{key:"_processRemoteAnswer",value:function(e,t){var n=this;if(this._pendingOffer)return new Promise(function(r,i){n.logger.info("_processRemoteAnswer(), set local SDP: \n"+n._pendingOffer.sdp),n._call&&n._call.dispatchEvent({name:"SDP",origin:"processRemoteAnswer",sdp:n._pendingOffer}),n.impl.setLocalDescription(n._pendingOffer).then(function(){r(n._processRemoteAnswer(e,t))}).catch(function(e){n._call&&n._call.dispatchEvent({name:"SDP",origin:"processRemoteAnswer",sdp:n.impl.localDescription,description:"answer_reject: "+e.message}),i(e)}),n._pendingOffer=void 0});if(0===t.length&&this._call)return this.logger.error("Empty SDP from server. Call will be terminated."),void this._call.hangup({"X-WebRTCError":"no sdp"});if(this.iceTimer=setTimeout(function(){n._call.notifyICETimeout()},this.ICE_TIMEOUT),this.pendingEvent=[e,t],null===this.impl.remoteDescription||""==this.impl.remoteDescription.sdp){var r={sdp:t,type:l.answer};return this.srcRemoteSDP=t,r=E.SDPMuggle.removeTIAS(r),this.logger.info("_processRemoteAnswer(), set remote SDP: \n"+r.sdp),this._call&&this._call.dispatchEvent({name:"SDP",origin:"processRemoteAnswer",sdp:r}),this.impl.setRemoteDescription(r).then(function(e){n._needIceRestart&&n._runReinvite(!0)}).catch(function(e){n._call&&n._call.dispatchEvent({name:"SDP",origin:"_processRemoteAnswer",sdp:n.impl.localDescription,description:"answer_reject: "+e.message})})}}},{key:"_getLocalOffer",value:function(){return"firefox"===d.default.getWSVendor()&&this.impl.remoteDescription&&this.impl.remoteDescription.sdp&&-1===this.impl.remoteDescription.sdp.indexOf("VIMS")?this._getLocalOfferFF():this._getLocalOfferRegular()}},{key:"_getLocalOfferFF",value:function(){var e=this;return this.iceRole=P.controlling,new Promise(function(t,n){var r={};e._call&&!e._call.settings.isConference&&(r=e.getReceiveOptions()),e.impl.createOffer(r).then(function(t){e.logger.info("_getLocalOfferFF(), created local SDP: \n"+t.sdp);var n={type:t.type,sdp:t.sdp};return n=f.PCFactory.get().addBandwidthParams(n),n=E.SDPMuggle.removeDoublePT(n),e._call&&e._call.settings.isConference&&(n=e._reduceCodecs(n)),e.codecRearrange(n)}).then(function(n){e.srcLocalSDP=n.sdp,e._pendingOffer=n,t(n)}).catch(function(t){e._call&&e._call.dispatchEvent({name:"SDP",origin:"_getLocalOfferFF",sdp:e._pendingOffer,description:"offer_reject: "+t.message}),n(t)})})}},{key:"_getLocalAnswer",value:function(){var e=this;return this.iceRole=P.controlled,new Promise(function(t,n){var r={mandatory:{}};e._call&&!e._call.settings.isConference&&(r={mandatory:e.getReceiveOptions()}),e.impl.createAnswer(r).then(function(t){e.logger.info("_getLocalAnswer(), created local SDP: \n"+t.sdp);var n={type:t.type,sdp:t.sdp};return n=f.PCFactory.get().addBandwidthParams(n),n=E.SDPMuggle.removeDoublePT(n),n=E.SDPMuggle.fixVideoRecieve(n,e._call.settings.videoDirections.receiveVideo),e._call&&e._call.settings.isConference&&(t=e._reduceCodecs(t)),e.codecRearrange(n)}).then(function(t){return e.srcLocalSDP=t.sdp,e.logger.info("_getLocalAnswer(), set local SDP: \n"+t.sdp),e._call&&e._call.dispatchEvent({name:"SDP",origin:"getLocalAnswer",sdp:t}),e.impl.setLocalDescription(t)}).then(function(){t({type:l.answer,sdp:e.impl.localDescription.sdp})}).catch(function(t){e._call&&e._call.dispatchEvent({name:"SDP",origin:"_getLocalAnswer",sdp:e.impl.localDescription,description:"answer_reject: "+t.message}),n(t)})})}},{key:"_processRemoteOffer",value:function(e){var t=this;return 0===e.length&&this._call?(this.logger.error("Empty SDP from server. Call will be terminated."),void this._call.hangup({"X-WebRTCError":"no sdp"})):(this.iceRole=P.controlled,new Promise(function(n,r){var i=new RTCSessionDescription({sdp:e,type:l.offer});t.srcRemoteSDP=e,i=E.SDPMuggle.removeTIAS(i),i=E.SDPMuggle.fixFFMIDBug(i),t.logger.info("_processRemoteOffer(), set remote SDP: \n"+i.sdp),t._call&&t._call.dispatchEvent({name:"SDP",origin:"processRemoteOffer",sdp:i}),t.impl.setRemoteDescription(i).then(function(){var e={mandatory:{}};return t._call&&!t._call.settings.isConference&&(e={mandatory:t.getReceiveOptions()}),t.impl.createAnswer(e)}).then(function(e){return t.logger.info("_processRemoteOffer(), created local SDP: \n"+e.sdp),e=E.SDPMuggle.removeDoublePT(e),t._call&&t._call.settings.isConference&&(e=t._reduceCodecs(e)),t.codecRearrange(e)}).then(function(e){return t.srcLocalSDP=e.sdp,t.logger.info("_processRemoteOffer(), set local SDP: \n"+e.sdp),t._call&&t._call.dispatchEvent({name:"SDP",origin:"processRemoteOffer",sdp:e}),t.impl.setLocalDescription(e)}).then(function(){n(t.impl.localDescription.sdp)}).catch(function(e){t._call&&t._call.dispatchEvent({name:"SDP",origin:"_processRemoteOffer",sdp:t.impl.localDescription,description:"answer_reject: "+e.message}),r(e)})}))}},{key:"_setRemoteDescription",value:function(e){if(0===e.length&&this._call)return this.logger.error("Empty SDP from server. Call will be terminated."),void this._call.hangup({"X-WebRTCError":"no sdp"});var t=new RTCSessionDescription({sdp:e,type:l.offer});return t=E.SDPMuggle.removeTIAS(t),this.srcRemoteSDP=e,this.logger.info("_setRemoteDescription(), set remote SDP: \n"+t.sdp),this._call&&this._call.dispatchEvent({name:"SDP",origin:"setRemoteDescription",sdp:t}),this.impl.setRemoteDescription(t)}},{key:"_handleRemoteOffer",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.renegotiationInProgress=!0,0===t.length&&this._call?(this.logger.error("Empty SDP from server. Call will be terminated."),void this._call.hangup({"X-WebRTCError":"no sdp"})):new Promise(function(i,o){var a=new RTCSessionDescription({sdp:t,type:"offer"});"stable"!==n.impl.signalingState&&"safari"!==d.default.getWSVendor()?Promise.all([n.impl.setLocalDescription({type:"rollback"}),n.impl.setRemoteDescription(a)]).then(function(){return n.impl.createAnswer()}).then(function(t){var r={sdp:t.sdp,type:t.type};r=E.SDPMuggle.removeDoubleOpus(r),r=E.SDPMuggle.removeDoublePT(r),r=E.SDPMuggle.fixVideoRecieve(r,n.videoEnabled.receiveVideo),n._call&&n._call.settings.isConference&&(r=n._reduceCodecs(r));var o={tracks:n.getTrackKind(t.sdp)};p.VoxSignaling.get().callRemoteFunction(m.RemoteFunction.acceptReInvite,n._call.id(),e,r.sdp,o),n._call&&n._call.dispatchEvent({name:C.CallEvents.Updated,result:!0,call:n._call}),n.impl.setLocalDescription(r).then(function(){n.renegotiationInProgress=!1,n.updateHoldState(),setTimeout(function(e){return n._fixTransreceiver()},0),i()})}).catch(function(i){r?console.error(i):setTimeout(function(){n._handleRemoteOffer(e,t,!0)},300)}):n.impl.setRemoteDescription(a).then(function(){return n.impl.createAnswer()}).then(function(t){var r={sdp:t.sdp,type:t.type};n._call&&n._call.settings.isConference&&(r=n._reduceCodecs(r)),n.impl.setLocalDescription(r);var o={tracks:n.getTrackKind(t.sdp)};p.VoxSignaling.get().callRemoteFunction(m.RemoteFunction.acceptReInvite,n._call.id(),e,r.sdp,o),n.renegotiationInProgress=!1,n._call&&n._call.dispatchEvent({name:C.CallEvents.Updated,result:!0,call:n._call}),n.updateHoldState(),setTimeout(function(e){return n._fixTransreceiver()},0),i()}).catch(function(e){return console.error(e)})})}},{key:"_handleReinvite",value:function(e,t){var n=this;return 0===t.length&&this._call?(this.logger.error("Empty SDP from server. Call will be terminated."),void this._call.hangup({"X-WebRTCError":"no sdp"})):new Promise(function(e,r){var i=function(e){n._call&&n._call.dispatchEvent({name:"SDP",origin:"_handleReinvite",sdp:n.impl.localDescription,description:"answer_reject: "+e.message}),r(e)};if(n.banReinviteAnswer&&r(new Error),!1===n.renegotiationInProgress)e();else if(!0===n.renegotiationInProgress){var o={sdp:t,type:l.answer};if(n.renegotiationInProgress=!1,n.srcRemoteSDP=t,o=E.SDPMuggle.removeTIAS(o),n.logger.info("_handleReinvite(), set local SDP: \n"+n.pendingOffer.sdp),n._call&&n._call.dispatchEvent({name:"SDP",origin:"handleReinviteInProgress",sdp:n.pendingOffer}),"stable"!==n.impl.signalingState)return;n.impl.setLocalDescription(n.pendingOffer).then(function(){n.logger.info("_handleReinvite(), set remote SDP: \n"+o.sdp),n._call&&n._call.dispatchEvent({name:"SDP",origin:"handleReinviteInProgress",sdp:o}),n.impl.setRemoteDescription(o).then(function(){n._call&&n._call.dispatchEvent({name:C.CallEvents.Updated,result:!0,call:n._call}),n.updateHoldState(),setTimeout(function(e){return n._fixTransreceiver()},0),e()}).catch(function(e){n._call&&n._call.dispatchEvent({name:C.CallEvents.Updated,result:!1,call:n._call}),n.renegotiationInProgress=!1,n.logger.error(JSON.stringify(e)),setTimeout(function(e){return n._fixTransreceiver()},0),i(e)}),clearTimeout(n.renegotiationTimer)}).catch(i)}else r(new Error("Universe was broken!"))})}},{key:"_close",value:function(){var e=this;clearInterval(this.rtcCollectingCycle),this.impl.onnegotiationneeded=null;L.Client.getInstance().config();this.impl.removeTrack?(this.rtpSenders.forEach(function(t){e.impl.removeTrack(t)}),M.default.StreamManager.get().remCallStream(this._call)):(M.default.StreamManager.get().remCallStream(this._call),this.impl.getLocalStreams().forEach(function(t){e.impl.removeStream(t)})),this.impl.close(),void 0!==this._call&&_.CallstatsIo.get().sendFabricEvent(this.impl,_.CallstatsIoFabricEvent.fabricTerminated,this._call.id()),this._localStream=null,this._remoteStreams=null}},{key:"_addRemoteCandidate",value:function(e,t){var n=this;return new Promise(function(r,i){try{var o=new RTCIceCandidate({candidate:e.substring(2),sdpMLineIndex:t});n.candidatePool.push(o),n.impl.addIceCandidate(o).then(function(){r()}).catch(function(){r()})}catch(e){r()}})}},{key:"setConfiguration",value:function(e){var t=this;this.impl&&setTimeout(function(){if(t.srcRemoteSDP&&-1===t.srcRemoteSDP.indexOf("VIMS"))if(t.impl&&t.impl.setConfiguration)t.impl.setConfiguration(e),t.renegotiationInProgress=!1,t._runReinvite(!0),setTimeout(function(){t.candidatePool.forEach(function(e){t.impl.addIceCandidate(e).catch(function(){})})},2e3);else if(t._pendingOffer){var n=[];t.impl.getTransceivers().map(function(e){e.sender.track&&n.push(e.sender.track)}),t._createImpl(e),n.forEach(function(e){t.impl.addTrack(e,new MediaStream([e]))}),t.impl.createOffer().then(function(e){return t.logger.info("setConfiguration(), created local SDP: \n"+e.sdp),t._needIceRestart=!0,t.logger.info("setConfiguration(), set local SDP: \n"+t._pendingOffer.sdp),t.impl.setLocalDescription(t._pendingOffer)}).then(function(){t._pendingOffer=void 0}).catch(function(e){t._call&&t._call.dispatchEvent({name:"SDP",origin:"setConfiguration",sdp:t.impl.localDescription,description:"answer_reject: "+e.message}),console.error(e)})}},800)}},{key:"_sendDTMF",value:function(e,t,n){try{this.dtmfSender.insertDTMF(e,t,n)}catch(r){this.dtmfSender=new v.SignalingDTMFSender(this._call.id()),this.dtmfSender.insertDTMF(e,t,n)}}},{key:"_hdnFRSPrep",value:function(){this.banReinviteAnswer=!0}},{key:"_hdnFRS",value:function(){this.renegotiationInProgress=!1,this.onRenegotiation()}},{key:"_traceName",value:function(){return"TransreceiverPC"}},{key:"hasLocalAudio",value:function(){return this.impl.getLocalStreams().some(function(e){return!!e.getAudioTracks().length})}},{key:"hasLocalVideo",value:function(){var e=this;return this.impl.getLocalStreams().some(function(t){return t.getVideoTracks().some(function(t){return!e.shareScreenMedia||!e.shareScreenMedia.some(function(e){return e.getTracks().some(function(e){return e.id===t.id})})})})}},{key:"enableVideo",value:function(e){var t=this,n=[];this._call&&(n=M.default.StreamManager.get()._getScreenSharing(this._call)||[]);var r=[];n.forEach(function(e){return e.stream.getTracks().forEach(function(e){return r.push(e.id)})}),e?(this._call.settings.videoDirections.sendVideo=!0,M.default.StreamManager.get().getCallStream(this._call,!0).then(function(e){if(e.getVideoTracks().length){var n=t.impl.getTransceivers().filter(function(e){return("recvonly"===e.currentDirection||"inactive"===e.currentDirection)&&!e.stopped&&(e.receiver.track&&"video"===e.receiver.track.kind||e.sender.track&&"video"===e.sender.track.kind)});n.length?t.__replaceTrack(n[0],e.getVideoTracks()[0]).then(function(){n[0].direction="sendrecv",M.default.StreamManager.get().updateLocalVideo(),t.onRenegotiation()}):(t.impl.addTransceiver(e.getVideoTracks()[0],{streams:[e],direction:"sendonly"}),M.default.StreamManager.get().updateLocalVideo())}})):(n.length&&n.forEach(function(e){M.default.StreamManager.get()._clearScreenSharing(t._call,e)}),this.impl.getTransceivers().forEach(function(e){"sendrecv"!==e.currentDirection&&"sendonly"!==e.currentDirection&&"inactive"!==e.currentDirection||!e.sender.track||"video"!==e.sender.track.kind||(e.sender.track.enabled=!1,t.__replaceTrack(e,null).then(function(){e.direction="recvonly",t._call.settings.videoDirections.sendVideo=!1,d.default.isIphone()&&I.get().updateChecksumm({audio:!0,video:!1}),t.onRenegotiation()}).catch(function(e){t.logger.warning("Wrong transceiver on replace")}))}))}},{key:"_replaceVideoTrack",value:function(e){var t=this,n=this.getTransceivers().filter(function(e){return e.sender.track&&"video"===e.sender.track.kind});n&&n.length&&this.__replaceTrack(n[0],e).then(function(){M.default.StreamManager.get().isLocalVideoRequested&&M.default.StreamManager.get().updateLocalVideo(),t._runReinvite()})}},{key:"getTransceivers",value:function(){return this.impl.getTransceivers?this.impl.getTransceivers():[]}},{key:"getRemoteDescription",value:function(){return this.impl.remoteDescription&&this.impl.remoteDescription.sdp?this.impl.remoteDescription.sdp:""}},{key:"_addCustomMedia",value:function(e){var t=this;if(e&&"closed"!==this.impl.signalingState&&("firefox"===d.default.getWSVendor()?e.getTracks().forEach(function(e){var n=new MediaStream([e]);t.rtpSenders.push(t.impl.addTrack(e,n)),t.onRenegotiation()}):this.impl.getTransceivers().length?this.impl.addStream(e):(e.getAudioTracks().forEach(function(n){t.impl.addTransceiver(n,{streams:[e],direction:"sendrecv"})}),e.getVideoTracks().forEach(function(n){t.impl.addTransceiver(n,{streams:[e],direction:"sendrecv"})})),!this.dtmfSender&&this._call)){var n=d.default.getDTMFSender(this.impl,this._call.id());n&&(this.dtmfSender=n)}}},{key:"_removeCustomMedia",value:function(e){e&&this.impl.removeStream(e)}},{key:"_updateCustomMedia",value:function(e){var t=this;if(e&&"closed"!==this.impl.signalingState){var n=[];e.getTracks().forEach(function(e){var r=t.impl.getTransceivers().find(function(t){return t.sender.track&&t.sender.track.kind===e.kind});r&&n.push(t.__replaceTrack(r,e))}),n.length&&Promise.all(n).then(function(){t._runReinvite()})}}},{key:"_fixFFSoundBug",value:function(){var e=this;"firefox"===d.default.getWSVendor()&&f.PCFactory.hasTransceivers&&setTimeout(function(){if(e.impl.getSenders){e.impl.getSenders().forEach(function(e){if(e.replaceTrack){var t=e.track;e.replaceTrack(t)}})}},1e3)}},{key:"getConfiguration",value:function(){return this.impl?this.impl.getConfiguration():null}},{key:"_hold",value:function(e){_.CallstatsIo.get().sendFabricEvent(this.impl,e?_.CallstatsIoFabricEvent.fabricHold:_.CallstatsIoFabricEvent.fabricResume,this._call.id()),this.onHold=e,this.impl.getTransceivers().forEach(function(t){t.stopped||(t.direction=e?"sendonly":"sendrecv")})}},{key:"_getDirections",value:function(){var e={};return e.local=E.SDPMuggle.detectDirections(this.impl.localDescription.sdp),e.remote=E.SDPMuggle.detectDirections(this.impl.remoteDescription.sdp),e}},{key:"_getStreamActivity",value:function(){var e={};return e.local=this.getMediaActivity(this.impl.getLocalStreams()),e.remote=this.getMediaActivity(this.impl.getRemoteStreams()),e}},{key:"_createImpl",value:function(e){var t=this;if(L.Client.getInstance().config()&&L.Client.getInstance().config().experiments&&L.Client.getInstance().config().experiments.relayOnly&&(e=Object.assign({},e,{iceTransportPolicy:"relay"})),this.mode===u.PeerConnectionMode.CONFERENCE&&"chrome"===d.default.getWSVendor()){var n={mandatory:{},optional:[{googHighStartBitrate:!0},{googHighBitrate:!0},{googSkipEncodingUnusedStreams:!0},{googScreencastMinBitrate:400},{googVeryHighBitrate:!0},{googCpuOveruseDetection:!0},{googCpuOveruseEncodeUsage:!0},{googCpuUnderuseThreshold:55},{googCpuOveruseThreshold:85}]},r=RTCPeerConnection;this.impl=new r(e,n)}else this.impl=new RTCPeerConnection(e);if(this.impl.getTransceivers&&"firefox"===d.default.getWSVendor()&&(f.PCFactory.hasTransceivers=!0),void 0!==this.impl.ontrack?this.impl.ontrack=function(e){return t.onAddTrack(e)}:void 0!==this.impl.onaddtrack?this.impl.onaddtrack=function(e){return t.onAddTrack(e)}:this.impl.onaddstream=function(e){return t.onAddStream(e)},this.impl.onicecandidate=function(e){t.onICECandidate(e.candidate)},this.rtpSenders=[],this.renegotiationInProgress=!1,this.impl.onnegotiationneeded=function(e){return t.onRenegotiation()},this.impl.onsignalingstatechange=function(e){return t.onSignalingStateChange()},this.impl.oniceconnectionstatechange=function(e){return t.onConnectionChange()},this.impl.onconnectionstatechange=function(e){t._call&&t._call.dispatchEvent({name:"SDP",origin:"onconnectionstatechange",description:t.impl.connectionState})},this.impl.onicegatheringstatechange=function(e){t._call&&t._call.dispatchEvent({name:"SDP",origin:"onicegatheringstatechange",description:t.impl.iceGatheringState})},this.iceRole=P.controlling,this._remoteStreams=[],this.banReinviteAnswer=!1,this._call=h.CallManager.get().calls[this.id],void 0!==this._call?this.onHold=!this._call.active():this.onHold=!1,this.rtcCollectingCycle=setInterval(function(){t.getPCStats()},h.CallManager.get().rtcStatsInquiryInterval),void 0!==this._call){var i=this._call.headers()[S.Constants.CALLSTATSIOID_HEADER];void 0===i&&(i=this._call.id()),_.CallstatsIo.get().addNewFabric(this.impl,this._call.number(),this.videoEnabled?_.CallstatsIoFabricUsage.multiplex:_.CallstatsIoFabricUsage.audio,i)}this.needTransportRestart=!1,"_default"!==this.id&&h.CallManager.get().calls[this.id]&&(this.reInviteQ=new b.ReInviteQ(h.CallManager.get().calls[this.id],this._canReInvite))}},{key:"onSignalingStateChange",value:function(){this._call&&this._call.dispatchEvent({name:"SDP",origin:"onsignalingstatechange",description:this.impl.signalingState}),this.logger.info("Signal state changed to "+this.impl.signalingState+" for PC: "+this.id),"stable"===this.impl.signalingState&&this.reInviteQ&&this.reInviteQ.runNext()}},{key:"getPCStats",value:function(){var e=this;d.default.getRTCStats(this.impl).then(function(t){return h.CallManager.get().callStats.sendStatistics(e._call,t)})}},{key:"onConnectionChange",value:function(){this._call&&this._call.dispatchEvent({name:"SDP",origin:"oniceconnectionstatechange",description:this.impl.iceConnectionState}),"completed"===this.impl.iceConnectionState&&void 0!==this._call&&(this._call.dispatchEvent({name:"ICECompleted",call:this._call}),clearTimeout(this.iceTimer)),"completed"!==this.impl.iceConnectionState&&"connected"!==this.impl.iceConnectionState||(this.iceTimer&&clearTimeout(this.iceTimer),this.iceTimer=null,this.reInviteQ&&this.reInviteQ.runNext()),T.CallStatsAnalyzer.get().checkICEConnection(this._call,this.impl.iceConnectionState)}},{key:"onRenegotiation",value:function(){if(this._call&&this._call.dispatchEvent({name:"SDP",origin:"negotiationneeded",description:"negotiationneeded"}),void 0!==this.impl){if("disconnected"===this.impl.connectionState||"failed"===this.impl.connectionState)return void this.logger.info("Renegotiation requested on closed PeerConnection");if(null===this.impl.localDescription)return void this.logger.info("Renegotiation needed, but no local SD. Skipping");if("connected"!==this.impl.iceConnectionState&&"completed"!==this.impl.iceConnectionState)return this.logger.info("Renegotiation requested while ice state is "+this.impl.iceConnectionState+". Postponing"),void setTimeout(this.onRenegotiation,100);if(this.renegotiationInProgress)return void this.logger.info("Renegotiation in progress. Queueing");this.logger.info("Renegotiation started"),this._runReinvite()}}},{key:"getReceiveOptions",value:function(){return{offerToReceiveAudio:!this.onHold,offerToReceiveVideo:this.videoEnabled.receiveVideo&&!this.onHold}}},{key:"onICECandidate",value:function(e){e&&null!==e&&""!==e.candidate?this.sendLocalCandidateToPeer("a="+e.candidate,e.sdpMLineIndex):this.logger.info("End of candidates")}},{key:"onAddTrack",value:function(e){this._call&&R.EndpointManager.get().addTrack(this._call,e.track)}},{key:"onAddStream",value:function(e){this._call&&R.EndpointManager.get().addStream(this._call,e.stream)}},{key:"_fixTransreceiver",value:function(){this.impl&&this.impl.getTransceivers&&this.impl.getTransceivers().forEach(function(e){"inactive"===e.currentDirection&&e.receiver.track&&!e.sender.track&&e.receiver.track.onended&&(e.receiver.track.stop(),e.receiver.track.onended(null))})}},{key:"_runReinvite",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!1===this.renegotiationInProgress){this.renegotiationInProgress=!0;var n={};this._call.settings.isConference||this.impl.getTransceivers&&"firefox"===d.default.getWSVendor()||(n=this.getReceiveOptions()),t&&(n.iceRestart=!0),this.logger.trace(JSON.stringify(n)),this.updateHoldState(),this.impl.createOffer(n).then(function(t){return e.logger.info("_runReinvite(), created local SDP: \n"+t.sdp),e.codecRearrange(t)}).then(function(t){var n={type:t.type,sdp:t.sdp};return n=f.PCFactory.get().addBandwidthParams(n),n=E.SDPMuggle.removeTelephoneEvents(n),n=E.SDPMuggle.removeDoubleOpus(n),n=E.SDPMuggle.removeDoublePT(n),n=E.SDPMuggle.fixVideoRecieve(n,e.videoEnabled.receiveVideo),e._call&&e._call.settings.isConference&&(n=e._reduceCodecs(n)),n}).then(function(t){return e.srcLocalSDP=t.sdp,e.pendingOffer=t,t}).then(function(){var t={tracks:e.getTrackKind(e.pendingOffer.sdp)};p.VoxSignaling.get().callRemoteFunction(m.RemoteFunction.reInvite,e._call.id(),{},e.pendingOffer.sdp,t)}).catch(function(t){e._call&&e._call.dispatchEvent({name:"SDP",origin:"_runReinvite",sdp:e.impl.localDescription,description:"offer_reject: Error when renegotiation start "+t.message}),e.logger.error("Error when renegotiation start "+t.message)})}else this.logger.error("Another renegotiation in progress")}},{key:"getMediaActivity",value:function(e){return e.map(function(e){return e.getTracks().map(function(e){return{id:e.id,kind:e.kind,mutted:e.muted,active:e.enabled,label:e.label}})})}},{key:"codecRearrange",value:function(e){var t=this;return new Promise(function(n,r){var i=h.CallManager.get().calls[t.id];if(void 0!==i){var o=new y.CodecSorter(e.sdp),a=o.getUserCodecList();void 0!==i.rearangeCodecs?i.rearangeCodecs(a,i.settings.incoming).then(function(t){o.setUserCodecList(t),n({type:e.type,sdp:o.getSDP()})},function(e){t.logger.error(JSON.stringify(e)),t._call&&t._call.dispatchEvent({name:"SDP",origin:"codecRearrange",sdp:t.impl.localDescription,description:"reject: "+e.message}),r(e)}):(o.setUserCodecList(a),t.logger.info("No sdp codecs transformer registered"),n({type:e.type,sdp:o.getSDP()}))}else n(e)})}},{key:"__replaceTrack",value:function(e,t){return new Promise(function(n,r){var i=e.sender.track;e.sender.replaceTrack(t).then(function(){!i||t&&i.id===t.id||(i.onended=null,i.onmute=null,i.stop()),n()}).catch(r)})}},{key:"_reduceCodecs",value:function(e){var t={packetization:"packetization-mode=1",profile:"42e01f"},n=k.default.parse(e.sdp);return n.media.forEach(function(e,r){if(!e.attr.find(function(e){return"inactive"===e.name})){var i=[],o=[],a=[],s=[];if(e.attr.forEach(function(e){return"rtpmap"===e.name?a.push(e):"ssrc"===e.name?o.push(e):void i.push(e)}),"audio"===e.descr.media)a.forEach(function(e){var t=e.value.find(function(e){return!!~e.value.indexOf("opus")}),n=e.value.find(function(e){return!!~e.value.indexOf("telephone-event/8000")});(t||n)&&s.push(e)});else if("video"===e.descr.media){var c=a.filter(function(e){return e.value.find(function(e){return!!~e.value.indexOf("rtx")})}),l=function(e,t){var n=e.value.find(function(e){return"rtpmap"===e.name}).value.split(" ")[0];return t.find(function(e){return e.value.find(function(e){return!!~e.value.indexOf("apt="+n)})})};a.forEach(function(e){var n=e.value.find(function(e){return!!~e.value.indexOf("red")}),r=e.value.find(function(e){return!!~e.value.indexOf("ulpfec")}),i=e.value.find(function(e){return!!~e.value.indexOf("H264")&&!!~e.value.indexOf(t.packetization)&&!!~e.value.indexOf(t.profile)}),o=e.value.find(function(e){return!!~e.value.indexOf("VP8")&&!s.find(function(e){return!!~e.value.indexOf("VP8")})});if((i||o||n||r)&&(s.push(e),c.length)){var a=l(e,c);a&&s.push(a)}})}n.media[r].attr=[].concat(i,s,o),n.media[r].descr.fmtCount=s.length,n.media[r].descr.fmt=s.map(function(e){return e.value[0].value.split(" ")[0]}),n.media[r].attrCount=n.media[r].attr.length}}),{type:e.type,sdp:n.toString()}}}]),t}(u.PeerConnection);c([g.LogManager.d_trace(g.LogCategory.RTC)],w.prototype,"_getLocalOfferRegular",null),c([g.LogManager.d_trace(g.LogCategory.RTC)],w.prototype,"updateHoldState",null),c([g.LogManager.d_trace(g.LogCategory.RTC)],w.prototype,"_processRemoteAnswer",null),c([g.LogManager.d_trace(g.LogCategory.RTC)],w.prototype,"_getLocalOffer",null),c([g.LogManager.d_trace(g.LogCategory.RTC)],w.prototype,"_getLocalOfferFF",null),c([g.LogManager.d_trace(g.LogCategory.RTC)],w.prototype,"_getLocalAnswer",null),c([g.LogManager.d_trace(g.LogCategory.RTC)],w.prototype,"_setRemoteDescription",null),c([g.LogManager.d_trace(g.LogCategory.RTC)],w.prototype,"_handleReinvite",null),c([g.LogManager.d_trace(g.LogCategory.RTC)],w.prototype,"_close",null),c([g.LogManager.d_trace(g.LogCategory.RTC)],w.prototype,"_addRemoteCandidate",null),c([g.LogManager.d_trace(g.LogCategory.RTC)],w.prototype,"setConfiguration",null),c([g.LogManager.d_trace(g.LogCategory.RTC)],w.prototype,"_sendDTMF",null),c([g.LogManager.d_trace(g.LogCategory.RTC)],w.prototype,"_hdnFRSPrep",null),c([g.LogManager.d_trace(g.LogCategory.RTC)],w.prototype,"_hdnFRS",null),c([g.LogManager.d_trace(g.LogCategory.RTC)],w.prototype,"hasLocalAudio",null),c([g.LogManager.d_trace(g.LogCategory.RTC)],w.prototype,"hasLocalVideo",null),c([g.LogManager.d_trace(g.LogCategory.RTC)],w.prototype,"enableVideo",null),c([g.LogManager.d_trace(g.LogCategory.RTC)],w.prototype,"_replaceVideoTrack",null),c([g.LogManager.d_trace(g.LogCategory.RTC)],w.prototype,"_addCustomMedia",null),c([g.LogManager.d_trace(g.LogCategory.RTC)],w.prototype,"_removeCustomMedia",null),c([g.LogManager.d_trace(g.LogCategory.RTC)],w.prototype,"_updateCustomMedia",null),c([g.LogManager.d_trace(g.LogCategory.RTC)],w.prototype,"_fixFFSoundBug",null),c([g.LogManager.d_trace(g.LogCategory.RTC)],w.prototype,"getConfiguration",null),c([g.LogManager.d_trace(g.LogCategory.RTC)],w.prototype,"_hold",null),c([g.LogManager.d_trace(g.LogCategory.RTC)],w.prototype,"_getStreamActivity",null),c([g.LogManager.d_trace(g.LogCategory.RTC)],w.prototype,"_createImpl",null),c([g.LogManager.d_trace(g.LogCategory.RTC)],w.prototype,"onSignalingStateChange",null),c([g.LogManager.d_trace(g.LogCategory.RTC)],w.prototype,"getPCStats",null),c([g.LogManager.d_trace(g.LogCategory.RTC)],w.prototype,"onConnectionChange",null),c([g.LogManager.d_trace(g.LogCategory.RTC)],w.prototype,"onRenegotiation",null),c([g.LogManager.d_trace(g.LogCategory.RTC)],w.prototype,"getReceiveOptions",null),c([g.LogManager.d_trace(g.LogCategory.RTC)],w.prototype,"onICECandidate",null),c([g.LogManager.d_trace(g.LogCategory.RTC)],w.prototype,"onAddTrack",null),c([g.LogManager.d_trace(g.LogCategory.RTC)],w.prototype,"onAddStream",null),c([g.LogManager.d_trace(g.LogCategory.RTC)],w.prototype,"getMediaActivity",null),c([g.LogManager.d_trace(g.LogCategory.RTC)],w.prototype,"codecRearrange",null),c([g.LogManager.d_trace(g.LogCategory.RTC)],w.prototype,"_reduceCodecs",null),t.TransreceiverPC=w},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(35);t.AudioDeviceManager=r.AudioDeviceManager;var i=n(36);t.CameraManager=i.CameraManager;var o=n(22);t.StreamManager=o.StreamManager;var a=n(56);t.IOSCacheManager=a.IOSCacheManager},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),a=n(22),s=function(){function e(){if(r(this,e),this._cachedChecksum=0,this._lastCameraParams={},this._lastAudioParams={},void 0!==e.instance)throw new Error("Error - use StreamManager.get()")}return i(e,[{key:"getStream",value:function(e){var t=this;return new Promise(function(n,r){if(t._localMedia&&t._localMedia.active&&t._cachedChecksum===t.getChecksumm(e))return void n(t._localMedia);a.StreamManager.getUserMedia(e).then(function(r){o.LogManager.get().writeMessage(o.LogCategory.USERMEDIA,"IOSCacheManager",o.LogLevel.INFO,"Media access granted"),t._cachedChecksum=t.getChecksumm(e),t._localMedia=r,n(r)}).catch(function(e){o.LogManager.get().writeMessage(o.LogCategory.USERMEDIA,"IOSCacheManager",o.LogLevel.ERROR,"Media access denied: "+(e?e.message||e.name||e:"unknown")),r(e)})})}},{key:"getChecksumm",value:function(e){var t=0;return e.audio&&t++,e.video&&t++,t}},{key:"updateChecksumm",value:function(e){this._cachedChecksum=this.getChecksumm(e)}},{key:"clear",value:function(e){for(var t in this._callRendererList[e.id()])this._callRendererList[e.id()].hasOwnProperty(t)&&delete this._callRendererList[e.id()][t];delete this._callRendererList[e.id()]}},{key:"registerMediaRenderer",value:function(e,t){}},{key:"diffCameraParams",value:function(e){return this.fastDiffObjects(this._lastCameraParams,e)}},{key:"diffAudioParams",value:function(e){return this.fastDiffObjects(this._lastAudioParams,e)}},{key:"fastDiffObjects",value:function(e,t){return Object.keys(e).length===Object.keys(t).length&&Object.keys(e).every(function(n){return e[n]===t[n]})}}],[{key:"get",value:function(){return void 0===e.instance&&(e.instance=new e),e.instance}}]),e}();t.IOSCacheManager=s},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":s(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var l=n(38),u=n(0),d=n(24),f=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return o(t,e),a(t,[{key:"getEndpointByTrack",value:function(e,t){var n=this.getRtrackId(e,t.id);return this._getEndpointByTrackId(e,n)}},{key:"getRtrackId",value:function(e,t){if(void 0===e.peerConnection)return"";for(var n=e.peerConnection.getTransceivers(),r=0;r<n.length;r++)if(null!==n[r].mid&&n[r].receiver.track.id===t){var i=d.SDPMuggle.findTrackByMid(e.peerConnection.getRemoteDescription(),n[r].mid);if(i)return i}}},{key:"getMediaTypeTrack",value:function(e,t){var n=this.getRtrackId(e,t.id);return this._getMediaTypeTrack(e,{id:n,kind:t.kind})}},{key:"_traceName",value:function(){return"TransceiversEndpointManager"}}]),t}(l.AbstractEndpointManager);c([u.LogManager.d_trace(u.LogCategory.ENDPOINT)],f.prototype,"getEndpointByTrack",null),c([u.LogManager.d_trace(u.LogCategory.ENDPOINT)],f.prototype,"getMediaTypeTrack",null),t.TransceiversEndpointManager=f},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var s=n(38),c=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),a(t,[{key:"_traceName",value:function(){return"PlainEndpointManager"}},{key:"getEndpointByTrack",value:function(e,t){return this._getEndpointByTrackId(e,t.id)}},{key:"getMediaTypeTrack",value:function(e,t){return this._getMediaTypeTrack(e,t)}}]),t}(s.AbstractEndpointManager);t.PlainEndpointManager=c},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(r)},c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":c(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a};Object.defineProperty(t,"__esModule",{value:!0});var u=n(12),d=n(2),f=n(6),g=n(0),p=n(3),v=function(e){function t(e,n,o,a){r(this,t);var s=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,o,a));return s.settings.mode=u.CallMode.SERVER,s}return o(t,e),a(t,[{key:"answer",value:function(e,n){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"answer",this).call(this,e,n);var r={tracks:this.peerConnection.getTrackKind("")};d.VoxSignaling.get().callRemoteFunction(p.RemoteFunction.acceptCall,this.settings.id,f.CallManager.cleanHeaders(n),r)}},{key:"_traceName",value:function(){return"CallExServer"}}]),t}(u.Call);l([g.LogManager.d_trace(g.LogCategory.CALLEXSERVER)],v.prototype,"answer",null),t.CallExServer=v},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(e,t,n,r){var i,a=arguments.length,s=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":o(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(a<3?i(s):a>3?i(t,n,s):i(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),c=function(){function e(){r(this,e)}return i(e,[{key:"_traceName",value:function(){return"CodecSorterHelpers"}}],[{key:"H264Sorter",value:function(e,t){return t?new Promise(function(t){for(var n=0;n<e.sections.length;n++)if("video"==e.sections[n].kind.toLowerCase()){var r=e.sections[n].codec.filter(function(e){var t=e.value.findIndex(function(e){return"rtpmap"===e.name});return-1!=e.value[t].value.toLowerCase().indexOf("h264")&&-1==e.value[t].value.toLowerCase().indexOf("uc")});r.length&&(e.sections[n].codec=r)}t(e)}):new Promise(function(t){for(var n=0;n<e.sections.length;n++)"video"==e.sections[n].kind.toLowerCase()&&e.sections[n].codec.sort(function(e,t){var n=e.value.findIndex(function(e){return"rtpmap"===e.name}),r=t.value.findIndex(function(e){return"rtpmap"===e.name});return-1!=e.value[n].value.toLowerCase().indexOf("h264")&&-1==e.value[n].value.toLowerCase().indexOf("uc")?-1:-1!=t.value[r].value.toLowerCase().indexOf("h264")&&-1==t.value[r].value.toLowerCase().indexOf("uc")?1:0});t(e)})}},{key:"H264ConfSorter",value:function(e,t){return t?new Promise(function(t){for(var n=0;n<e.sections.length;n++)if("video"==e.sections[n].kind.toLowerCase()){var r=e.sections[n].codec.filter(function(e){var t=e.value.findIndex(function(e){return"rtpmap"===e.name});return-1!=e.value[t].value.toLowerCase().indexOf("h264")&&-1==e.value[t].value.toLowerCase().indexOf("uc")});r.length&&(e.sections[n].codec=r)}t(e)}):new Promise(function(t){for(var n=0;n<e.sections.length;n++)"video"==e.sections[n].kind.toLowerCase()&&(e.sections[n].codec.sort(function(e,t){var n=e.value.findIndex(function(e){return"rtpmap"===e.name}),r=t.value.findIndex(function(e){return"rtpmap"===e.name});return-1!=e.value[n].value.toLowerCase().indexOf("h264")&&-1==e.value[n].value.toLowerCase().indexOf("uc")?-1:-1!=t.value[r].value.toLowerCase().indexOf("h264")&&-1==t.value[r].value.toLowerCase().indexOf("uc")?1:0}),e.sections[n].codec.sort(function(e,t){var n=(e.value.findIndex(function(e){return"rtpmap"===e.name}),t.value.findIndex(function(e){return"rtpmap"===e.name}),e.value.findIndex(function(e){return"fmtp"===e.name})),r=t.value.findIndex(function(e){return"fmtp"===e.name});return e.value[n]&&t.value[r]?-1!==e.value[n].value.toLowerCase().indexOf("profile-level-id=42e01f")&&-1!==e.value[n].value.toLowerCase().indexOf("packetization-mode=1")?-1:-1!==t.value[r].value.toLowerCase().indexOf("profile-level-id=42e01f")&&-1!==e.value[n].value.toLowerCase().indexOf("packetization-mode=1")?1:0:0}));t(e)})}}]),e}();a([s.LogManager.d_trace(s.LogCategory.RTC)],c,"H264Sorter",null),a([s.LogManager.d_trace(s.LogCategory.RTC)],c,"H264ConfSorter",null),t.CodecSorterHelpers=c},function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===("undefined"==typeof Reflect?"undefined":a(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s};Object.defineProperty(t,"__esModule",{value:!0});var c=n(5),l=n(6),u=n(0),d=n(41),f=function(){function e(){i(this,e),this._calls=new WeakMap}return o(e,[{key:"addCall",value:function(e){e&&"object"===(void 0===e?"undefined":a(e))&&(this._calls.set(e,{}),d.CallStatsAnalyzer.get().addCall(e))}},{key:"deleteCall",value:function(e){return e&&"object"===(void 0===e?"undefined":a(e))&&this._calls.has(e)&&(this._calls.get(e).nextDeliveryTimer&&clearTimeout(this._calls.get(e).nextDeliveryTimer),this._calls.delete(e)),d.CallStatsAnalyzer.get().deleteCall(e),Promise.resolve(!0)}},{key:"sendStatistics",value:function(e,t){var n=this;if(e&&"object"===(void 0===e?"undefined":a(e))){this._calls.has(e)||this.addCall(e);var i=this._calls.get(e);if(!i.nextDeliveryTimer){var o=t.formatted.filter(function(e){return"inbound-rtp"===e.type}),s=t.formatted.filter(function(e){return"track"===e.type&&o.some(function(t){return t.trackId===e.id})}),u={jitterBuffer:s.reduce(function(e,t){return Object.assign(e,r({},t.id,{delay:t.jitterBufferDelay,emittedCount:t.jitterBufferEmittedCount}))},{})},f=window.setTimeout(function(){return n._calls.set(e,{prevStats:u})},l.CallManager.get().rtcStatsCollectionInterval);e.dispatchEvent({name:c.CallEvents.RTCStatsReceived,stats:t.raw}),e.dispatchEvent({name:c.CallEvents.CallStatsReceived,stats:this.getCallStats(e,t.formatted,i.prevStats)}),this._calls.set(e,{nextDeliveryTimer:f})}d.CallStatsAnalyzer.get().analyzeCallStats(e,t.formatted)}}},{key:"getCallStats",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=n.find(function(e){return"candidate-pair"===e.type&&(e.selected||e.nominated&&"succeeded"===e.state)}),a=o&&n.find(function(e){return"local-candidate"===e.type&&e.id===o.localCandidateId}),s=o?o.timestamp:n[0]&&n[0].timestamp,c=n.filter(function(e){return"track"===e.type}),l=n.filter(function(e){return"codec"===e.type}),u=n.filter(function(e){return"inbound-rtp"===e.type}),d=u.filter(function(e){return"audio"===e.mediaType}),f=u.filter(function(e){return"video"===e.mediaType}),g=n.filter(function(e){return"outbound-rtp"===e.type}),p=g.filter(function(e){return"audio"===e.mediaType}),v=g.filter(function(e){return"video"===e.mediaType}),h=e.getEndpoints(),m=function(e){var n=e.reduce(function(e,n){var r=c.find(function(e){return e.kind===n.kind&&e.trackIdentifier===n.id})||{},o=r&&u.find(function(e){return e.trackId===r.id})||{},a=i.jitterBuffer&&i.jitterBuffer[r.id]&&i.jitterBuffer[r.id].delay?i.jitterBuffer[r.id].delay:0,d=i.jitterBuffer&&i.jitterBuffer[r.id]&&i.jitterBuffer[r.id].emittedCount?i.jitterBuffer[r.id].emittedCount:0,f={bytesReceived:(o.bytesReceived||0)+(e.bytesReceived||0),packetsReceived:(o.packetsReceived||0)+(e.packetsReceived||0),packetsLost:(o.packetsLost||0)+(e.packetsLost||0),loss:t.getLoss(o),jitterBufferMs:void 0!==r.jitterBufferDelay&&void 0!==r.jitterBufferEmittedCount?r.jitterBufferEmittedCount-d?1e3*(r.jitterBufferDelay-a)/(r.jitterBufferEmittedCount-d)+(e.jitterBufferMs||0):0:void 0,codec:(o&&o.codecId&&l.find(function(e){return e.id===o.codecId})||{mimeType:void 0}).mimeType,timestamp:s};return"video"===n.kind?Object.assign(f,{frameHeight:r&&r.frameHeight,frameWidth:r&&r.frameWidth,framesDecoded:r&&r.framesDecoded||o.framesDecoded,framesDropped:r&&r.framesDropped,framesReceived:r&&r.framesReceived}):f},{});return e.length>1&&n.jitterBufferMs&&(n.jitterBufferMs=n.jitterBufferMs/e.length),n};return{availableOutgoingBitrate:o&&o.availableOutgoingBitrate,localCandidateType:a&&a.candidateType,networkType:a&&a.networkType,remoteCandidateType:o&&(n.find(function(e){return"remote-candidate"===e.type&&e.id===o.remoteCandidateId})||{}).candidateType,rtt:o&&o.currentRoundTripTime,timestamp:s,totalBytesReceived:this.sumByProp(u,"bytesReceived"),totalBytesSent:this.sumByProp(g,"bytesSent"),totalLoss:this.getLoss(u),totalPacketsLost:this.sumByProp(u,"packetsLost"),totalPacketsReceived:this.sumByProp(u,"packetsReceived"),totalPacketsSent:this.sumByProp(g,"packetsSent"),audioBytesReceived:this.sumByProp(d,"bytesReceived"),audioBytesSent:this.sumByProp(p,"bytesSent"),audioLoss:this.getLoss(d),audioPacketsLost:this.sumByProp(d,"packetsLost"),audioPacketsReceived:this.sumByProp(d,"packetsReceived"),audioPacketsSent:this.sumByProp(p,"packetsSent"),videoBytesReceived:this.sumByProp(f,"bytesReceived"),videoBytesSent:this.sumByProp(v,"bytesSent"),videoLoss:this.getLoss(f),videoPacketsLost:this.sumByProp(f,"packetsLost"),videoPacketsReceived:this.sumByProp(f,"packetsReceived"),videoPacketsSent:this.sumByProp(v,"packetsSent"),localAudioStats:p.length?p.reduce(function(e,t){return e.set(t.id,{bytesSent:t.bytesSent,packetsSent:t.packetsSent,timestamp:t.timestamp,retransmittedBytesSent:t.retransmittedBytesSent,retransmittedPacketsSent:t.retransmittedPacketsSent,audioLevel:(c.find(function(e){return e.id===t.trackId})||{audioLevel:void 0}).audioLevel,codec:(l.find(function(e){return e.id===t.codecId})||{mimeType:void 0}).mimeType})},new Map):new Map,localVideoStats:v.length?v.reduce(function(e,t){return e.set(t.id,{bytesSent:t.bytesSent,packetsSent:t.packetsSent,timestamp:t.timestamp,frameHeight:(c.find(function(e){return e.id===t.trackId})||{frameHeight:void 0}).frameHeight,frameWidth:(c.find(function(e){return e.id===t.trackId})||{frameWidth:void 0}).frameWidth,encoderBitrate:t.encoderBitrate||t.bitrateMean,targetBitrate:t.totalEncodedBytesTarget||t.targetBitrate,fps:t.framesPerSecond||t.framerateMean,pli:t.pliCount,fir:t.firCount,nack:t.nackCount,qualityLimitationReason:t.qualityLimitationReason||"unknown",qualityLimitationResolutionChanges:t.qualityLimitationResolutionChanges||"0",codec:(l.find(function(e){return e.id===t.codecId})||{mimeType:void 0}).mimeType})},new Map):new Map,endpointStats:h.length?h.reduce(function(e,n){var i=n.mediaRenderers.reduce(function(e,t){return t.stream&&t.stream.getTracks().filter(function(e){return"audio"===e.kind}).length?Object.assign(e,r({},t.stream.id,m(t.stream.getTracks().filter(function(e){return"audio"===e.kind})))):e},{}),o=n.mediaRenderers.reduce(function(e,t){return t.stream&&t.stream.getTracks().filter(function(e){return"video"===e.kind}).length?Object.assign(e,r({},t.stream.id,m(t.stream.getTracks().filter(function(e){return"video"===e.kind})))):e},{}),a=Object.values(i).concat(Object.values(o));return e.set(n.id,{audioBytesReceived:t.sumByProp(Object.values(i),"bytesReceived"),audioPacketsLost:t.sumByProp(Object.values(i),"packetsLost"),audioPacketsReceived:t.sumByProp(Object.values(i),"packetsReceived"),videoBytesReceived:t.sumByProp(Object.values(o),"bytesReceived"),videoPacketsLost:t.sumByProp(Object.values(o),"packetsLost"),videoPacketsReceived:t.sumByProp(Object.values(o),"packetsReceived"),totalBytesReceived:t.sumByProp(a,"bytesReceived"),totalPacketsReceived:t.sumByProp(a,"packetsReceived"),remoteAudioStats:i,remoteVideoStats:o,timestamp:s})},new Map):new Map}}},{key:"getLoss",value:function(e){if(!e.length)return 0;var t=e.reduce(function(e,t){return{lost:e.lost+(t.packetsLost||0),total:e.total+(t.packetsLost||0)+(t.packetsReceived||0)}},{lost:0,total:0});return t.total?t.lost/t.total:0}},{key:"sumByProp",value:function(e,t){return e.length?e.map(function(e){return e[t]}).reduce(function(e){return e+(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0)},0):0}},{key:"_traceName",value:function(){return"CallStatsManager"}},{key:"calls",get:function(){return this._calls}}],[{key:"get",value:function(){return void 0===this.inst&&(this.inst=new e),this.inst}}]),e}();s([u.LogManager.d_trace(u.LogCategory.RTC)],f.prototype,"addCall",null),s([u.LogManager.d_trace(u.LogCategory.RTC)],f.prototype,"deleteCall",null),t.CallStatsManager=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});!function(e){e[e.Firefox=0]="Firefox",e[e.Chrome=1]="Chrome"}(t.BrowserMode||(t.BrowserMode={}));!function(e){e[e.audio="audio"]="audio",e[e.video="video"]="video",e[e.sharing="sharing"]="sharing"}(t.TrackType||(t.TrackType={}));!function(e){e[e.ALREADY_IN_THIS_STATE=0]="ALREADY_IN_THIS_STATE",e[e.FUNCTIONALITY_IS_DISABLED=1]="FUNCTIONALITY_IS_DISABLED",e[e.INCORRECT_OPERATION=2]="INCORRECT_OPERATION",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e[e.MEDIA_IS_ON_HOLD=4]="MEDIA_IS_ON_HOLD",e[e.REJECTED=5]="REJECTED",e[e.TIMEOUT=6]="TIMEOUT"}(t.CallError||(t.CallError={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});!function(e){!function(e){e[e.Critical="CRITICAL"]="Critical",e[e.Major="MAJOR"]="Major",e[e.Minor="MINOR"]="Minor",e[e.None="NONE"]="None"}(e.QualityIssueLevel||(e.QualityIssueLevel={}))}(t.Statistic||(t.Statistic={}))},function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var a=n(32),s=function(){function e(t){i(this,e),this.originalSDP=t}return o(e,[{key:"getUserCodecList",value:function(){void 0===this.originalCodecList&&(this.originalCodecList=a.default.parse(this.originalSDP));var e={sections:[]};return e.sections=this.originalCodecList.media.filter(function(e){return"video"===e.descr.media||"audio"===e.descr.media}).map(function(e,t,n){var r=/(rtx|red|ulpfec)/,i=e.attr.filter(function(e){return"rtpmap"===e.name&&!e.value.find(function(e){return e.value.match(r)})});return{kind:e.descr.media,codec:i}}),e}},{key:"setUserCodecList",value:function(t){void 0===this.originalCodecList&&(this.originalCodecList=a.default.parse(this.originalSDP));for(var n=0;n<t.sections.length;n++)if(t.sections[n].kind===this.originalCodecList.media[n].descr.media){var r=e.resortSection(t.sections[n].codec,this.originalCodecList.media[n].attr,this.originalCodecList.media[n].descr.media);this.originalCodecList.media[n].attr=r.codecs,this.originalCodecList.media[n].descr.fmt=r.order,this.originalCodecList.media[n].descr.fmtCount=r.order.length}}},{key:"getSDP",value:function(){return this.originalCodecList.toString()}},{key:"_traceName",value:function(){return"CodecSorter"}}],[{key:"resortSection",value:function(e,t,n){var i=this,o=[],a=[],s=[],c=[];t.forEach(function(e){return"rtpmap"===e.name?s.push(e):"ssrc"===e.name?a.push(e):void o.push(e)});var l=e.map(function(e){var t=e.value.find(function(e){return"rtpmap"===e.name}).value,n=s.find(function(e){return e.value.find(function(e){return!!~e.value.indexOf(t)})});if(n)return c.push(t.split(" ")[0]),n}).filter(Boolean);if("video"===n.toLowerCase()){var u=[],d=[],f=s.filter(function(e){return e.value.find(function(e){return!!~e.value.indexOf("rtx")})}),g=s.filter(function(e){return e.value.find(function(e){return e.value.match(/(red|ulpfec)/)})});return l=l.concat(g),l.forEach(function(e){u.push(e),d.push(e.value.find(function(e){return"rtpmap"===e.name}).value.split(" ")[0]);var t=i.matchRtx(e,f);t&&(u.push(t),d.push(t.value.find(function(e){return"rtpmap"===e.name}).value.split(" ")[0]))}),{codecs:[].concat(o,u,a),order:d}}return{codecs:[].concat(o,r(l),a),order:c}}},{key:"matchRtx",value:function(e,t){var n=e.value.find(function(e){return"rtpmap"===e.name}).value.split(" ")[0];return t.find(function(e){return e.value.find(function(e){return!!~e.value.indexOf("apt="+n)})})}}]),e}();t.CodecSorter=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._state=new Int32Array(4),this._buffer=new ArrayBuffer(68),this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}return e.hashStr=function(e,t){return void 0===t&&(t=!1),this.onePassHasher.start().appendStr(e).end(t)},e.hashAsciiStr=function(e,t){return void 0===t&&(t=!1),this.onePassHasher.start().appendAsciiStr(e).end(t)},e._hex=function(t){var n,r,i,o,a=e.hexChars,s=e.hexOut;for(o=0;o<4;o+=1)for(r=8*o,n=t[o],i=0;i<8;i+=2)s[r+1+i]=a.charAt(15&n),n>>>=4,s[r+0+i]=a.charAt(15&n),n>>>=4;return s.join("")},e._md5cycle=function(e,t){var n=e[0],r=e[1],i=e[2],o=e[3];n+=(r&i|~r&o)+t[0]-680876936|0,n=(n<<7|n>>>25)+r|0,o+=(n&r|~n&i)+t[1]-389564586|0,o=(o<<12|o>>>20)+n|0,i+=(o&n|~o&r)+t[2]+606105819|0,i=(i<<17|i>>>15)+o|0,r+=(i&o|~i&n)+t[3]-1044525330|0,r=(r<<22|r>>>10)+i|0,n+=(r&i|~r&o)+t[4]-176418897|0,n=(n<<7|n>>>25)+r|0,o+=(n&r|~n&i)+t[5]+1200080426|0,o=(o<<12|o>>>20)+n|0,i+=(o&n|~o&r)+t[6]-1473231341|0,i=(i<<17|i>>>15)+o|0,r+=(i&o|~i&n)+t[7]-45705983|0,r=(r<<22|r>>>10)+i|0,n+=(r&i|~r&o)+t[8]+1770035416|0,n=(n<<7|n>>>25)+r|0,o+=(n&r|~n&i)+t[9]-1958414417|0,o=(o<<12|o>>>20)+n|0,i+=(o&n|~o&r)+t[10]-42063|0,i=(i<<17|i>>>15)+o|0,r+=(i&o|~i&n)+t[11]-1990404162|0,r=(r<<22|r>>>10)+i|0,n+=(r&i|~r&o)+t[12]+1804603682|0,n=(n<<7|n>>>25)+r|0,o+=(n&r|~n&i)+t[13]-40341101|0,o=(o<<12|o>>>20)+n|0,i+=(o&n|~o&r)+t[14]-1502002290|0,i=(i<<17|i>>>15)+o|0,r+=(i&o|~i&n)+t[15]+1236535329|0,r=(r<<22|r>>>10)+i|0,n+=(r&o|i&~o)+t[1]-165796510|0,n=(n<<5|n>>>27)+r|0,o+=(n&i|r&~i)+t[6]-1069501632|0,o=(o<<9|o>>>23)+n|0,i+=(o&r|n&~r)+t[11]+643717713|0,i=(i<<14|i>>>18)+o|0,r+=(i&n|o&~n)+t[0]-373897302|0,r=(r<<20|r>>>12)+i|0,n+=(r&o|i&~o)+t[5]-701558691|0,n=(n<<5|n>>>27)+r|0,o+=(n&i|r&~i)+t[10]+38016083|0,o=(o<<9|o>>>23)+n|0,i+=(o&r|n&~r)+t[15]-660478335|0,i=(i<<14|i>>>18)+o|0,r+=(i&n|o&~n)+t[4]-405537848|0,r=(r<<20|r>>>12)+i|0,n+=(r&o|i&~o)+t[9]+568446438|0,n=(n<<5|n>>>27)+r|0,o+=(n&i|r&~i)+t[14]-1019803690|0,o=(o<<9|o>>>23)+n|0,i+=(o&r|n&~r)+t[3]-187363961|0,i=(i<<14|i>>>18)+o|0,r+=(i&n|o&~n)+t[8]+1163531501|0,r=(r<<20|r>>>12)+i|0,n+=(r&o|i&~o)+t[13]-1444681467|0,n=(n<<5|n>>>27)+r|0,o+=(n&i|r&~i)+t[2]-51403784|0,o=(o<<9|o>>>23)+n|0,i+=(o&r|n&~r)+t[7]+1735328473|0,i=(i<<14|i>>>18)+o|0,r+=(i&n|o&~n)+t[12]-1926607734|0,r=(r<<20|r>>>12)+i|0,n+=(r^i^o)+t[5]-378558|0,n=(n<<4|n>>>28)+r|0,o+=(n^r^i)+t[8]-2022574463|0,o=(o<<11|o>>>21)+n|0,i+=(o^n^r)+t[11]+1839030562|0,i=(i<<16|i>>>16)+o|0,r+=(i^o^n)+t[14]-35309556|0,r=(r<<23|r>>>9)+i|0,n+=(r^i^o)+t[1]-1530992060|0,n=(n<<4|n>>>28)+r|0,o+=(n^r^i)+t[4]+1272893353|0,o=(o<<11|o>>>21)+n|0,i+=(o^n^r)+t[7]-155497632|0,i=(i<<16|i>>>16)+o|0,r+=(i^o^n)+t[10]-1094730640|0,r=(r<<23|r>>>9)+i|0,n+=(r^i^o)+t[13]+681279174|0,n=(n<<4|n>>>28)+r|0,o+=(n^r^i)+t[0]-358537222|0,o=(o<<11|o>>>21)+n|0,i+=(o^n^r)+t[3]-722521979|0,i=(i<<16|i>>>16)+o|0,r+=(i^o^n)+t[6]+76029189|0,r=(r<<23|r>>>9)+i|0,n+=(r^i^o)+t[9]-640364487|0,n=(n<<4|n>>>28)+r|0,o+=(n^r^i)+t[12]-421815835|0,o=(o<<11|o>>>21)+n|0,i+=(o^n^r)+t[15]+530742520|0,i=(i<<16|i>>>16)+o|0,r+=(i^o^n)+t[2]-995338651|0,r=(r<<23|r>>>9)+i|0,n+=(i^(r|~o))+t[0]-198630844|0,n=(n<<6|n>>>26)+r|0,o+=(r^(n|~i))+t[7]+1126891415|0,o=(o<<10|o>>>22)+n|0,i+=(n^(o|~r))+t[14]-1416354905|0,i=(i<<15|i>>>17)+o|0,r+=(o^(i|~n))+t[5]-57434055|0,r=(r<<21|r>>>11)+i|0,n+=(i^(r|~o))+t[12]+1700485571|0,n=(n<<6|n>>>26)+r|0,o+=(r^(n|~i))+t[3]-1894986606|0,o=(o<<10|o>>>22)+n|0,i+=(n^(o|~r))+t[10]-1051523|0,i=(i<<15|i>>>17)+o|0,r+=(o^(i|~n))+t[1]-2054922799|0,r=(r<<21|r>>>11)+i|0,n+=(i^(r|~o))+t[8]+1873313359|0,n=(n<<6|n>>>26)+r|0,o+=(r^(n|~i))+t[15]-30611744|0,o=(o<<10|o>>>22)+n|0,i+=(n^(o|~r))+t[6]-1560198380|0,i=(i<<15|i>>>17)+o|0,r+=(o^(i|~n))+t[13]+1309151649|0,r=(r<<21|r>>>11)+i|0,n+=(i^(r|~o))+t[4]-145523070|0,n=(n<<6|n>>>26)+r|0,o+=(r^(n|~i))+t[11]-1120210379|0,o=(o<<10|o>>>22)+n|0,i+=(n^(o|~r))+t[2]+718787259|0,i=(i<<15|i>>>17)+o|0,r+=(o^(i|~n))+t[9]-343485551|0,r=(r<<21|r>>>11)+i|0,e[0]=n+e[0]|0,e[1]=r+e[1]|0,e[2]=i+e[2]|0,e[3]=o+e[3]|0},e.prototype.start=function(){return this._dataLength=0,this._bufferLength=0,this._state.set(e.stateIdentity),this},e.prototype.appendStr=function(t){var n,r,i=this._buffer8,o=this._buffer32,a=this._bufferLength;for(r=0;r<t.length;r+=1){if((n=t.charCodeAt(r))<128)i[a++]=n;else if(n<2048)i[a++]=192+(n>>>6),i[a++]=63&n|128;else if(n<55296||n>56319)i[a++]=224+(n>>>12),i[a++]=n>>>6&63|128,i[a++]=63&n|128;else{if((n=1024*(n-55296)+(t.charCodeAt(++r)-56320)+65536)>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");i[a++]=240+(n>>>18),i[a++]=n>>>12&63|128,i[a++]=n>>>6&63|128,i[a++]=63&n|128}a>=64&&(this._dataLength+=64,e._md5cycle(this._state,o),a-=64,o[0]=o[16])}return this._bufferLength=a,this},e.prototype.appendAsciiStr=function(t){for(var n,r=this._buffer8,i=this._buffer32,o=this._bufferLength,a=0;;){for(n=Math.min(t.length-a,64-o);n--;)r[o++]=t.charCodeAt(a++);if(o<64)break;this._dataLength+=64,e._md5cycle(this._state,i),o=0}return this._bufferLength=o,this},e.prototype.appendByteArray=function(t){for(var n,r=this._buffer8,i=this._buffer32,o=this._bufferLength,a=0;;){for(n=Math.min(t.length-a,64-o);n--;)r[o++]=t[a++];if(o<64)break;this._dataLength+=64,e._md5cycle(this._state,i),o=0}return this._bufferLength=o,this},e.prototype.getState=function(){var e=this,t=e._state;return{buffer:String.fromCharCode.apply(null,e._buffer8),buflen:e._bufferLength,length:e._dataLength,state:[t[0],t[1],t[2],t[3]]}},e.prototype.setState=function(e){var t,n=e.buffer,r=e.state,i=this._state;for(this._dataLength=e.length,this._bufferLength=e.buflen,i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],t=0;t<n.length;t+=1)this._buffer8[t]=n.charCodeAt(t)},e.prototype.end=function(t){void 0===t&&(t=!1);var n,r=this._bufferLength,i=this._buffer8,o=this._buffer32,a=1+(r>>2);if(this._dataLength+=r,i[r]=128,i[r+1]=i[r+2]=i[r+3]=0,o.set(e.buffer32Identity.subarray(a),a),r>55&&(e._md5cycle(this._state,o),o.set(e.buffer32Identity)),(n=8*this._dataLength)<=4294967295)o[14]=n;else{var s=n.toString(16).match(/(.*?)(.{0,8})$/);if(null===s)return;var c=parseInt(s[2],16),l=parseInt(s[1],16)||0;o[14]=c,o[15]=l}return e._md5cycle(this._state,o),t?this._state:e._hex(this._state)},e.stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]),e.buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),e.hexChars="0123456789abcdef",e.hexOut=[],e.onePassHasher=new e,e}();t.Md5=r,"5d41402abc4b2a76b9719d911017c592"!==r.hashStr("hello")&&console.error("Md5 self test failed.")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});!function(e){e[e.NUMBER_IS_BUSY=486]="NUMBER_IS_BUSY",e[e.TERMINATED=487]="TERMINATED",e[e.INVALID_NUMBER=404]="INVALID_NUMBER",e[e.NUMBER_IS_UNAVAILABLE=480]="NUMBER_IS_UNAVAILABLE",e[e.REJECTED=603]="REJECTED",e[e.INSUFFICIENT_FUNDS=402]="INSUFFICIENT_FUNDS",e[e.ACCESS_DENIED=403]="ACCESS_DENIED",e[e.NOT_CONNECTED_TO_VOXIMPLANT=1003]="NOT_CONNECTED_TO_VOXIMPLANT",e[e.NOT_AUTHORIZED=1004]="NOT_AUTHORIZED"}(t.CallError||(t.CallError={}))},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(8),a=n(6),s=n(2),c=n(3),l=n(14),u=n(11),d=n(5),f=n(4),g=function(){function e(t){var n=this;r(this,e),this.client=t,this.currentCall=null,this.onConnectionFailed=null,this.onConnectionEstablished=null,this.onCheckComplete=null,this.onCallFailed=null,this.onCallConnected=null,this.onCallEnded=null,this.onCallRinging=null,this.onCallMediaStarted=null,this.onVoicemail=null,this.onNetStatsReceived=null,a.CallManager.get().protocolVersion,t.on(o.Events.ConnectionFailed,function(e){return n.runLegacyCallback(n.onConnectionFailed,e)}),t.on(o.Events.ConnectionEstablished,function(e){return n.runLegacyCallback(n.onConnectionEstablished,e)}),s.VoxSignaling.get().setRPCHandler(l.RemoteEvent.handlePreFlightCheckResult,function(e,t,r){return n.onCheckComplete(e,t,r)}),s.VoxSignaling.get().setRPCHandler(l.RemoteEvent.handleVoicemail,function(e){return n.runLegacyCallback(n.onVoicemail,e)})}return i(e,[{key:"connectTo",value:function(e,t,n,r){var i=s.VoxSignaling.get();u.Authenticator.get().ziAuthorized(!0),i.lagacyConnectTo(e,t,n,r)}},{key:"connect",value:function(){}},{key:"requestMedia",value:function(e,t,n,r){f.default.StreamManager.get().getCallStream(void 0).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})}},{key:"hangupCall",value:function(e,t){a.CallManager.get().calls[e].hangup(t),s.VoxSignaling.get().callRemoteFunction(c.RemoteFunction.disconnectCall,e,{})}},{key:"callTo",value:function(e,t,n,r){return this.currentCall=this.client.call({number:e,video:t,extraHeaders:n,extraParams:r}),this.bindCurrentCall(),this.currentCall.id()}},{key:"voicemailPromptFinished",value:function(e){s.VoxSignaling.get().callRemoteFunction(c.RemoteFunction.zPromptFinished,e)}},{key:"makeid",value:function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*n.length));return t}},{key:"muteMicrophone",value:function(e){var t=a.CallManager.get();for(var n in t.calls)t.calls.hasOwnProperty(n)&&(e?t.calls[n].muteMicrophone():t.calls[n].unmuteMicrophone())}},{key:"sendDigit",value:function(e,t){s.VoxSignaling.get().callRemoteFunction(c.RemoteFunction.sendDTMF,e,t)}},{key:"startPreFlightCheck",value:function(e,t){this.onCheckComplete&&this.onCheckComplete(!0,!0,!0)}},{key:"runLegacyCallback",value:function(e,t){void 0!==e&&null!==e&&e(t)}},{key:"bindCurrentCall",value:function(){var e=this;window.currentCall=this.currentCall,this.currentCall.on(d.CallEvents.Failed,function(t){e.runLegacyCallback(e.onCallFailed,t),e.unbindCurrentCall()}),this.currentCall.on(d.CallEvents.Connected,function(t){e.runLegacyCallback(e.onCallConnected,t),e.runLegacyCallback(e.onCallMediaStarted,t);a.CallManager.get();setTimeout(function(){var e=document.getElementById(window.currentCall.peerConnection.impl.getRemoteStreams()[0].getTracks()[0].id);e.srcObject=window.currentCall.peerConnection.impl.getRemoteStreams()[0],e.load(),e.play()},1e3)}),this.currentCall.on(d.CallEvents.Disconnected,function(t){e.runLegacyCallback(e.onCallEnded,t),e.unbindCurrentCall()}),this.client.on(o.Events.NetStatsReceived,function(t){return e.onNetStatsReceived(t)})}},{key:"unbindCurrentCall",value:function(){this.currentCall.off(d.CallEvents.Failed),this.currentCall.off(d.CallEvents.Connected),this.currentCall.off(d.CallEvents.Disconnected),this.currentCall.off(d.CallEvents.ProgressToneStart),this.currentCall.off(d.CallEvents.Connected),this.client.off(o.Events.NetStatsReceived)}},{key:"_traceName",value:function(){return"ZingayaAPI"}}]),e}();t.ZingayaAPI=g},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=n(3),s=n(20),c=function(){function e(){r(this,e)}return i(e,[{key:"_traceName",value:function(){return"PushService"}}],[{key:"updatePromiseResult",value:function(e){var t=this._pushPromises[e.params];t&&(clearTimeout(t.expire),e.msg?t.reject(e.msg):t.resolve(),delete this._pushPromises[e.params])}},{key:"register",value:function(e){var t=this;return new Promise(function(n,r){var i=(new s.default).toString();o.VoxSignaling.get().callRemoteFunction(a.RemoteFunction.registerPushToken,e,i)?t._pushPromises[i]={resolve:n,reject:r,expire:setTimeout(r,3e4)}:r()})}},{key:"unregister",value:function(e){var t=this;return new Promise(function(n,r){var i=(new s.default).toString();o.VoxSignaling.get().callRemoteFunction(a.RemoteFunction.unregisterPushToken,e,i)?t._pushPromises[i]={resolve:n,reject:r,expire:setTimeout(r,3e4)}:r()})}},{key:"incomingPush",value:function(e){return new Promise(function(t,n){o.VoxSignaling.get().callRemoteFunction(a.RemoteFunction.pushFeedback,e)?t():n()})}}]),e}();c._pushPromises={},t.PushService=c},function(e,t,n){"use strict";(function(t){var r=n(71);e.exports=r({window:t.window})}).call(t,n(70))},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";var r=n(7);e.exports=function(e,t){var i=e&&e.window,o={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var a in t)hasOwnProperty.call(t,a)&&(o[a]=t[a]);var s=r.log,c=r.detectBrowser(i),l={browserDetails:c,extractVersion:r.extractVersion,disableLog:r.disableLog,disableWarnings:r.disableWarnings},u=n(72)||null,d=n(74)||null,f=n(77)||null,g=n(79)||null,p=n(80)||null;switch(c.browser){case"chrome":if(!u||!u.shimPeerConnection||!o.shimChrome)return s("Chrome shim is not included in this adapter release."),l;s("adapter.js shimming chrome."),l.browserShim=u,p.shimCreateObjectURL(i),u.shimGetUserMedia(i),u.shimMediaStream(i),u.shimSourceObject(i),u.shimPeerConnection(i),u.shimOnTrack(i),u.shimAddTrackRemoveTrack(i),u.shimGetSendersWithDtmf(i),p.shimRTCIceCandidate(i);break;case"firefox":if(!f||!f.shimPeerConnection||!o.shimFirefox)return s("Firefox shim is not included in this adapter release."),l;s("adapter.js shimming firefox."),l.browserShim=f,p.shimCreateObjectURL(i),f.shimGetUserMedia(i),f.shimSourceObject(i),f.shimPeerConnection(i),f.shimOnTrack(i),f.shimRemoveStream(i),p.shimRTCIceCandidate(i);break;case"edge":if(!d||!d.shimPeerConnection||!o.shimEdge)return s("MS edge shim is not included in this adapter release."),l;s("adapter.js shimming edge."),l.browserShim=d,p.shimCreateObjectURL(i),d.shimGetUserMedia(i),d.shimPeerConnection(i),d.shimReplaceTrack(i);break;case"safari":if(!g||!o.shimSafari)return s("Safari shim is not included in this adapter release."),l;s("adapter.js shimming safari."),l.browserShim=g,p.shimCreateObjectURL(i),g.shimRTCIceServerUrls(i),g.shimCallbacksAPI(i),g.shimLocalStreamsAPI(i),g.shimRemoteStreamsAPI(i),g.shimTrackEventTransceiver(i),g.shimGetUserMedia(i),g.shimCreateOfferLegacy(i),p.shimRTCIceCandidate(i);break;default:s("Unsupported browser!")}return l}},function(e,t,n){"use strict";var r=n(7),i=r.log;e.exports={shimGetUserMedia:n(73),shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;return n._ontrackpoly||(n._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(r){var i;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find(function(e){return e.track&&e.track.id===r.track.id}):{track:r.track};var o=new Event("track");o.track=r.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],n.dispatchEvent(o)}),t.stream.getTracks().forEach(function(r){var i;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find(function(e){return e.track&&e.track.id===r.id}):{track:r};var o=new Event("track");o.track=r,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],n.dispatchEvent(o)})},n.addEventListener("addstream",n._ontrackpoly)),t.apply(n,arguments)}}},shimGetSendersWithDtmf:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){var i=this,o=n.apply(i,arguments);return o||(o=t(i,e),i._senders.push(o)),o};var r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;r.apply(t,arguments);var n=t._senders.indexOf(e);-1!==n&&t._senders.splice(n,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;n._senders=n._senders||[],i.apply(n,[e]),e.getTracks().forEach(function(e){n._senders.push(t(n,e))})};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._senders=t._senders||[],o.apply(t,[e]),e.getTracks().forEach(function(e){var n=t._senders.find(function(t){return t.track===e});n&&t._senders.splice(t._senders.indexOf(n),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=a.apply(e,[]);return t.forEach(function(t){t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSourceObject:function(e){var t=e&&e.URL;"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var n=this;if(this._srcObject=e,this.src&&t.revokeObjectURL(this.src),!e)return void(this.src="");this.src=t.createObjectURL(e),e.addEventListener("addtrack",function(){n.src&&t.revokeObjectURL(n.src),n.src=t.createObjectURL(e)}),e.addEventListener("removetrack",function(){n.src&&t.revokeObjectURL(n.src),n.src=t.createObjectURL(e)})}}))},shimAddTrackRemoveTrackWithNative:function(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(t){return e._shimmedLocalStreams[t][0]})};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(e){if(t.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")});var r=t.getSenders();n.apply(this,arguments);var i=t.getSenders().filter(function(e){return-1===r.indexOf(e)});this._shimmedLocalStreams[e.id]=[e].concat(i)};var r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(function(n){var r=t._shimmedLocalStreams[n].indexOf(e);-1!==r&&t._shimmedLocalStreams[n].splice(r,1),1===t._shimmedLocalStreams[n].length&&delete t._shimmedLocalStreams[n]}),i.apply(this,arguments)}},shimAddTrackRemoveTrack:function(e){function t(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)}),new RTCSessionDescription({type:t.type,sdp:n})}function n(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:n})}var i=r.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&i.version>=65)return this.shimAddTrackRemoveTrackWithNative(e);var o=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=o.apply(this);return e._reverseStreams=e._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var a=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var n=this;if(n._streams=n._streams||{},n._reverseStreams=n._reverseStreams||{},t.getTracks().forEach(function(e){if(n.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")}),!n._reverseStreams[t.id]){var r=new e.MediaStream(t.getTracks());n._streams[t.id]=r,n._reverseStreams[r.id]=t,t=r}a.apply(n,[t])};var s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._streams=t._streams||{},t._reverseStreams=t._reverseStreams||{},s.apply(t,[t._streams[e.id]||e]),delete t._reverseStreams[t._streams[e.id]?t._streams[e.id].id:e.id],delete t._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){var r=this;if("closed"===r.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(r.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");r._streams=r._streams||{},r._reverseStreams=r._reverseStreams||{};var o=r._streams[n.id];if(o)o.addTrack(t),Promise.resolve().then(function(){r.dispatchEvent(new Event("negotiationneeded"))});else{var a=new e.MediaStream([t]);r._streams[n.id]=a,r._reverseStreams[a.id]=n,r.addStream(a)}return r.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(n){var r=e.RTCPeerConnection.prototype[n];e.RTCPeerConnection.prototype[n]=function(){var e=this,n=arguments;return arguments.length&&"function"==typeof arguments[0]?r.apply(e,[function(r){var i=t(e,r);n[0].apply(null,[i])},function(e){n[1]&&n[1].apply(null,e)},arguments[2]]):r.apply(e,arguments).then(function(n){return t(e,n)})}});var c=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){var e=this;return arguments.length&&arguments[0].type?(arguments[0]=n(e,arguments[0]),c.apply(e,arguments)):c.apply(e,arguments)};var l=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=this,n=l.get.apply(this);return""===n.type?n:t(e,n)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;if("closed"===t.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==t)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");t._streams=t._streams||{};var n;Object.keys(t._streams).forEach(function(r){t._streams[r].getTracks().find(function(t){return e.track===t})&&(n=t._streams[r])}),n&&(1===n.getTracks().length?t.removeStream(t._reverseStreams[n.id]):n.removeTrack(e.track),t.dispatchEvent(new Event("negotiationneeded")))}},shimPeerConnection:function(e){var t=r.detectBrowser(e);if(e.RTCPeerConnection){var n=e.RTCPeerConnection;e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var i=[],o=0;o<e.iceServers.length;o++){var a=e.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(r.deprecated("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,i.push(a)):i.push(e.iceServers[o])}e.iceServers=i}return new n(e,t)},e.RTCPeerConnection.prototype=n.prototype,Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return n.generateCertificate}})}else e.RTCPeerConnection=function(t,n){return i("PeerConnection"),t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy),new e.webkitRTCPeerConnection(t,n)},e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype,e.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}});var o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,t,n){var r=this,i=arguments;if(arguments.length>0&&"function"==typeof e)return o.apply(this,arguments);if(0===o.length&&(0===arguments.length||"function"!=typeof arguments[0]))return o.apply(this,[]);var a=function(e){var t={};return e.result().forEach(function(e){var n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){n[t]=e.stat(t)}),t[n.id]=n}),t},s=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){var c=function(e){i[1](s(a(e)))};return o.apply(this,[c,arguments[0]])}return new Promise(function(e,t){o.apply(r,[function(t){e(s(a(t)))},t])}).then(t,n)},t.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=arguments,t=this,r=new Promise(function(r,i){n.apply(t,[e[0],r,i])});return e.length<2?r:r.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),t.version<52&&["createOffer","createAnswer"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var t=1===arguments.length?arguments[0]:void 0;return new Promise(function(r,i){n.apply(e,[r,i,t])})}return n.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}});var a=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?a.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}}},function(e,t,n){"use strict";var r=n(7),i=r.log;e.exports=function(e){var t=r.detectBrowser(e),n=e&&e.navigator,o=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];var o={};"number"==typeof r.ideal?(o[i("min",n)]=r.ideal,t.optional.push(o),o={},o[i("max",n)]=r.ideal,t.optional.push(o)):(o[i("",n)]=r.ideal,t.optional.push(o))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach(function(e){void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},a=function(e,r){if(t.version>=61)return r(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){var a=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};e=JSON.parse(JSON.stringify(e)),a(e.audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=o(e.audio)}if(e&&"object"==typeof e.video){var s=e.video.facingMode;s=s&&("object"==typeof s?s:{ideal:s});var c=t.version<66;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||c)){delete e.video.facingMode;var l;if("environment"===s.exact||"environment"===s.ideal?l=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(l=["front"]),l)return n.mediaDevices.enumerateDevices().then(function(t){t=t.filter(function(e){return"videoinput"===e.kind});var n=t.find(function(e){return l.some(function(t){return-1!==e.label.toLowerCase().indexOf(t)})});return!n&&t.length&&-1!==l.indexOf("back")&&(n=t[t.length-1]),n&&(e.video.deviceId=s.exact?{exact:n.deviceId}:{ideal:n.deviceId}),e.video=o(e.video),i("chrome: "+JSON.stringify(e)),r(e)})}e.video=o(e.video)}return i("chrome: "+JSON.stringify(e)),r(e)},s=function(e){return{name:{PermissionDeniedError:"NotAllowedError",InvalidStateError:"NotReadableError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotReadableError",MediaDeviceKillSwitchOn:"NotReadableError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},c=function(e,t,r){a(e,function(e){n.webkitGetUserMedia(e,t,function(e){r&&r(s(e))})})};n.getUserMedia=c;var l=function(e){return new Promise(function(t,r){n.getUserMedia(e,t,r)})};if(n.mediaDevices||(n.mediaDevices={getUserMedia:l,enumerateDevices:function(){return new Promise(function(t){var n={audio:"audioinput",video:"videoinput"};return e.MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:n[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),n.mediaDevices.getUserMedia){var u=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return a(e,function(e){return u(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(s(e))})})}}else n.mediaDevices.getUserMedia=function(e){return l(e)};void 0===n.mediaDevices.addEventListener&&(n.mediaDevices.addEventListener=function(){i("Dummy mediaDevices.addEventListener called.")}),void 0===n.mediaDevices.removeEventListener&&(n.mediaDevices.removeEventListener=function(){i("Dummy mediaDevices.removeEventListener called.")})}},function(e,t,n){"use strict";var r=n(7),i=n(75);e.exports={shimGetUserMedia:n(76),shimPeerConnection:function(e){var t=r.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var n=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){n.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCPeerConnection=i(e,t.version)},shimReplaceTrack:function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}}},function(e,t,n){"use strict";function r(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type}function i(e,t,n,r,i){var o=u.writeRtpDescription(e.kind,t);if(o+=u.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=u.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":i||"active"),o+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=a;var s="msid:"+(r?r.id:"-")+" "+a+"\r\n";o+="a="+s,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+u.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+u.localCName+"\r\n"),o}function o(e,t){var n=!1;return e=JSON.parse(JSON.stringify(e)),e.filter(function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof r;return i&&(r=[r]),r=r.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||n?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(n=!0,!0)}),delete e.url,e.urls=i?r[0]:r,!!r.length}})}function a(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},i=function(e,t,n,i){var o=r(e.parameters.apt,n),a=r(t.parameters.apt,i);return o&&a&&o.name.toLowerCase()===a.name.toLowerCase()};return e.codecs.forEach(function(r){for(var o=0;o<t.codecs.length;o++){var a=t.codecs[o];if(r.name.toLowerCase()===a.name.toLowerCase()&&r.clockRate===a.clockRate){if("rtx"===r.name.toLowerCase()&&r.parameters&&a.parameters.apt&&!i(r,a,e.codecs,t.codecs))continue;a=JSON.parse(JSON.stringify(a)),a.numChannels=Math.min(r.numChannels,a.numChannels),n.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter(function(e){for(var t=0;t<r.rtcpFeedback.length;t++)if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var r=0;r<t.headerExtensions.length;r++){var i=t.headerExtensions[r];if(e.uri===i.uri){n.headerExtensions.push(i);break}}}),n}function s(e,t,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}function c(e,t){var n=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return n||e.addRemoteCandidate(t),!n}function l(e,t){var n=new Error(t);return n.name=e,n.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],n}var u=n(46);e.exports=function(e,t){function n(t,n){n.addTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function d(t,n){n.removeTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}function f(t,n,r,i){var o=new Event("track");o.track=n,o.receiver=r,o.transceiver={receiver:r},o.streams=i,e.setTimeout(function(){t._dispatchEvent("track",o)})}var g=function(n){var r=this,i=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){r[e]=i[e].bind(i)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",n=JSON.parse(JSON.stringify(n||{})),this.usingBundle="max-bundle"===n.bundlePolicy,"negotiate"===n.rtcpMuxPolicy)throw l("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(n.rtcpMuxPolicy||(n.rtcpMuxPolicy="require"),n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all"}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced"}if(n.iceServers=o(n.iceServers||[],t),this._iceGatherers=[],n.iceCandidatePoolSize)for(var a=n.iceCandidatePoolSize;a>0;a--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy}));else n.iceCandidatePoolSize=0;this._config=n,this.transceivers=[],this._sdpSessionId=u.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(g.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(g.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),g.prototype.onicecandidate=null,g.prototype.onaddstream=null,g.prototype.ontrack=null,g.prototype.onremovestream=null,g.prototype.onsignalingstatechange=null,g.prototype.oniceconnectionstatechange=null,g.prototype.onconnectionstatechange=null,g.prototype.onicegatheringstatechange=null,g.prototype.onnegotiationneeded=null,g.prototype.ondatachannel=null,g.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},g.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},g.prototype.getConfiguration=function(){return this._config},g.prototype.getLocalStreams=function(){return this.localStreams},g.prototype.getRemoteStreams=function(){return this.remoteStreams},g.prototype._createTransceiver=function(e,t){var n=this.transceivers.length>0,r={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&n)r.iceTransport=this.transceivers[0].iceTransport,r.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();r.iceTransport=i.iceTransport,r.dtlsTransport=i.dtlsTransport}return t||this.transceivers.push(r),r},g.prototype.addTrack=function(t,n){if(this._isClosed)throw l("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");if(this.transceivers.find(function(e){return e.track===t}))throw l("InvalidAccessError","Track already exists.");for(var r,i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(r=this.transceivers[i]);return r||(r=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(n)&&this.localStreams.push(n),r.track=t,r.stream=n,r.rtpSender=new e.RTCRtpSender(t,r.dtlsTransport),r.rtpSender},g.prototype.addStream=function(e){var n=this;if(t>=15025)e.getTracks().forEach(function(t){n.addTrack(t,e)});else{var r=e.clone();e.getTracks().forEach(function(e,t){var n=r.getTracks()[t];e.addEventListener("enabled",function(e){n.enabled=e.enabled})}),r.getTracks().forEach(function(e){n.addTrack(e,r)})}},g.prototype.removeTrack=function(t){if(this._isClosed)throw l("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var n=this.transceivers.find(function(e){return e.rtpSender===t});if(!n)throw l("InvalidAccessError","Sender was not created by this connection.");var r=n.stream;n.rtpSender.stop(),n.rtpSender=null,n.track=null,n.stream=null,-1===this.transceivers.map(function(e){return e.stream}).indexOf(r)&&this.localStreams.indexOf(r)>-1&&this.localStreams.splice(this.localStreams.indexOf(r),1),this._maybeFireNegotiationNeeded()},g.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var n=t.getSenders().find(function(t){return t.track===e});n&&t.removeTrack(n)})},g.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},g.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},g.prototype._createIceGatherer=function(t,n){var r=this;if(n&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var n=!e.candidate||0===Object.keys(e.candidate).length;i.state=n?"completed":"gathering",null!==r.transceivers[t].bufferedCandidateEvents&&r.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},g.prototype._gather=function(t,n){var r=this,i=this.transceivers[n].iceGatherer;if(!i.onlocalcandidate){var o=this.transceivers[n].bufferedCandidateEvents;this.transceivers[n].bufferedCandidateEvents=null,i.removeEventListener("localcandidate",this.transceivers[n].bufferCandidates),i.onlocalcandidate=function(e){if(!(r.usingBundle&&n>0)){var o=new Event("icecandidate");o.candidate={sdpMid:t,sdpMLineIndex:n};var a=e.candidate,s=!a||0===Object.keys(a).length;if(s)"new"!==i.state&&"gathering"!==i.state||(i.state="completed");else{"new"===i.state&&(i.state="gathering"),a.component=1,a.ufrag=i.getLocalParameters().usernameFragment;var c=u.writeCandidate(a);o.candidate=Object.assign(o.candidate,u.parseCandidate(c)),o.candidate.candidate=c,o.candidate.toJSON=function(){return{candidate:o.candidate.candidate,sdpMid:o.candidate.sdpMid,sdpMLineIndex:o.candidate.sdpMLineIndex,usernameFragment:o.candidate.usernameFragment}}}var l=u.getMediaSections(r._localDescription.sdp);l[o.candidate.sdpMLineIndex]+=s?"a=end-of-candidates\r\n":"a="+o.candidate.candidate+"\r\n",r._localDescription.sdp=u.getDescription(r._localDescription.sdp)+l.join("");var d=r.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==r.iceGatheringState&&(r.iceGatheringState="gathering",r._emitGatheringStateChange()),s||r._dispatchEvent("icecandidate",o),d&&(r._dispatchEvent("icecandidate",new Event("icecandidate")),r.iceGatheringState="complete",r._emitGatheringStateChange())}},e.setTimeout(function(){o.forEach(function(e){i.onlocalcandidate(e)})},0)}},g.prototype._createIceAndDtlsTransports=function(){var t=this,n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var r=new e.RTCDtlsTransport(n);return r.ondtlsstatechange=function(){t._updateConnectionState()},r.onerror=function(){Object.defineProperty(r,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:n,dtlsTransport:r}},g.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var n=this.transceivers[e].iceTransport;n&&(delete n.onicestatechange,delete this.transceivers[e].iceTransport);var r=this.transceivers[e].dtlsTransport;r&&(delete r.ondtlsstatechange,delete r.onerror,delete this.transceivers[e].dtlsTransport)},g.prototype._transceive=function(e,n,r){var i=a(e.localCapabilities,e.remoteCapabilities);n&&e.rtpSender&&(i.encodings=e.sendEncodingParameters,i.rtcp={cname:u.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(i.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(i)),r&&e.rtpReceiver&&i.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length?i.encodings=e.recvEncodingParameters:i.encodings=[{}],i.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(i.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(i.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(i))},g.prototype.setLocalDescription=function(e){var t=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(l("TypeError",'Unsupported type "'+e.type+'"'));if(!s("setLocalDescription",e.type,t.signalingState)||t._isClosed)return Promise.reject(l("InvalidStateError","Can not set local "+e.type+" in state "+t.signalingState));var n,r;if("offer"===e.type)n=u.splitSections(e.sdp),r=n.shift(),n.forEach(function(e,n){var r=u.parseRtpParameters(e);t.transceivers[n].localCapabilities=r}),t.transceivers.forEach(function(e,n){t._gather(e.mid,n)});else if("answer"===e.type){n=u.splitSections(t._remoteDescription.sdp),r=n.shift();var i=u.matchPrefix(r,"a=ice-lite").length>0;n.forEach(function(e,n){var o=t.transceivers[n],s=o.iceGatherer,c=o.iceTransport,l=o.dtlsTransport,d=o.localCapabilities,f=o.remoteCapabilities;if(!(u.isRejected(e)&&0===u.matchPrefix(e,"a=bundle-only").length||o.rejected)){var g=u.getIceParameters(e,r),p=u.getDtlsParameters(e,r);i&&(p.role="server"),t.usingBundle&&0!==n||(t._gather(o.mid,n),"new"===c.state&&c.start(s,g,i?"controlling":"controlled"),"new"===l.state&&l.start(p));var v=a(d,f);t._transceive(o,v.codecs.length>0,!1)}})}return t._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?t._updateSignalingState("have-local-offer"):t._updateSignalingState("stable"),Promise.resolve()},g.prototype.setRemoteDescription=function(r){var i=this;if(-1===["offer","answer"].indexOf(r.type))return Promise.reject(l("TypeError",'Unsupported type "'+r.type+'"'));if(!s("setRemoteDescription",r.type,i.signalingState)||i._isClosed)return Promise.reject(l("InvalidStateError","Can not set remote "+r.type+" in state "+i.signalingState));var o={};i.remoteStreams.forEach(function(e){o[e.id]=e});var g=[],p=u.splitSections(r.sdp),v=p.shift(),h=u.matchPrefix(v,"a=ice-lite").length>0,m=u.matchPrefix(v,"a=group:BUNDLE ").length>0;i.usingBundle=m;var y=u.matchPrefix(v,"a=ice-options:")[0];return i.canTrickleIceCandidates=!!y&&y.substr(14).split(" ").indexOf("trickle")>=0,p.forEach(function(s,l){var f=u.splitLines(s),p=u.getKind(s),y=u.isRejected(s)&&0===u.matchPrefix(s,"a=bundle-only").length,C=f[0].substr(2).split(" ")[2],_=u.getDirection(s,v),S=u.parseMsid(s),E=u.getMid(s)||u.generateIdentifier();if(y||"application"===p&&("DTLS/SCTP"===C||"UDP/DTLS/SCTP"===C))return void(i.transceivers[l]={mid:E,kind:p,protocol:C,rejected:!0});!y&&i.transceivers[l]&&i.transceivers[l].rejected&&(i.transceivers[l]=i._createTransceiver(p,!0));var L,b,M,R,T,k,I,P,w,O,A,D=u.parseRtpParameters(s);y||(O=u.getIceParameters(s,v),A=u.getDtlsParameters(s,v),A.role="client"),I=u.parseRtpEncodingParameters(s);var N=u.parseRtcpParameters(s),j=u.matchPrefix(s,"a=end-of-candidates",v).length>0,x=u.matchPrefix(s,"a=candidate:").map(function(e){return u.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===r.type||"answer"===r.type)&&!y&&m&&l>0&&i.transceivers[l]&&(i._disposeIceAndDtlsTransports(l),i.transceivers[l].iceGatherer=i.transceivers[0].iceGatherer,i.transceivers[l].iceTransport=i.transceivers[0].iceTransport,i.transceivers[l].dtlsTransport=i.transceivers[0].dtlsTransport,i.transceivers[l].rtpSender&&i.transceivers[l].rtpSender.setTransport(i.transceivers[0].dtlsTransport),i.transceivers[l].rtpReceiver&&i.transceivers[l].rtpReceiver.setTransport(i.transceivers[0].dtlsTransport)),"offer"!==r.type||y){if("answer"===r.type&&!y){L=i.transceivers[l],b=L.iceGatherer,M=L.iceTransport,R=L.dtlsTransport,T=L.rtpReceiver,k=L.sendEncodingParameters,P=L.localCapabilities,i.transceivers[l].recvEncodingParameters=I,i.transceivers[l].remoteCapabilities=D,i.transceivers[l].rtcpParameters=N,x.length&&"new"===M.state&&(!h&&!j||m&&0!==l?x.forEach(function(e){c(L.iceTransport,e)}):M.setRemoteCandidates(x)),m&&0!==l||("new"===M.state&&M.start(b,O,"controlling"),"new"===R.state&&R.start(A));var F=a(L.localCapabilities,L.remoteCapabilities),V=F.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length;!V&&L.sendEncodingParameters[0].rtx&&delete L.sendEncodingParameters[0].rtx,i._transceive(L,"sendrecv"===_||"recvonly"===_,"sendrecv"===_||"sendonly"===_),!T||"sendrecv"!==_&&"sendonly"!==_?delete L.rtpReceiver:(w=T.track,S?(o[S.stream]||(o[S.stream]=new e.MediaStream),n(w,o[S.stream]),g.push([w,T,o[S.stream]])):(o.default||(o.default=new e.MediaStream),n(w,o.default),g.push([w,T,o.default])))}}else{L=i.transceivers[l]||i._createTransceiver(p),L.mid=E,L.iceGatherer||(L.iceGatherer=i._createIceGatherer(l,m)),x.length&&"new"===L.iceTransport.state&&(!j||m&&0!==l?x.forEach(function(e){c(L.iceTransport,e)}):L.iceTransport.setRemoteCandidates(x)),P=e.RTCRtpReceiver.getCapabilities(p),t<15019&&(P.codecs=P.codecs.filter(function(e){return"rtx"!==e.name})),k=L.sendEncodingParameters||[{ssrc:1001*(2*l+2)}];var U=!1;if("sendrecv"===_||"sendonly"===_){if(U=!L.rtpReceiver,T=L.rtpReceiver||new e.RTCRtpReceiver(L.dtlsTransport,p),U){var G;w=T.track,S&&"-"===S.stream||(S?(o[S.stream]||(o[S.stream]=new e.MediaStream,Object.defineProperty(o[S.stream],"id",{get:function(){return S.stream}})),Object.defineProperty(w,"id",{get:function(){return S.track}}),G=o[S.stream]):(o.default||(o.default=new e.MediaStream),G=o.default)),G&&(n(w,G),L.associatedRemoteMediaStreams.push(G)),g.push([w,T,G])}}else L.rtpReceiver&&L.rtpReceiver.track&&(L.associatedRemoteMediaStreams.forEach(function(e){var t=e.getTracks().find(function(e){return e.id===L.rtpReceiver.track.id});t&&d(t,e)}),L.associatedRemoteMediaStreams=[]);L.localCapabilities=P,L.remoteCapabilities=D,L.rtpReceiver=T,L.rtcpParameters=N,L.sendEncodingParameters=k,L.recvEncodingParameters=I,i._transceive(i.transceivers[l],!1,U)}}),void 0===i._dtlsRole&&(i._dtlsRole="offer"===r.type?"active":"passive"),i._remoteDescription={type:r.type,sdp:r.sdp},"offer"===r.type?i._updateSignalingState("have-remote-offer"):i._updateSignalingState("stable"),Object.keys(o).forEach(function(t){var n=o[t];if(n.getTracks().length){if(-1===i.remoteStreams.indexOf(n)){i.remoteStreams.push(n);var r=new Event("addstream");r.stream=n,e.setTimeout(function(){i._dispatchEvent("addstream",r)})}g.forEach(function(e){var t=e[0],r=e[1];n.id===e[2].id&&f(i,t,r,[n])})}}),g.forEach(function(e){e[2]||f(i,e[0],e[1],[])}),e.setTimeout(function(){i&&i.transceivers&&i.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},g.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},g.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},g.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},g.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++}),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",n)}},g.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var n=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",n)}},g.prototype.createOffer=function(){var n=this;if(n._isClosed)return Promise.reject(l("InvalidStateError","Can not call createOffer after close"));var r=n.transceivers.filter(function(e){return"audio"===e.kind}).length,o=n.transceivers.filter(function(e){return"video"===e.kind}).length,a=arguments[0];if(a){if(a.mandatory||a.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==a.offerToReceiveAudio&&(r=!0===a.offerToReceiveAudio?1:!1===a.offerToReceiveAudio?0:a.offerToReceiveAudio),void 0!==a.offerToReceiveVideo&&(o=!0===a.offerToReceiveVideo?1:!1===a.offerToReceiveVideo?0:a.offerToReceiveVideo)}for(n.transceivers.forEach(function(e){"audio"===e.kind?--r<0&&(e.wantReceive=!1):"video"===e.kind&&--o<0&&(e.wantReceive=!1)});r>0||o>0;)r>0&&(n._createTransceiver("audio"),r--),o>0&&(n._createTransceiver("video"),o--);var s=u.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.transceivers.forEach(function(r,i){var o=r.track,a=r.kind,s=r.mid||u.generateIdentifier();r.mid=s,r.iceGatherer||(r.iceGatherer=n._createIceGatherer(i,n.usingBundle));var c=e.RTCRtpSender.getCapabilities(a);t<15019&&(c.codecs=c.codecs.filter(function(e){return"rtx"!==e.name})),c.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),r.remoteCapabilities&&r.remoteCapabilities.codecs&&r.remoteCapabilities.codecs.forEach(function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)})}),c.headerExtensions.forEach(function(e){(r.remoteCapabilities&&r.remoteCapabilities.headerExtensions||[]).forEach(function(t){e.uri===t.uri&&(e.id=t.id)})});var l=r.sendEncodingParameters||[{ssrc:1001*(2*i+1)}];o&&t>=15019&&"video"===a&&!l[0].rtx&&(l[0].rtx={ssrc:l[0].ssrc+1}),r.wantReceive&&(r.rtpReceiver=new e.RTCRtpReceiver(r.dtlsTransport,a)),r.localCapabilities=c,r.sendEncodingParameters=l}),"max-compat"!==n._config.bundlePolicy&&(s+="a=group:BUNDLE "+n.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),s+="a=ice-options:trickle\r\n",n.transceivers.forEach(function(e,t){s+=i(e,e.localCapabilities,"offer",e.stream,n._dtlsRole),s+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===n.iceGatheringState||0!==t&&n.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,s+="a="+u.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(s+="a=end-of-candidates\r\n"))});var c=new e.RTCSessionDescription({type:"offer",sdp:s});return Promise.resolve(c)},g.prototype.createAnswer=function(){var n=this;if(n._isClosed)return Promise.reject(l("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==n.signalingState&&"have-local-pranswer"!==n.signalingState)return Promise.reject(l("InvalidStateError","Can not call createAnswer in signalingState "+n.signalingState));var r=u.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.usingBundle&&(r+="a=group:BUNDLE "+n.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),r+="a=ice-options:trickle\r\n";var o=u.getMediaSections(n._remoteDescription.sdp).length;n.transceivers.forEach(function(e,s){if(!(s+1>o)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?r+="m=application 0 DTLS/SCTP 5000\r\n":r+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?r+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(r+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(r+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");if(e.stream){var c;"audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1})}var l=a(e.localCapabilities,e.remoteCapabilities);!l.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,r+=i(e,l,"answer",e.stream,n._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(r+="a=rtcp-rsize\r\n")}});var s=new e.RTCSessionDescription({type:"answer",sdp:r});return Promise.resolve(s)},g.prototype.addIceCandidate=function(e){var t,n=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(r,i){if(!n._remoteDescription)return i(l("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var o=e.sdpMLineIndex;if(e.sdpMid)for(var a=0;a<n.transceivers.length;a++)if(n.transceivers[a].mid===e.sdpMid){o=a;break}var s=n.transceivers[o];if(!s)return i(l("OperationError","Can not add ICE candidate"));if(s.rejected)return r();var d=Object.keys(e.candidate).length>0?u.parseCandidate(e.candidate):{};if("tcp"===d.protocol&&(0===d.port||9===d.port))return r();if(d.component&&1!==d.component)return r();if((0===o||o>0&&s.iceTransport!==n.transceivers[0].iceTransport)&&!c(s.iceTransport,d))return i(l("OperationError","Can not add ICE candidate"));var f=e.candidate.trim();0===f.indexOf("a=")&&(f=f.substr(2)),t=u.getMediaSections(n._remoteDescription.sdp),t[o]+="a="+(d.type?f:"end-of-candidates")+"\r\n",n._remoteDescription.sdp=u.getDescription(n._remoteDescription.sdp)+t.join("")}else for(var g=0;g<n.transceivers.length&&(n.transceivers[g].rejected||(n.transceivers[g].iceTransport.addRemoteCandidate({}),t=u.getMediaSections(n._remoteDescription.sdp),t[g]+="a=end-of-candidates\r\n",n._remoteDescription.sdp=u.getDescription(n._remoteDescription.sdp)+t.join(""),!n.usingBundle));g++);r()})},g.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var n=null;if(this.transceivers.forEach(function(e){e.rtpSender&&e.rtpSender.track===t?n=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(n=e.rtpReceiver)}),!n)throw l("InvalidAccessError","Invalid selector.");return n.getStats()}var r=[];return this.transceivers.forEach(function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(t){e[t]&&r.push(e[t].getStats())})}),Promise.all(r).then(function(e){var t=new Map;return e.forEach(function(e){e.forEach(function(e){t.set(e.id,e)})}),t})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(t){var n=e[t];if(n&&n.prototype&&n.prototype.getStats){var i=n.prototype.getStats;n.prototype.getStats=function(){return i.apply(this).then(function(e){var t=new Map;return Object.keys(e).forEach(function(n){e[n].type=r(e[n]),t.set(n,e[n])}),t})}}});var p=["createOffer","createAnswer"];return p.forEach(function(e){var t=g.prototype[e];g.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then(function(t){"function"==typeof e[0]&&e[0].apply(null,[t])},function(t){"function"==typeof e[1]&&e[1].apply(null,[t])}):t.apply(this,arguments)}}),p=["setLocalDescription","setRemoteDescription","addIceCandidate"],p.forEach(function(e){var t=g.prototype[e];g.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)},function(t){"function"==typeof e[2]&&e[2].apply(null,[t])}):t.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=g.prototype[e];g.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),g}},function(e,t,n){"use strict";e.exports=function(e){var t=e&&e.navigator,n=function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}},r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return r(e).catch(function(e){return Promise.reject(n(e))})}}},function(e,t,n){"use strict";var r=n(7);e.exports={shimGetUserMedia:n(78),shimOnTrack:function(e){"object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var n=new Event("track");n.track=t,n.receiver={track:t},n.transceiver={receiver:n.receiver},n.streams=[e.stream],this.dispatchEvent(n)}.bind(this))}.bind(this))}}),"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(e){"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(e){var t=r.detectBrowser(e);if("object"==typeof e&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){e.RTCPeerConnection||(e.RTCPeerConnection=function(n,r){if(t.version<38&&n&&n.iceServers){for(var i=[],o=0;o<n.iceServers.length;o++){var a=n.iceServers[o];if(a.hasOwnProperty("urls"))for(var s=0;s<a.urls.length;s++){var c={url:a.urls[s]};0===a.urls[s].indexOf("turn")&&(c.username=a.username,c.credential=a.credential),i.push(c)}else i.push(n.iceServers[o])}n.iceServers=i}return new e.mozRTCPeerConnection(n,r)},e.RTCPeerConnection.prototype=e.mozRTCPeerConnection.prototype,e.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.mozRTCPeerConnection.generateCertificate}}),e.RTCSessionDescription=e.mozRTCSessionDescription,e.RTCIceCandidate=e.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}});var n=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var i=function(e){var t=new Map;return Object.keys(e).forEach(function(n){t.set(n,e[n]),t[n]=e[n]}),t},o={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,n,r){return a.apply(this,[e||null]).then(function(e){if(t.version<48&&(e=i(e)),t.version<53&&!n)try{e.forEach(function(e){e.type=o[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,n){e.set(n,Object.assign({},t,{type:o[t.type]||t.type}))})}return e}).then(n,r)}}},shimRemoveStream:function(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;r.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(n){n.track&&-1!==e.getTracks().indexOf(n.track)&&t.removeTrack(n)})})}}},function(e,t,n){"use strict";var r=n(7),i=r.log;e.exports=function(e){var t=r.detectBrowser(e),n=e&&e.navigator,o=e&&e.MediaStreamTrack,a=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},s=function(e,r,o){var s=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var r=e[n]="object"==typeof e[n]?e[n]:{ideal:e[n]};if(void 0===r.min&&void 0===r.max&&void 0===r.exact||t.push(n),void 0!==r.exact&&("number"==typeof r.exact?r.min=r.max=r.exact:e[n]=r.exact,delete r.exact),void 0!==r.ideal){e.advanced=e.advanced||[];var i={};"number"==typeof r.ideal?i[n]={min:r.ideal,max:r.ideal}:i[n]=r.ideal,e.advanced.push(i),delete r.ideal,Object.keys(r).length||delete e[n]}}}),t.length&&(e.require=t),e};return e=JSON.parse(JSON.stringify(e)),t.version<38&&(i("spec: "+JSON.stringify(e)),e.audio&&(e.audio=s(e.audio)),e.video&&(e.video=s(e.video)),i("ff37: "+JSON.stringify(e))),n.mozGetUserMedia(e,r,function(e){o(a(e))})},c=function(e){return new Promise(function(t,n){s(e,t,n)})};if(n.mediaDevices||(n.mediaDevices={getUserMedia:c,addEventListener:function(){},removeEventListener:function(){}}),n.mediaDevices.enumerateDevices=n.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},t.version<41){var l=n.mediaDevices.enumerateDevices.bind(n.mediaDevices);n.mediaDevices.enumerateDevices=function(){return l().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(t.version<49){var u=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return u(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return t},function(e){return Promise.reject(a(e))})}}if(!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var d=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},f=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(e){return"object"==typeof e&&"object"==typeof e.audio&&(e=JSON.parse(JSON.stringify(e)),d(e.audio,"autoGainControl","mozAutoGainControl"),d(e.audio,"noiseSuppression","mozNoiseSuppression")),f(e)},o&&o.prototype.getSettings){var g=o.prototype.getSettings;o.prototype.getSettings=function(){var e=g.apply(this,arguments);return d(e,"mozAutoGainControl","autoGainControl"),d(e,"mozNoiseSuppression","noiseSuppression"),e}}if(o&&o.prototype.applyConstraints){var p=o.prototype.applyConstraints;o.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"==typeof e&&(e=JSON.parse(JSON.stringify(e)),d(e,"autoGainControl","mozAutoGainControl"),d(e,"noiseSuppression","mozNoiseSuppression")),p.apply(this,[e])}}}n.getUserMedia=function(e,i,o){if(t.version<44)return s(e,i,o);r.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(i,o)}}},function(e,t,n){"use strict";var r=n(7);e.exports={shimLocalStreamsAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getStreamById=function(e){var t=null;return this._localStreams&&this._localStreams.forEach(function(n){n.id===e&&(t=n)}),this._remoteStreams&&this._remoteStreams.forEach(function(n){n.id===e&&(t=n)}),t}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),-1===this._localStreams.indexOf(e)&&this._localStreams.push(e);var n=this;e.getTracks().forEach(function(r){t.call(n,r,e)})},e.RTCPeerConnection.prototype.addTrack=function(e,n){return n&&(this._localStreams?-1===this._localStreams.indexOf(n)&&this._localStreams.push(n):this._localStreams=[n]),t.call(this,e,n)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var t=this._localStreams.indexOf(e);if(-1!==t){this._localStreams.splice(t,1);var n=this,r=e.getTracks();this.getSenders().forEach(function(e){-1!==r.indexOf(e.track)&&n.removeTrack(e)})}})}},shimRemoteStreamsAPI:function(e){"object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),"onaddstream"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){var t=e.streams[0];if(this._remoteStreams||(this._remoteStreams=[]),!(this._remoteStreams.indexOf(t)>=0)){this._remoteStreams.push(t);var n=new Event("addstream");n.stream=e.streams[0],this.dispatchEvent(n)}}.bind(this))}}))},shimCallbacksAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i};var s=function(e,t,n){var r=i.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=s,s=function(e,t,n){var r=o.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=s,s=function(e,t,n){var r=a.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=s}},shimGetUserMedia:function(e){var t=e&&e.navigator;t.getUserMedia||(t.webkitGetUserMedia?t.getUserMedia=t.webkitGetUserMedia.bind(t):t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t)))},shimRTCIceServerUrls:function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){for(var i=[],o=0;o<e.iceServers.length;o++){var a=e.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(r.deprecated("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,i.push(a)):i.push(e.iceServers[o])}e.iceServers=i}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},shimTrackEventTransceiver:function(e){"object"==typeof e&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){var n=this;if(e){var r=n.getTransceivers().find(function(e){return e.sender.track&&"audio"===e.sender.track.kind});!1===e.offerToReceiveAudio&&r?"sendrecv"===r.direction?r.setDirection("sendonly"):"recvonly"===r.direction&&r.setDirection("inactive"):!0!==e.offerToReceiveAudio||r||n.addTransceiver("audio");var i=n.getTransceivers().find(function(e){return e.sender.track&&"video"===e.sender.track.kind});!1===e.offerToReceiveVideo&&i?"sendrecv"===i.direction?i.setDirection("sendonly"):"recvonly"===i.direction&&i.setDirection("inactive"):!0!==e.offerToReceiveVideo||i||n.addTransceiver("video")}return t.apply(n,arguments)}}}},function(e,t,n){"use strict";function r(e,t,n){if(e.RTCPeerConnection){var r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);var o=function(e){r(n(e))};return this._eventMap=this._eventMap||{},this._eventMap[r]=o,i.apply(this,[e,o])};var o=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[n])return o.apply(this,arguments);var r=this._eventMap[n];return delete this._eventMap[n],o.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)}})}}var i=n(46),o=n(7);e.exports={shimRTCIceCandidate:function(e){if(!(e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){"object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&(e=JSON.parse(JSON.stringify(e)),e.candidate=e.candidate.substr(2));var n=new t(e),r=i.parseCandidate(e.candidate),o=Object.assign(n,r);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o},r(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})}},shimCreateObjectURL:function(e){var t=e&&e.URL;if("object"==typeof e&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype&&t.createObjectURL&&t.revokeObjectURL){var n=t.createObjectURL.bind(t),r=t.revokeObjectURL.bind(t),i=new Map,a=0;t.createObjectURL=function(e){if("getTracks"in e){var t="polyblob:"+ ++a;return i.set(t,e),o.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),t}return n(e)},t.revokeObjectURL=function(e){r(e),i.delete(e)};var s=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return s.get.apply(this)},set:function(e){return this.srcObject=i.get(e)||null,s.set.apply(this,[e])}});var c=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=i.get(arguments[1])||null),c.apply(this,arguments)}}}}}]);
